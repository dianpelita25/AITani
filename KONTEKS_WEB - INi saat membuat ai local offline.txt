--- AWAL DARI SNAPSHOT KODE PROYEK WEB ---

Proyek: ai_tani_kupang Tallwind - Copy
Dibuat pada: Sat Nov 15 2025 03:53:46 GMT+0800 (Singapore Standard Time)

================================================================================
STRUKTUR FILE & KONTEN
================================================================================


--- File: ./README.md ---

ï»¿# Ai Tani Kupang â€“ React App

A modern React + Vite app with offline-aware reporting, Cloudflare Worker API, and clean UI powered by Tailwind.

## ğŸš€ Highlights

- **React 18 + Vite** â€“ super fast DX & HMR  
- **Redux Toolkit + RTK Query** â€“ state & data fetching
- **React Router v6** â€“ routing
- **Tailwind CSS** â€“ utility-first styling
- **Framer Motion** â€“ subtle animations
- **React Hook Form** â€“ lean forms
- **Recharts / (D3 where needed)** â€“ charts
- **Jest + RTL** â€“ testing setup
- **Offline queue** â€“ create reports while offline, sync later
- **Cloudflare Workers** â€“ API with **D1** (SQLite) & **R2** (object storage)
- **Image loading without CORS** â€“ custom `<AppImage />` (no fetch/HEAD)

---

## ğŸ“‹ Prerequisites

- Node.js â‰¥ 18 (disarankan)
- npm atau yarn
- Cloudflare Wrangler (`npm i -g wrangler`, optional untuk dev API)

---

## ğŸ› ï¸ Install & Run (Dev)

### 1) Frontend (Vite)
```bash
npm install
npm run dev
# FE will serve at http://localhost:xxxx (lihat console)
```

### 2) API (Cloudflare Worker, local)
Di repo API kamu, jalankan:
```bash
# opsional bila ada migrasi
npx wrangler d1 migrations apply ai-tani-kupang-web --local

# jalankan worker + D1 + R2 lokal
npx wrangler dev
# default di http://127.0.0.1:8787
```

Aplikasi FE memanggil API pada origin Worker lokal (contoh: `http://127.0.0.1:8787/api/alerts`). Jika kamu memakai proxy Vite untuk `/api`, pastikan set di `vite.config.js`.

---

## Dev Demo Checklist (5 langkah)

1. **Wrangler dev** â€“ `npx wrangler dev` (jendela ini jangan ditutup supaya D1/R2 lokal hidup).
2. **Upload foto contoh ke R2** â€“ gunakan aset `docs/demo-assets/Daun_Jagung.png` lalu jalankan  
   `npx wrangler r2 object put aitaniweb-photos/uploads/folder%20A/Daun%20Jagung.png --file docs/demo-assets/Daun_Jagung.png`.
3. **Seed alert** â€“ `curl -X POST http://127.0.0.1:8787/api/dev/seed-alerts?table=alerts`  
   (opsional: kirim payload kustom dengan `-d @ai-tani-kupang-api/fixtures/alerts.fixture.json`).
4. **Frontend dev** â€“ `npm run dev` lalu buka `http://localhost:4028/community-alerts`.
5. **Verifikasi** â€“ buka salah satu alert hingga modal, cek request `GET /api/photos/uploads/folder%20A/Daun%20Jagung.png` â†’ 200. Coba hapus/ubah `photoKey` untuk memastikan fallback tidak crash.

---

## ğŸ”§ Konfigurasi yang Penting

### 1) Penanganan Gambar (tanpa CORS)
Kita pakai komponen ringan **`AppImage`** yang **tidak** melakukan `fetch()`/`HEAD` ke R2, jadi tidak memicu CORS. Fallback berjalan via `onError`.

**File**: `src/components/AppImage.jsx`  
**Fallback**: letakkan gambar fallback di `public/assets/images/no_image.png`.

### 2) Normalisasi URL Foto (hindari double-encode)
Beberapa nama file (mis. dengan spasi) bisa muncul sebagai `WhatsApp%2520Image...` (double-encoded).  
Di **`AlertDetailModal.jsx`** ada helper `normalizePhotoUrl()` yang:
- `decodeURIComponent()` **sekali** bila menemukan `%25`
- mengganti spasi literal menjadi `%20`

> Hasilnya: URL valid ke R2 (tidak 404), foto tampil di **card** & **detail modal**.

### 3) Mapper API â†’ FE
Di **`src/services/alertsApi.js`**:
- `photo_url` dari API selalu dipetakan menjadi **`photoUrl`**
- field snake_case lain dipetakan ke camelCase
- `coordinates` diparse aman (string/obj)

RTK Query endpoint:
- `GET /api/alerts` â†’ `useGetAlertsQuery`
- `POST /api/alerts` (multipart, mendukung replay offline via antrean)

### 4) Offline Queue
Jika submit gagal (offline), payload (termasuk foto sebagai **DataURL**) diantrikan di **`offline/queueService`** dan akan disinkron otomatis saat online.

---

## ğŸ“ Project Structure (ringkas)

```
ai_tani_kupang Tallwind
â”œâ”€â”€ .env.txt
â”œâ”€â”€ KONTEKS_WEB.txt
â”œâ”€â”€ README.md
â”œâ”€â”€ README.md.txt
â”œâ”€â”€ ai-tani-kupang-api
â”‚   â”œâ”€â”€ .wrangler
â”‚   â”‚   â”œâ”€â”€ state
â”‚   â”‚   â”‚   â””â”€â”€ v3
â”‚   â”‚   â”‚       â”œâ”€â”€ cache
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ miniflare-CacheObject
â”‚   â”‚   â”‚       â”œâ”€â”€ d1
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ miniflare-D1DatabaseObject
â”‚   â”‚   â”‚       â”‚       â””â”€â”€ 5ae9da099f6cfd381eabd0dd98dea07b3919d6ef80713ba9d8802efef8b9d036.sqlite
â”‚   â”‚   â”‚       â”œâ”€â”€ kv
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ miniflare-KVNamespaceObject
â”‚   â”‚   â”‚       â”œâ”€â”€ r2
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ aitaniweb-photos
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ blobs
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 145e90cb043214655da53ae60f9c3c2009de4b6be3a999bba7a27f84cb323fc1000001994137d690      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 17e15f4549191400f985a15033fff5060a3e0a9158b89bcbe3577ed28653b962000001993b890340      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 253d0cdf8758e01f6e554a0aba8b3db84c3e2e88baa9863caa81acbd91e623320000019941135d8f      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 276d78488906b8780221d127ec03380b3f85d0ddf71984b8764b4e54f46a9122000001993d2bdef6      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 2cab905cd4dbe0460feed4f34948ea1ec7622b5350f937ead18c80737b86180b000001993ce849c9      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 2f8339ab856fcf0492eaeb8c384a711d06a84cc5eaa9dcf85e54c489bd8e08b5000001994112fbe6      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 346334ec54382334f42d89a8bf4936d9c8bffb8ccc3c76b3494bb18b46a17704000001993c445ddd      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 4c511463f771697455501e31ea877679e92a5093f34e7e991bd14dee8606cb4e000001994109c8a8      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 4dd517d5067101f7b8c5456d2421002a6e823aac826a7ccbf031837427315971000001993d32ee9e      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 53b24ebdd1127dfdfefc42366cdc849f655b13ab7eb34316404c75e051a2e6d7000001993c46d22e      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 5f56014dbb5e8615e1d5187f3ba6bf7c9f0c240c71ca211e15ac53bd72f86b3f000001993c47f3f8      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 7f31aeee0a01ea2ea1dcb113eb50456be7044a2efbf95ccd17c37b9f8855938b0000019941489186      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 7fa5951b56477c85244f82055e414022f5ed79edacf46bf4ab567dca5136df1f000001993d0119d2      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ 9e682555d64f8b0134e00a509eefe12dbde07847b668b998769d00b54ba39609000001993ccf6672      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ a250c881bec64b10d3e9d2a532f01afe488974d5268fdac3c940fa51e375e93b000001994113f0c0      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ a36d44fe74f8355f466a3b592d40e4266fefd6cbb1f91ccb68d9eb175e1e27d60000019940b772f5      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ ac4e9c3eb382058d1ec7de4caa1c8f5dc7b27c10e2e6a224f39eecf281bd5029000001993b67f052      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ bcfd32ade40220407d8de3b167dd369a9d505f6fe7e95eb68de7e0dd2eeb3e7c0000019940fee848      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ ce356431fc5033347f0b87b0f880a58a183bec82a94141e65a27f1d4eee2da010000019937b79fba      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ e5a16bb6a1c5e4c352b102fa6c4a319587ffb00d1e3bd963430eabaacb632be0000001993969131b      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ e969717f15c765e981c928d7907c51c53e9023a29e71b5643fa1f48e98d425c30000019941111e42      
â”‚   â”‚   â”‚       â”‚   â”‚       â”œâ”€â”€ fe137531195cffad3400a28343216561be8aad29c721a99e57f2e76d0660bda3000001993d3f689e      
â”‚   â”‚   â”‚       â”‚   â”‚       â””â”€â”€ ff95c365c0ae996938de2aa8ad5384fbe7a030460d5cefde6abe4c85fd3bceb1000001993b117a86      
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ miniflare-R2BucketObject
â”‚   â”‚   â”‚       â”‚       â””â”€â”€ 9720582e742b2d0573c56af6f4fb8eaeeff0b0843e2eaa987d9e5501564a6d80.sqlite
â”‚   â”‚   â”‚       â””â”€â”€ workflows
â”‚   â”‚   â””â”€â”€ tmp
â”‚   â”‚       â”œâ”€â”€ bundle-CeSID1
â”‚   â”‚       â”‚   â”œâ”€â”€ checked-fetch.js
â”‚   â”‚       â”‚   â”œâ”€â”€ middleware-insertion-facade.js
â”‚   â”‚       â”‚   â””â”€â”€ middleware-loader.entry.ts
â”‚   â”‚       â”œâ”€â”€ bundle-JKtFaP
â”‚   â”‚       â”‚   â”œâ”€â”€ checked-fetch.js
â”‚   â”‚       â”‚   â”œâ”€â”€ middleware-insertion-facade.js
â”‚   â”‚       â”‚   â””â”€â”€ middleware-loader.entry.ts
â”‚   â”‚       â”œâ”€â”€ bundle-R5PBgf
â”‚   â”‚       â”‚   â”œâ”€â”€ checked-fetch.js
â”‚   â”‚       â”‚   â”œâ”€â”€ middleware-insertion-facade.js
â”‚   â”‚       â”‚   â””â”€â”€ middleware-loader.entry.ts
â”‚   â”‚       â”œâ”€â”€ bundle-Wv8d8e
â”‚   â”‚       â”‚   â”œâ”€â”€ checked-fetch.js
â”‚   â”‚       â”‚   â”œâ”€â”€ middleware-insertion-facade.js
â”‚   â”‚       â”‚   â””â”€â”€ middleware-loader.entry.ts
â”‚   â”‚       â”œâ”€â”€ bundle-rJpwiW
â”‚   â”‚       â”‚   â”œâ”€â”€ checked-fetch.js
â”‚   â”‚       â”‚   â”œâ”€â”€ middleware-insertion-facade.js
â”‚   â”‚       â”‚   â””â”€â”€ middleware-loader.entry.ts
â”‚   â”‚       â”œâ”€â”€ dev-7CmjSa
â”‚   â”‚       â”‚   â”œâ”€â”€ index.js
â”‚   â”‚       â”‚   â””â”€â”€ index.js.map
â”‚   â”‚       â”œâ”€â”€ dev-8dZu5J
â”‚   â”‚       â”‚   â”œâ”€â”€ index.js
â”‚   â”‚       â”‚   â””â”€â”€ index.js.map
â”‚   â”‚       â”œâ”€â”€ dev-byeFH4
â”‚   â”‚       â”‚   â”œâ”€â”€ index.js
â”‚   â”‚       â”‚   â””â”€â”€ index.js.map
â”‚   â”‚       â””â”€â”€ dev-qPJItj
â”‚   â”‚           â”œâ”€â”€ index.js
â”‚   â”‚           â””â”€â”€ index.js.map
â”‚   â”œâ”€â”€ local_schema.sql
â”‚   â”œâ”€â”€ migrations
â”‚   â”‚   â”œâ”€â”€ 001_schema.sql
â”‚   â”‚   â”œâ”€â”€ 002_align_with_remote.sql
â”‚   â”‚   â”œâ”€â”€ 003_add_photo_url.sql
â”‚   â”‚   â”œâ”€â”€ 004_add_alert_extra_fields.sql
â”‚   â”‚   â”œâ”€â”€ 005_refresh_alerts_view.sql
â”‚   â”‚   â””â”€â”€ 006_add_photo_key.sql
â”‚   â”œâ”€â”€ node_modules
â”‚   â”‚   â”œâ”€â”€ .cache
â”‚   â”‚   â”‚   â””â”€â”€ wrangler
â”‚   â”‚   â”‚       â””â”€â”€ wrangler-account.json
â”‚   â”‚   â”œâ”€â”€ .mf
â”‚   â”‚   â”‚   â””â”€â”€ cf.json
â”‚   â”‚   â””â”€â”€ .package-lock.json
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ remote_schema.sql
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ tmp
â”‚   â”‚   â””â”€â”€ out.txt
â”‚   â””â”€â”€ wrangler.toml
â”œâ”€â”€ ambil-kode-web.mjs
â”œâ”€â”€ buat-struktur.mjs
â”œâ”€â”€ docs
â”‚   â””â”€â”€ WOW-RUNBOOK.md
â”œâ”€â”€ index.html
â”œâ”€â”€ jsconfig.json
â”œâ”€â”€ package.json
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ public
â”‚   â”œâ”€â”€ assets
â”‚   â”‚   â””â”€â”€ images
â”‚   â”œâ”€â”€ manifest.json
â”‚   â”œâ”€â”€ model
â”‚   â”‚   â””â”€â”€ README.txt
â”‚   â””â”€â”€ robots.txt
â”œâ”€â”€ scripts
â”‚   â””â”€â”€ simulate.mjs
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ App.jsx
â”‚   â”œâ”€â”€ Routes.jsx
â”‚   â”œâ”€â”€ ai
â”‚   â”‚   â””â”€â”€ localDiagnosis.js
â”‚   â”œâ”€â”€ components
â”‚   â”‚   â”œâ”€â”€ AppIcon.jsx
â”‚   â”‚   â”œâ”€â”€ AppImage.jsx
â”‚   â”‚   â”œâ”€â”€ ErrorBoundary.jsx
â”‚   â”‚   â”œâ”€â”€ ScrollToTop.jsx
â”‚   â”‚   â”œâ”€â”€ layout
â”‚   â”‚   â”‚   â”œâ”€â”€ DesktopTopNav.jsx
â”‚   â”‚   â”‚   â””â”€â”€ MobileLayout.jsx
â”‚   â”‚   â””â”€â”€ ui
â”‚   â”‚       â”œâ”€â”€ BottomNavigation.jsx
â”‚   â”‚       â”œâ”€â”€ Button.jsx
â”‚   â”‚       â”œâ”€â”€ Checkbox.jsx
â”‚   â”‚       â”œâ”€â”€ Input.jsx
â”‚   â”‚       â”œâ”€â”€ LoadingOverlay.jsx
â”‚   â”‚       â”œâ”€â”€ OfflineStatusBanner.jsx
â”‚   â”‚       â”œâ”€â”€ Select.jsx
â”‚   â”‚       â””â”€â”€ ShareActionSheet.jsx
â”‚   â”œâ”€â”€ index.jsx
â”‚   â”œâ”€â”€ offline
â”‚   â”‚   â”œâ”€â”€ db.js
â”‚   â”‚   â”œâ”€â”€ queueService.js
â”‚   â”‚   â””â”€â”€ replayClient.js
â”‚   â”œâ”€â”€ pages
â”‚   â”‚   â”œâ”€â”€ NotFound.jsx
â”‚   â”‚   â”œâ”€â”€ community-alerts
â”‚   â”‚   â”‚   â”œâ”€â”€ components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AlertCard.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AlertDetailModal.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AlertFilters.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CommunityMap.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ReportPestModal.jsx
â”‚   â”‚   â”‚   â””â”€â”€ index.jsx
â”‚   â”‚   â”œâ”€â”€ diagnosis-history
â”‚   â”‚   â”‚   â”œâ”€â”€ components
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ HistoryCard.jsx
â”‚   â”‚   â”‚   â””â”€â”€ index.jsx
â”‚   â”‚   â”œâ”€â”€ diagnosis-results
â”‚   â”‚   â”‚   â”œâ”€â”€ components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ActionButtons.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CropImageDisplay.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DiagnosisCard.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DiagnosisHeader.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EnvironmentalFactors.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ OfflineIndicator.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RecommendationCard.jsx
â”‚   â”‚   â”‚   â””â”€â”€ index.jsx
â”‚   â”‚   â”œâ”€â”€ farming-calendar
â”‚   â”‚   â”‚   â”œâ”€â”€ components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AddEventModal.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CalendarGrid.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CalendarHeader.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EventDetailsPanel.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EventFilterBar.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MobileCalendarView.jsx
â”‚   â”‚   â”‚   â””â”€â”€ index.jsx
â”‚   â”‚   â”œâ”€â”€ home-dashboard
â”‚   â”‚   â”‚   â”œâ”€â”€ components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CommunityAlertSnippet.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NavigationCard.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ QuickActions.jsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ WelcomeHeader.jsx
â”‚   â”‚   â”‚   â””â”€â”€ index.jsx
â”‚   â”‚   â””â”€â”€ photo-diagnosis
â”‚   â”‚       â”œâ”€â”€ components
â”‚   â”‚       â”‚   â”œâ”€â”€ CameraInterface.jsx
â”‚   â”‚       â”‚   â”œâ”€â”€ DiagnosisForm.jsx
â”‚   â”‚       â”‚   â””â”€â”€ DiagnosisResults.jsx
â”‚   â”‚       â””â”€â”€ index.jsx
â”‚   â”œâ”€â”€ services
â”‚   â”‚   â”œâ”€â”€ alertsApi.js
â”‚   â”‚   â”œâ”€â”€ api.js
â”‚   â”‚   â”œâ”€â”€ diagnosisApi.js
â”‚   â”‚   â”œâ”€â”€ eventsApi.js
â”‚   â”‚   â””â”€â”€ weatherApi.js
â”‚   â”œâ”€â”€ styles
â”‚   â”‚   â”œâ”€â”€ index.css
â”‚   â”‚   â””â”€â”€ tailwind.css
â”‚   â””â”€â”€ utils
â”‚       â””â”€â”€ cn.js
â”œâ”€â”€ struktur_proyek.txt
â”œâ”€â”€ tailwind.config.js
â””â”€â”€ vite.config.mjs



---

## ğŸ§­ Routes

Gunakan `useRoutes` di `Routes.jsx` (atau file routing kamu) untuk menambah halaman baru.  
Halaman **Community Alerts** berada di `/community-alerts`.

---

## ğŸ¨ Styling

- Tailwind CSS + plugins (forms, typography, aspect-ratio, container queries, fluid typography, anim utilities).
- Komponen UI sederhana di `components/ui/*`.
- Ikon via `AppIcon` (Lucide).

---

## ğŸ§ª Testing

```bash
npm run test
```

---

## ğŸ“¦ Build & Deploy

```bash
npm run build   # Vite builds to dist/
```

Untuk API: deploy Cloudflare Worker sesuai setup Wrangler (R2 & D1 binding sama seperti lokal).

---

## ğŸ›Ÿ Troubleshooting

- **Foto tidak muncul / placeholder saja**
  - Cek `src` pada `<img>` di DevTools. Jika terlihat `...%2520...`, berarti **double-encoded**.  
    Pastikan `AlertDetailModal.jsx` memakai `normalizePhotoUrl()` dan **jangan** `encodeURI/encodeURIComponent` lagi pada URL yang sudah lengkap.
  - Jika 404, `AppImage` otomatis jatuh ke `/assets/images/no_image.png`.

- **Banyak error CORS gambar**
  - Dengan `AppImage` (tanpa `fetch/HEAD` & tanpa `crossOrigin`), **tidak** akan ada error CORS saat menampilkan gambar dari R2.  
    CORS hanya masalah saat *membaca pixel canvas*â€”kita tidak melakukan itu.

- **Console ada `net::ERR_BLOCKED_BY_CLIENT`**
  - Itu dari request uji CSP Google Maps (`gen_204`) yang diblokir extension/ad-block. Aman diabaikan.

- **Order of hooks / â€œRendered more hooks than during previous renderâ€**
  - Jangan `return null` di awal render **setelah** memanggil hooks yang jumlahnya berbeda tergantung kondisi.  
    Di modal kita, komponen selalu render; visibilitas dikontrol dengan kelas (`opacity / pointer-events`).

---

## ğŸ™ Credits

- Built by **PT. AiTi Global Nexus**
- Powered by **React + Vite**
- Backend: **Cloudflare Workers (D1 + R2)**
- Styled with **Tailwind CSS**





--- File: ./index.html ---

<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>ai-tani-kupang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Web site created using create-react-app" />
  <link rel="icon" href="/favicon.ico" />
  <link rel="manifest" href="/manifest.json" />

</head>

<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div class="dhiwise-code" id="root"></div>
  <script type="module" src="/src/index.jsx"></script>
</body>

</html>


--- File: ./jsconfig.json ---

{
  "compilerOptions": {
    "baseUrl": "./src"
  }
}



--- File: ./package.json ---

{
  "name": "ai-tani-kupang",
  "version": "0.1.0",
  "private": true,
  "rocketCritical": {
    "dependencies": [
      "@dhiwise/component-tagger",
      "react",
      "react-dom",
      "@reduxjs/toolkit",
      "redux",
      "react-router-dom"
    ],
    "devDependencies": [
      "@vitejs/plugin-react",
      "vite",
      "vite-tsconfig-paths",
      "tailwindcss",
      "autoprefixer",
      "postcss"
    ],
    "scripts": [
      "start",
      "build",
      "serve"
    ],
    "warning": "ğŸš¨ CRITICAL: DO NOT REMOVE OR MODIFY ABOVE DEPENDENCIES - Required for app functionality"
  },
  "dependencies": {
    "@dhiwise/component-tagger": "^1.0.10",
    "@radix-ui/react-slot": "^1.2.3",
    "@reduxjs/toolkit": "^2.6.1",
    "@tailwindcss/forms": "^0.5.7",
    "@testing-library/jest-dom": "^5.15.1",
    "@testing-library/react": "^11.2.7",
    "@testing-library/user-event": "^12.8.3",
    "axios": "^1.8.4",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "d3": "^7.9.0",
    "date-fns": "^4.1.0",
    "dotenv": "^16.0.1",
    "framer-motion": "^10.16.4",
    "idb": "^8.0.3",
    "leaflet": "^1.9.4",
    "lucide-react": "^0.484.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-helmet": "^6.1.0",
    "react-hook-form": "^7.55.0",
    "react-hot-toast": "^2.6.0",
    "react-leaflet": "^5.0.0",
    "react-redux": "^9.2.0",
    "react-router-dom": "6.0.2",
    "react-router-hash-link": "^2.4.3",
    "recharts": "^2.15.2",
    "redux": "^5.0.1",
    "tailwind-merge": "^3.3.1",
    "tailwindcss-animate": "^1.0.7",
    "tailwindcss-elevation": "^2.0.0",
    "tailwindcss-fluid-type": "^2.0.7"
  },
  "scripts": {
    "start": "vite",
    "build": "vite build --sourcemap",
    "serve": "vite preview",
    "typecheck": "node -e \"console.log('Typecheck (JSDoc) OK')\"",
    "test": "vitest run --coverage",
    "test:watch": "vitest",
    "test:ui": "vitest --ui"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  },
  "devDependencies": {
    "@tailwindcss/aspect-ratio": "^0.4.2",
    "@tailwindcss/container-queries": "^0.1.1",
    "@tailwindcss/line-clamp": "^0.1.0",
    "@tailwindcss/typography": "^0.5.16",
    "@tensorflow/tfjs": "4.22.0",
    "@vitejs/plugin-react": "4.3.4",
    "@vitest/coverage-v8": "^4.0.8",
    "autoprefixer": "10.4.2",
    "jsdom": "^27.1.0",
    "postcss": "8.4.8",
    "tailwindcss": "3.4.6",
    "vite": "5.0.0",
    "vite-tsconfig-paths": "3.6.0",
    "vitest": "^4.0.8"
  },
  "packageManager": "pnpm@9.12.3+sha512.cce0f9de9c5a7c95bef944169cc5dfe8741abfb145078c0d508b868056848a87c81e626246cb60967cbd7fd29a6c062ef73ff840d96b3c86c40ac92cf4a813ee"
}



--- File: ./postcss.config.js ---

module.exports = {
  plugins: {
    "tailwindcss/nesting": {},
    tailwindcss: {},
    autoprefixer: {},
  },
};



--- File: ./public/manifest.json ---

{
  "short_name": "ai-tani-kupang",
  "name": "ai-tani-kupang",
  "icons": [
    {
      "src": "favicon.ico",
      "sizes": "64x64 32x32 24x24 16x16",
      "type": "image/x-icon"
    }
  ],
  "start_url": ".",
  "display": "standalone",
  "theme_color": "#000000",
  "background_color": "#ffffff"
}



--- File: ./public/model/README.txt ---

Place your TensorFlow.js GraphModel here as `model.json` with weights shards.
Path expected by the app: /model/model.json
If missing, the app will use a safe mock fallback for predictions.



--- File: ./public/model/model.json ---

{"format":"layers-model","generatedBy":"keras v3.10.0","convertedBy":"TensorFlow.js Converter v4.22.0","modelTopology":{"keras_version":"3.10.0","backend":"tensorflow","model_config":{"class_name":"Sequential","config":{"name":"sequential","trainable":true,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"layers":[{"class_name":"InputLayer","config":{"dtype":"float32","sparse":false,"ragged":false,"name":"input_layer_1","batch_input_shape":[null,224,224,3]}},{"class_name":"RandomFlip","config":{"name":"random_flip","trainable":true,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"seed":null,"mode":"horizontal","data_format":"channels_last"}},{"class_name":"RandomRotation","config":{"name":"random_rotation","trainable":true,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"factor":[-0.1,0.1],"data_format":"channels_last","fill_mode":"reflect","fill_value":0,"interpolation":"bilinear","seed":null}},{"class_name":"Functional","config":{"name":"mobilenetv2_1.00_224","trainable":false,"layers":[{"class_name":"InputLayer","config":{"dtype":"float32","sparse":false,"ragged":false,"name":"input_layer","batch_input_shape":[null,224,224,3]},"name":"input_layer","inbound_nodes":[]},{"class_name":"Conv2D","config":{"name":"Conv1","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":32,"kernel_size":[3,3],"strides":[2,2],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"Conv1","inbound_nodes":[[[["input_layer",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"bn_Conv1","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"bn_Conv1","inbound_nodes":[[[["Conv1",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"Conv1_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"Conv1_relu","inbound_nodes":[[[["bn_Conv1",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"expanded_conv_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"expanded_conv_depthwise","inbound_nodes":[[[["Conv1_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"expanded_conv_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"expanded_conv_depthwise_BN","inbound_nodes":[[[["expanded_conv_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"expanded_conv_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"expanded_conv_depthwise_relu","inbound_nodes":[[[["expanded_conv_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"expanded_conv_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":16,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"expanded_conv_project","inbound_nodes":[[[["expanded_conv_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"expanded_conv_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"expanded_conv_project_BN","inbound_nodes":[[[["expanded_conv_project",0,0,{"mask":null}]]]]},{"class_name":"Conv2D","config":{"name":"block_1_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":96,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_1_expand","inbound_nodes":[[[["expanded_conv_project_BN",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_1_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_1_expand_BN","inbound_nodes":[[[["block_1_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_1_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_1_expand_relu","inbound_nodes":[[[["block_1_expand_BN",0,0,{}]]]]},{"class_name":"ZeroPadding2D","config":{"name":"block_1_pad","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"padding":[[0,1],[0,1]],"data_format":"channels_last"},"name":"block_1_pad","inbound_nodes":[[[["block_1_expand_relu",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_1_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[2,2],"padding":"valid","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_1_depthwise","inbound_nodes":[[[["block_1_pad",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_1_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_1_depthwise_BN","inbound_nodes":[[[["block_1_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_1_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_1_depthwise_relu","inbound_nodes":[[[["block_1_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_1_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":24,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_1_project","inbound_nodes":[[[["block_1_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_1_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_1_project_BN","inbound_nodes":[[[["block_1_project",0,0,{"mask":null}]]]]},{"class_name":"Conv2D","config":{"name":"block_2_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":144,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_2_expand","inbound_nodes":[[[["block_1_project_BN",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_2_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_2_expand_BN","inbound_nodes":[[[["block_2_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_2_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_2_expand_relu","inbound_nodes":[[[["block_2_expand_BN",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_2_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_2_depthwise","inbound_nodes":[[[["block_2_expand_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_2_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_2_depthwise_BN","inbound_nodes":[[[["block_2_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_2_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_2_depthwise_relu","inbound_nodes":[[[["block_2_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_2_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":24,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_2_project","inbound_nodes":[[[["block_2_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_2_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_2_project_BN","inbound_nodes":[[[["block_2_project",0,0,{"mask":null}]]]]},{"class_name":"Add","config":{"name":"block_2_add","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null}},"name":"block_2_add","inbound_nodes":[[[]]]},{"class_name":"Conv2D","config":{"name":"block_3_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":144,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_3_expand","inbound_nodes":[[[["block_2_add",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_3_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_3_expand_BN","inbound_nodes":[[[["block_3_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_3_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_3_expand_relu","inbound_nodes":[[[["block_3_expand_BN",0,0,{}]]]]},{"class_name":"ZeroPadding2D","config":{"name":"block_3_pad","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"padding":[[0,1],[0,1]],"data_format":"channels_last"},"name":"block_3_pad","inbound_nodes":[[[["block_3_expand_relu",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_3_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[2,2],"padding":"valid","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_3_depthwise","inbound_nodes":[[[["block_3_pad",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_3_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_3_depthwise_BN","inbound_nodes":[[[["block_3_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_3_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_3_depthwise_relu","inbound_nodes":[[[["block_3_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_3_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":32,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_3_project","inbound_nodes":[[[["block_3_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_3_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_3_project_BN","inbound_nodes":[[[["block_3_project",0,0,{"mask":null}]]]]},{"class_name":"Conv2D","config":{"name":"block_4_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":192,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_4_expand","inbound_nodes":[[[["block_3_project_BN",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_4_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_4_expand_BN","inbound_nodes":[[[["block_4_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_4_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_4_expand_relu","inbound_nodes":[[[["block_4_expand_BN",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_4_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_4_depthwise","inbound_nodes":[[[["block_4_expand_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_4_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_4_depthwise_BN","inbound_nodes":[[[["block_4_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_4_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_4_depthwise_relu","inbound_nodes":[[[["block_4_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_4_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":32,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_4_project","inbound_nodes":[[[["block_4_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_4_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_4_project_BN","inbound_nodes":[[[["block_4_project",0,0,{"mask":null}]]]]},{"class_name":"Add","config":{"name":"block_4_add","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null}},"name":"block_4_add","inbound_nodes":[[[]]]},{"class_name":"Conv2D","config":{"name":"block_5_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":192,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_5_expand","inbound_nodes":[[[["block_4_add",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_5_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_5_expand_BN","inbound_nodes":[[[["block_5_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_5_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_5_expand_relu","inbound_nodes":[[[["block_5_expand_BN",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_5_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_5_depthwise","inbound_nodes":[[[["block_5_expand_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_5_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_5_depthwise_BN","inbound_nodes":[[[["block_5_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_5_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_5_depthwise_relu","inbound_nodes":[[[["block_5_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_5_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":32,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_5_project","inbound_nodes":[[[["block_5_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_5_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_5_project_BN","inbound_nodes":[[[["block_5_project",0,0,{"mask":null}]]]]},{"class_name":"Add","config":{"name":"block_5_add","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null}},"name":"block_5_add","inbound_nodes":[[[]]]},{"class_name":"Conv2D","config":{"name":"block_6_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":192,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_6_expand","inbound_nodes":[[[["block_5_add",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_6_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_6_expand_BN","inbound_nodes":[[[["block_6_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_6_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_6_expand_relu","inbound_nodes":[[[["block_6_expand_BN",0,0,{}]]]]},{"class_name":"ZeroPadding2D","config":{"name":"block_6_pad","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"padding":[[0,1],[0,1]],"data_format":"channels_last"},"name":"block_6_pad","inbound_nodes":[[[["block_6_expand_relu",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_6_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[2,2],"padding":"valid","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_6_depthwise","inbound_nodes":[[[["block_6_pad",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_6_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_6_depthwise_BN","inbound_nodes":[[[["block_6_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_6_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_6_depthwise_relu","inbound_nodes":[[[["block_6_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_6_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":64,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_6_project","inbound_nodes":[[[["block_6_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_6_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_6_project_BN","inbound_nodes":[[[["block_6_project",0,0,{"mask":null}]]]]},{"class_name":"Conv2D","config":{"name":"block_7_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":384,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_7_expand","inbound_nodes":[[[["block_6_project_BN",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_7_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_7_expand_BN","inbound_nodes":[[[["block_7_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_7_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_7_expand_relu","inbound_nodes":[[[["block_7_expand_BN",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_7_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_7_depthwise","inbound_nodes":[[[["block_7_expand_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_7_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_7_depthwise_BN","inbound_nodes":[[[["block_7_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_7_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_7_depthwise_relu","inbound_nodes":[[[["block_7_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_7_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":64,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_7_project","inbound_nodes":[[[["block_7_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_7_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_7_project_BN","inbound_nodes":[[[["block_7_project",0,0,{"mask":null}]]]]},{"class_name":"Add","config":{"name":"block_7_add","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null}},"name":"block_7_add","inbound_nodes":[[[]]]},{"class_name":"Conv2D","config":{"name":"block_8_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":384,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_8_expand","inbound_nodes":[[[["block_7_add",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_8_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_8_expand_BN","inbound_nodes":[[[["block_8_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_8_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_8_expand_relu","inbound_nodes":[[[["block_8_expand_BN",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_8_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_8_depthwise","inbound_nodes":[[[["block_8_expand_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_8_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_8_depthwise_BN","inbound_nodes":[[[["block_8_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_8_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_8_depthwise_relu","inbound_nodes":[[[["block_8_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_8_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":64,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_8_project","inbound_nodes":[[[["block_8_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_8_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_8_project_BN","inbound_nodes":[[[["block_8_project",0,0,{"mask":null}]]]]},{"class_name":"Add","config":{"name":"block_8_add","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null}},"name":"block_8_add","inbound_nodes":[[[]]]},{"class_name":"Conv2D","config":{"name":"block_9_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":384,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_9_expand","inbound_nodes":[[[["block_8_add",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_9_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_9_expand_BN","inbound_nodes":[[[["block_9_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_9_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_9_expand_relu","inbound_nodes":[[[["block_9_expand_BN",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_9_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_9_depthwise","inbound_nodes":[[[["block_9_expand_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_9_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_9_depthwise_BN","inbound_nodes":[[[["block_9_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_9_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_9_depthwise_relu","inbound_nodes":[[[["block_9_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_9_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":64,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_9_project","inbound_nodes":[[[["block_9_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_9_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_9_project_BN","inbound_nodes":[[[["block_9_project",0,0,{"mask":null}]]]]},{"class_name":"Add","config":{"name":"block_9_add","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null}},"name":"block_9_add","inbound_nodes":[[[]]]},{"class_name":"Conv2D","config":{"name":"block_10_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":384,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_10_expand","inbound_nodes":[[[["block_9_add",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_10_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_10_expand_BN","inbound_nodes":[[[["block_10_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_10_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_10_expand_relu","inbound_nodes":[[[["block_10_expand_BN",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_10_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_10_depthwise","inbound_nodes":[[[["block_10_expand_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_10_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_10_depthwise_BN","inbound_nodes":[[[["block_10_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_10_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_10_depthwise_relu","inbound_nodes":[[[["block_10_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_10_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":96,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_10_project","inbound_nodes":[[[["block_10_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_10_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_10_project_BN","inbound_nodes":[[[["block_10_project",0,0,{"mask":null}]]]]},{"class_name":"Conv2D","config":{"name":"block_11_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":576,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_11_expand","inbound_nodes":[[[["block_10_project_BN",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_11_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_11_expand_BN","inbound_nodes":[[[["block_11_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_11_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_11_expand_relu","inbound_nodes":[[[["block_11_expand_BN",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_11_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_11_depthwise","inbound_nodes":[[[["block_11_expand_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_11_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_11_depthwise_BN","inbound_nodes":[[[["block_11_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_11_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_11_depthwise_relu","inbound_nodes":[[[["block_11_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_11_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":96,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_11_project","inbound_nodes":[[[["block_11_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_11_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_11_project_BN","inbound_nodes":[[[["block_11_project",0,0,{"mask":null}]]]]},{"class_name":"Add","config":{"name":"block_11_add","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null}},"name":"block_11_add","inbound_nodes":[[[]]]},{"class_name":"Conv2D","config":{"name":"block_12_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":576,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_12_expand","inbound_nodes":[[[["block_11_add",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_12_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_12_expand_BN","inbound_nodes":[[[["block_12_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_12_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_12_expand_relu","inbound_nodes":[[[["block_12_expand_BN",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_12_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_12_depthwise","inbound_nodes":[[[["block_12_expand_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_12_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_12_depthwise_BN","inbound_nodes":[[[["block_12_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_12_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_12_depthwise_relu","inbound_nodes":[[[["block_12_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_12_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":96,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_12_project","inbound_nodes":[[[["block_12_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_12_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_12_project_BN","inbound_nodes":[[[["block_12_project",0,0,{"mask":null}]]]]},{"class_name":"Add","config":{"name":"block_12_add","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null}},"name":"block_12_add","inbound_nodes":[[[]]]},{"class_name":"Conv2D","config":{"name":"block_13_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":576,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_13_expand","inbound_nodes":[[[["block_12_add",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_13_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_13_expand_BN","inbound_nodes":[[[["block_13_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_13_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_13_expand_relu","inbound_nodes":[[[["block_13_expand_BN",0,0,{}]]]]},{"class_name":"ZeroPadding2D","config":{"name":"block_13_pad","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"padding":[[0,1],[0,1]],"data_format":"channels_last"},"name":"block_13_pad","inbound_nodes":[[[["block_13_expand_relu",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_13_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[2,2],"padding":"valid","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_13_depthwise","inbound_nodes":[[[["block_13_pad",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_13_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_13_depthwise_BN","inbound_nodes":[[[["block_13_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_13_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_13_depthwise_relu","inbound_nodes":[[[["block_13_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_13_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":160,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_13_project","inbound_nodes":[[[["block_13_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_13_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_13_project_BN","inbound_nodes":[[[["block_13_project",0,0,{"mask":null}]]]]},{"class_name":"Conv2D","config":{"name":"block_14_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":960,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_14_expand","inbound_nodes":[[[["block_13_project_BN",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_14_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_14_expand_BN","inbound_nodes":[[[["block_14_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_14_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_14_expand_relu","inbound_nodes":[[[["block_14_expand_BN",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_14_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_14_depthwise","inbound_nodes":[[[["block_14_expand_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_14_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_14_depthwise_BN","inbound_nodes":[[[["block_14_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_14_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_14_depthwise_relu","inbound_nodes":[[[["block_14_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_14_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":160,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_14_project","inbound_nodes":[[[["block_14_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_14_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_14_project_BN","inbound_nodes":[[[["block_14_project",0,0,{"mask":null}]]]]},{"class_name":"Add","config":{"name":"block_14_add","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null}},"name":"block_14_add","inbound_nodes":[[[]]]},{"class_name":"Conv2D","config":{"name":"block_15_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":960,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_15_expand","inbound_nodes":[[[["block_14_add",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_15_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_15_expand_BN","inbound_nodes":[[[["block_15_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_15_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_15_expand_relu","inbound_nodes":[[[["block_15_expand_BN",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_15_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_15_depthwise","inbound_nodes":[[[["block_15_expand_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_15_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_15_depthwise_BN","inbound_nodes":[[[["block_15_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_15_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_15_depthwise_relu","inbound_nodes":[[[["block_15_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_15_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":160,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_15_project","inbound_nodes":[[[["block_15_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_15_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_15_project_BN","inbound_nodes":[[[["block_15_project",0,0,{"mask":null}]]]]},{"class_name":"Add","config":{"name":"block_15_add","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null}},"name":"block_15_add","inbound_nodes":[[[]]]},{"class_name":"Conv2D","config":{"name":"block_16_expand","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":960,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_16_expand","inbound_nodes":[[[["block_15_add",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_16_expand_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_16_expand_BN","inbound_nodes":[[[["block_16_expand",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_16_expand_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_16_expand_relu","inbound_nodes":[[[["block_16_expand_BN",0,0,{}]]]]},{"class_name":"DepthwiseConv2D","config":{"name":"block_16_depthwise","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"depth_multiplier":1,"kernel_size":[3,3],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"activation":"linear","use_bias":false,"depthwise_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"depthwise_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"depthwise_constraint":null,"bias_constraint":null},"name":"block_16_depthwise","inbound_nodes":[[[["block_16_expand_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_16_depthwise_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_16_depthwise_BN","inbound_nodes":[[[["block_16_depthwise",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"block_16_depthwise_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"block_16_depthwise_relu","inbound_nodes":[[[["block_16_depthwise_BN",0,0,{}]]]]},{"class_name":"Conv2D","config":{"name":"block_16_project","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":320,"kernel_size":[1,1],"strides":[1,1],"padding":"same","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"block_16_project","inbound_nodes":[[[["block_16_depthwise_relu",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"block_16_project_BN","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"block_16_project_BN","inbound_nodes":[[[["block_16_project",0,0,{"mask":null}]]]]},{"class_name":"Conv2D","config":{"name":"Conv_1","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"filters":1280,"kernel_size":[1,1],"strides":[1,1],"padding":"valid","data_format":"channels_last","dilation_rate":[1,1],"groups":1,"activation":"linear","use_bias":false,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"activity_regularizer":null,"kernel_constraint":null,"bias_constraint":null},"name":"Conv_1","inbound_nodes":[[[["block_16_project_BN",0,0,{}]]]]},{"class_name":"BatchNormalization","config":{"name":"Conv_1_bn","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"axis":-1,"momentum":0.999,"epsilon":0.001,"center":true,"scale":true,"beta_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"gamma_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"moving_mean_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"moving_variance_initializer":{"module":"keras.initializers","class_name":"Ones","config":{},"registered_name":null},"beta_regularizer":null,"gamma_regularizer":null,"beta_constraint":null,"gamma_constraint":null,"synchronized":false},"name":"Conv_1_bn","inbound_nodes":[[[["Conv_1",0,0,{"mask":null}]]]]},{"class_name":"ReLU","config":{"name":"out_relu","trainable":false,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"max_value":6,"negative_slope":0,"threshold":0},"name":"out_relu","inbound_nodes":[[[["Conv_1_bn",0,0,{}]]]]}],"input_layers":[["input_layer",0,0]],"output_layers":[["out_relu",0,0]]}},{"class_name":"GlobalAveragePooling2D","config":{"name":"global_average_pooling2d","trainable":true,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"data_format":"channels_last","keepdims":false}},{"class_name":"Dropout","config":{"name":"dropout","trainable":true,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"rate":0.2,"seed":null,"noise_shape":null}},{"class_name":"Dense","config":{"name":"dense","trainable":true,"dtype":{"module":"keras","class_name":"DTypePolicy","config":{"name":"float32"},"registered_name":null},"units":4,"activation":"softmax","use_bias":true,"kernel_initializer":{"module":"keras.initializers","class_name":"GlorotUniform","config":{"seed":null},"registered_name":null},"bias_initializer":{"module":"keras.initializers","class_name":"Zeros","config":{},"registered_name":null},"kernel_regularizer":null,"bias_regularizer":null,"kernel_constraint":null,"bias_constraint":null}}],"build_input_shape":[null,224,224,3]}},"training_config":{"loss":{"class_name":"SparseCategoricalCrossentropy","config":{"name":"sparse_categorical_crossentropy","reduction":"sum_over_batch_size","from_logits":false,"ignore_class":null}},"loss_weights":null,"metrics":["accuracy"],"weighted_metrics":null,"run_eagerly":false,"steps_per_execution":1,"jit_compile":false,"optimizer_config":{"class_name":"Adam","config":{"name":"adam","learning_rate":0.0010000000474974513,"weight_decay":null,"clipnorm":null,"global_clipnorm":null,"clipvalue":null,"use_ema":false,"ema_momentum":0.99,"ema_overwrite_frequency":null,"loss_scale_factor":null,"gradient_accumulation_steps":null,"beta_1":0.9,"beta_2":0.999,"epsilon":1e-7,"amsgrad":false}}}},"weightsManifest":[{"paths":["group1-shard1of3.bin","group1-shard2of3.bin","group1-shard3of3.bin"],"weights":[{"name":"sequential/dense/kernel","shape":[1280,4],"dtype":"float32"},{"name":"sequential/dense/bias","shape":[4],"dtype":"float32"},{"name":"Conv1/kernel","shape":[3,3,3,32],"dtype":"float32"},{"name":"bn_Conv1/gamma","shape":[32],"dtype":"float32"},{"name":"bn_Conv1/beta","shape":[32],"dtype":"float32"},{"name":"bn_Conv1/moving_mean","shape":[32],"dtype":"float32"},{"name":"bn_Conv1/moving_variance","shape":[32],"dtype":"float32"},{"name":"expanded_conv_depthwise/kernel","shape":[3,3,32,1],"dtype":"float32"},{"name":"expanded_conv_depthwise_BN/gamma","shape":[32],"dtype":"float32"},{"name":"expanded_conv_depthwise_BN/beta","shape":[32],"dtype":"float32"},{"name":"expanded_conv_depthwise_BN/moving_mean","shape":[32],"dtype":"float32"},{"name":"expanded_conv_depthwise_BN/moving_variance","shape":[32],"dtype":"float32"},{"name":"expanded_conv_project/kernel","shape":[1,1,32,16],"dtype":"float32"},{"name":"expanded_conv_project_BN/gamma","shape":[16],"dtype":"float32"},{"name":"expanded_conv_project_BN/beta","shape":[16],"dtype":"float32"},{"name":"expanded_conv_project_BN/moving_mean","shape":[16],"dtype":"float32"},{"name":"expanded_conv_project_BN/moving_variance","shape":[16],"dtype":"float32"},{"name":"block_1_expand/kernel","shape":[1,1,16,96],"dtype":"float32"},{"name":"block_1_expand_BN/gamma","shape":[96],"dtype":"float32"},{"name":"block_1_expand_BN/beta","shape":[96],"dtype":"float32"},{"name":"block_1_expand_BN/moving_mean","shape":[96],"dtype":"float32"},{"name":"block_1_expand_BN/moving_variance","shape":[96],"dtype":"float32"},{"name":"block_1_depthwise/kernel","shape":[3,3,96,1],"dtype":"float32"},{"name":"block_1_depthwise_BN/gamma","shape":[96],"dtype":"float32"},{"name":"block_1_depthwise_BN/beta","shape":[96],"dtype":"float32"},{"name":"block_1_depthwise_BN/moving_mean","shape":[96],"dtype":"float32"},{"name":"block_1_depthwise_BN/moving_variance","shape":[96],"dtype":"float32"},{"name":"block_1_project/kernel","shape":[1,1,96,24],"dtype":"float32"},{"name":"block_1_project_BN/gamma","shape":[24],"dtype":"float32"},{"name":"block_1_project_BN/beta","shape":[24],"dtype":"float32"},{"name":"block_1_project_BN/moving_mean","shape":[24],"dtype":"float32"},{"name":"block_1_project_BN/moving_variance","shape":[24],"dtype":"float32"},{"name":"block_2_expand/kernel","shape":[1,1,24,144],"dtype":"float32"},{"name":"block_2_expand_BN/gamma","shape":[144],"dtype":"float32"},{"name":"block_2_expand_BN/beta","shape":[144],"dtype":"float32"},{"name":"block_2_expand_BN/moving_mean","shape":[144],"dtype":"float32"},{"name":"block_2_expand_BN/moving_variance","shape":[144],"dtype":"float32"},{"name":"block_2_depthwise/kernel","shape":[3,3,144,1],"dtype":"float32"},{"name":"block_2_depthwise_BN/gamma","shape":[144],"dtype":"float32"},{"name":"block_2_depthwise_BN/beta","shape":[144],"dtype":"float32"},{"name":"block_2_depthwise_BN/moving_mean","shape":[144],"dtype":"float32"},{"name":"block_2_depthwise_BN/moving_variance","shape":[144],"dtype":"float32"},{"name":"block_2_project/kernel","shape":[1,1,144,24],"dtype":"float32"},{"name":"block_2_project_BN/gamma","shape":[24],"dtype":"float32"},{"name":"block_2_project_BN/beta","shape":[24],"dtype":"float32"},{"name":"block_2_project_BN/moving_mean","shape":[24],"dtype":"float32"},{"name":"block_2_project_BN/moving_variance","shape":[24],"dtype":"float32"},{"name":"block_3_expand/kernel","shape":[1,1,24,144],"dtype":"float32"},{"name":"block_3_expand_BN/gamma","shape":[144],"dtype":"float32"},{"name":"block_3_expand_BN/beta","shape":[144],"dtype":"float32"},{"name":"block_3_expand_BN/moving_mean","shape":[144],"dtype":"float32"},{"name":"block_3_expand_BN/moving_variance","shape":[144],"dtype":"float32"},{"name":"block_3_depthwise/kernel","shape":[3,3,144,1],"dtype":"float32"},{"name":"block_3_depthwise_BN/gamma","shape":[144],"dtype":"float32"},{"name":"block_3_depthwise_BN/beta","shape":[144],"dtype":"float32"},{"name":"block_3_depthwise_BN/moving_mean","shape":[144],"dtype":"float32"},{"name":"block_3_depthwise_BN/moving_variance","shape":[144],"dtype":"float32"},{"name":"block_3_project/kernel","shape":[1,1,144,32],"dtype":"float32"},{"name":"block_3_project_BN/gamma","shape":[32],"dtype":"float32"},{"name":"block_3_project_BN/beta","shape":[32],"dtype":"float32"},{"name":"block_3_project_BN/moving_mean","shape":[32],"dtype":"float32"},{"name":"block_3_project_BN/moving_variance","shape":[32],"dtype":"float32"},{"name":"block_4_expand/kernel","shape":[1,1,32,192],"dtype":"float32"},{"name":"block_4_expand_BN/gamma","shape":[192],"dtype":"float32"},{"name":"block_4_expand_BN/beta","shape":[192],"dtype":"float32"},{"name":"block_4_expand_BN/moving_mean","shape":[192],"dtype":"float32"},{"name":"block_4_expand_BN/moving_variance","shape":[192],"dtype":"float32"},{"name":"block_4_depthwise/kernel","shape":[3,3,192,1],"dtype":"float32"},{"name":"block_4_depthwise_BN/gamma","shape":[192],"dtype":"float32"},{"name":"block_4_depthwise_BN/beta","shape":[192],"dtype":"float32"},{"name":"block_4_depthwise_BN/moving_mean","shape":[192],"dtype":"float32"},{"name":"block_4_depthwise_BN/moving_variance","shape":[192],"dtype":"float32"},{"name":"block_4_project/kernel","shape":[1,1,192,32],"dtype":"float32"},{"name":"block_4_project_BN/gamma","shape":[32],"dtype":"float32"},{"name":"block_4_project_BN/beta","shape":[32],"dtype":"float32"},{"name":"block_4_project_BN/moving_mean","shape":[32],"dtype":"float32"},{"name":"block_4_project_BN/moving_variance","shape":[32],"dtype":"float32"},{"name":"block_5_expand/kernel","shape":[1,1,32,192],"dtype":"float32"},{"name":"block_5_expand_BN/gamma","shape":[192],"dtype":"float32"},{"name":"block_5_expand_BN/beta","shape":[192],"dtype":"float32"},{"name":"block_5_expand_BN/moving_mean","shape":[192],"dtype":"float32"},{"name":"block_5_expand_BN/moving_variance","shape":[192],"dtype":"float32"},{"name":"block_5_depthwise/kernel","shape":[3,3,192,1],"dtype":"float32"},{"name":"block_5_depthwise_BN/gamma","shape":[192],"dtype":"float32"},{"name":"block_5_depthwise_BN/beta","shape":[192],"dtype":"float32"},{"name":"block_5_depthwise_BN/moving_mean","shape":[192],"dtype":"float32"},{"name":"block_5_depthwise_BN/moving_variance","shape":[192],"dtype":"float32"},{"name":"block_5_project/kernel","shape":[1,1,192,32],"dtype":"float32"},{"name":"block_5_project_BN/gamma","shape":[32],"dtype":"float32"},{"name":"block_5_project_BN/beta","shape":[32],"dtype":"float32"},{"name":"block_5_project_BN/moving_mean","shape":[32],"dtype":"float32"},{"name":"block_5_project_BN/moving_variance","shape":[32],"dtype":"float32"},{"name":"block_6_expand/kernel","shape":[1,1,32,192],"dtype":"float32"},{"name":"block_6_expand_BN/gamma","shape":[192],"dtype":"float32"},{"name":"block_6_expand_BN/beta","shape":[192],"dtype":"float32"},{"name":"block_6_expand_BN/moving_mean","shape":[192],"dtype":"float32"},{"name":"block_6_expand_BN/moving_variance","shape":[192],"dtype":"float32"},{"name":"block_6_depthwise/kernel","shape":[3,3,192,1],"dtype":"float32"},{"name":"block_6_depthwise_BN/gamma","shape":[192],"dtype":"float32"},{"name":"block_6_depthwise_BN/beta","shape":[192],"dtype":"float32"},{"name":"block_6_depthwise_BN/moving_mean","shape":[192],"dtype":"float32"},{"name":"block_6_depthwise_BN/moving_variance","shape":[192],"dtype":"float32"},{"name":"block_6_project/kernel","shape":[1,1,192,64],"dtype":"float32"},{"name":"block_6_project_BN/gamma","shape":[64],"dtype":"float32"},{"name":"block_6_project_BN/beta","shape":[64],"dtype":"float32"},{"name":"block_6_project_BN/moving_mean","shape":[64],"dtype":"float32"},{"name":"block_6_project_BN/moving_variance","shape":[64],"dtype":"float32"},{"name":"block_7_expand/kernel","shape":[1,1,64,384],"dtype":"float32"},{"name":"block_7_expand_BN/gamma","shape":[384],"dtype":"float32"},{"name":"block_7_expand_BN/beta","shape":[384],"dtype":"float32"},{"name":"block_7_expand_BN/moving_mean","shape":[384],"dtype":"float32"},{"name":"block_7_expand_BN/moving_variance","shape":[384],"dtype":"float32"},{"name":"block_7_depthwise/kernel","shape":[3,3,384,1],"dtype":"float32"},{"name":"block_7_depthwise_BN/gamma","shape":[384],"dtype":"float32"},{"name":"block_7_depthwise_BN/beta","shape":[384],"dtype":"float32"},{"name":"block_7_depthwise_BN/moving_mean","shape":[384],"dtype":"float32"},{"name":"block_7_depthwise_BN/moving_variance","shape":[384],"dtype":"float32"},{"name":"block_7_project/kernel","shape":[1,1,384,64],"dtype":"float32"},{"name":"block_7_project_BN/gamma","shape":[64],"dtype":"float32"},{"name":"block_7_project_BN/beta","shape":[64],"dtype":"float32"},{"name":"block_7_project_BN/moving_mean","shape":[64],"dtype":"float32"},{"name":"block_7_project_BN/moving_variance","shape":[64],"dtype":"float32"},{"name":"block_8_expand/kernel","shape":[1,1,64,384],"dtype":"float32"},{"name":"block_8_expand_BN/gamma","shape":[384],"dtype":"float32"},{"name":"block_8_expand_BN/beta","shape":[384],"dtype":"float32"},{"name":"block_8_expand_BN/moving_mean","shape":[384],"dtype":"float32"},{"name":"block_8_expand_BN/moving_variance","shape":[384],"dtype":"float32"},{"name":"block_8_depthwise/kernel","shape":[3,3,384,1],"dtype":"float32"},{"name":"block_8_depthwise_BN/gamma","shape":[384],"dtype":"float32"},{"name":"block_8_depthwise_BN/beta","shape":[384],"dtype":"float32"},{"name":"block_8_depthwise_BN/moving_mean","shape":[384],"dtype":"float32"},{"name":"block_8_depthwise_BN/moving_variance","shape":[384],"dtype":"float32"},{"name":"block_8_project/kernel","shape":[1,1,384,64],"dtype":"float32"},{"name":"block_8_project_BN/gamma","shape":[64],"dtype":"float32"},{"name":"block_8_project_BN/beta","shape":[64],"dtype":"float32"},{"name":"block_8_project_BN/moving_mean","shape":[64],"dtype":"float32"},{"name":"block_8_project_BN/moving_variance","shape":[64],"dtype":"float32"},{"name":"block_9_expand/kernel","shape":[1,1,64,384],"dtype":"float32"},{"name":"block_9_expand_BN/gamma","shape":[384],"dtype":"float32"},{"name":"block_9_expand_BN/beta","shape":[384],"dtype":"float32"},{"name":"block_9_expand_BN/moving_mean","shape":[384],"dtype":"float32"},{"name":"block_9_expand_BN/moving_variance","shape":[384],"dtype":"float32"},{"name":"block_9_depthwise/kernel","shape":[3,3,384,1],"dtype":"float32"},{"name":"block_9_depthwise_BN/gamma","shape":[384],"dtype":"float32"},{"name":"block_9_depthwise_BN/beta","shape":[384],"dtype":"float32"},{"name":"block_9_depthwise_BN/moving_mean","shape":[384],"dtype":"float32"},{"name":"block_9_depthwise_BN/moving_variance","shape":[384],"dtype":"float32"},{"name":"block_9_project/kernel","shape":[1,1,384,64],"dtype":"float32"},{"name":"block_9_project_BN/gamma","shape":[64],"dtype":"float32"},{"name":"block_9_project_BN/beta","shape":[64],"dtype":"float32"},{"name":"block_9_project_BN/moving_mean","shape":[64],"dtype":"float32"},{"name":"block_9_project_BN/moving_variance","shape":[64],"dtype":"float32"},{"name":"block_10_expand/kernel","shape":[1,1,64,384],"dtype":"float32"},{"name":"block_10_expand_BN/gamma","shape":[384],"dtype":"float32"},{"name":"block_10_expand_BN/beta","shape":[384],"dtype":"float32"},{"name":"block_10_expand_BN/moving_mean","shape":[384],"dtype":"float32"},{"name":"block_10_expand_BN/moving_variance","shape":[384],"dtype":"float32"},{"name":"block_10_depthwise/kernel","shape":[3,3,384,1],"dtype":"float32"},{"name":"block_10_depthwise_BN/gamma","shape":[384],"dtype":"float32"},{"name":"block_10_depthwise_BN/beta","shape":[384],"dtype":"float32"},{"name":"block_10_depthwise_BN/moving_mean","shape":[384],"dtype":"float32"},{"name":"block_10_depthwise_BN/moving_variance","shape":[384],"dtype":"float32"},{"name":"block_10_project/kernel","shape":[1,1,384,96],"dtype":"float32"},{"name":"block_10_project_BN/gamma","shape":[96],"dtype":"float32"},{"name":"block_10_project_BN/beta","shape":[96],"dtype":"float32"},{"name":"block_10_project_BN/moving_mean","shape":[96],"dtype":"float32"},{"name":"block_10_project_BN/moving_variance","shape":[96],"dtype":"float32"},{"name":"block_11_expand/kernel","shape":[1,1,96,576],"dtype":"float32"},{"name":"block_11_expand_BN/gamma","shape":[576],"dtype":"float32"},{"name":"block_11_expand_BN/beta","shape":[576],"dtype":"float32"},{"name":"block_11_expand_BN/moving_mean","shape":[576],"dtype":"float32"},{"name":"block_11_expand_BN/moving_variance","shape":[576],"dtype":"float32"},{"name":"block_11_depthwise/kernel","shape":[3,3,576,1],"dtype":"float32"},{"name":"block_11_depthwise_BN/gamma","shape":[576],"dtype":"float32"},{"name":"block_11_depthwise_BN/beta","shape":[576],"dtype":"float32"},{"name":"block_11_depthwise_BN/moving_mean","shape":[576],"dtype":"float32"},{"name":"block_11_depthwise_BN/moving_variance","shape":[576],"dtype":"float32"},{"name":"block_11_project/kernel","shape":[1,1,576,96],"dtype":"float32"},{"name":"block_11_project_BN/gamma","shape":[96],"dtype":"float32"},{"name":"block_11_project_BN/beta","shape":[96],"dtype":"float32"},{"name":"block_11_project_BN/moving_mean","shape":[96],"dtype":"float32"},{"name":"block_11_project_BN/moving_variance","shape":[96],"dtype":"float32"},{"name":"block_12_expand/kernel","shape":[1,1,96,576],"dtype":"float32"},{"name":"block_12_expand_BN/gamma","shape":[576],"dtype":"float32"},{"name":"block_12_expand_BN/beta","shape":[576],"dtype":"float32"},{"name":"block_12_expand_BN/moving_mean","shape":[576],"dtype":"float32"},{"name":"block_12_expand_BN/moving_variance","shape":[576],"dtype":"float32"},{"name":"block_12_depthwise/kernel","shape":[3,3,576,1],"dtype":"float32"},{"name":"block_12_depthwise_BN/gamma","shape":[576],"dtype":"float32"},{"name":"block_12_depthwise_BN/beta","shape":[576],"dtype":"float32"},{"name":"block_12_depthwise_BN/moving_mean","shape":[576],"dtype":"float32"},{"name":"block_12_depthwise_BN/moving_variance","shape":[576],"dtype":"float32"},{"name":"block_12_project/kernel","shape":[1,1,576,96],"dtype":"float32"},{"name":"block_12_project_BN/gamma","shape":[96],"dtype":"float32"},{"name":"block_12_project_BN/beta","shape":[96],"dtype":"float32"},{"name":"block_12_project_BN/moving_mean","shape":[96],"dtype":"float32"},{"name":"block_12_project_BN/moving_variance","shape":[96],"dtype":"float32"},{"name":"block_13_expand/kernel","shape":[1,1,96,576],"dtype":"float32"},{"name":"block_13_expand_BN/gamma","shape":[576],"dtype":"float32"},{"name":"block_13_expand_BN/beta","shape":[576],"dtype":"float32"},{"name":"block_13_expand_BN/moving_mean","shape":[576],"dtype":"float32"},{"name":"block_13_expand_BN/moving_variance","shape":[576],"dtype":"float32"},{"name":"block_13_depthwise/kernel","shape":[3,3,576,1],"dtype":"float32"},{"name":"block_13_depthwise_BN/gamma","shape":[576],"dtype":"float32"},{"name":"block_13_depthwise_BN/beta","shape":[576],"dtype":"float32"},{"name":"block_13_depthwise_BN/moving_mean","shape":[576],"dtype":"float32"},{"name":"block_13_depthwise_BN/moving_variance","shape":[576],"dtype":"float32"},{"name":"block_13_project/kernel","shape":[1,1,576,160],"dtype":"float32"},{"name":"block_13_project_BN/gamma","shape":[160],"dtype":"float32"},{"name":"block_13_project_BN/beta","shape":[160],"dtype":"float32"},{"name":"block_13_project_BN/moving_mean","shape":[160],"dtype":"float32"},{"name":"block_13_project_BN/moving_variance","shape":[160],"dtype":"float32"},{"name":"block_14_expand/kernel","shape":[1,1,160,960],"dtype":"float32"},{"name":"block_14_expand_BN/gamma","shape":[960],"dtype":"float32"},{"name":"block_14_expand_BN/beta","shape":[960],"dtype":"float32"},{"name":"block_14_expand_BN/moving_mean","shape":[960],"dtype":"float32"},{"name":"block_14_expand_BN/moving_variance","shape":[960],"dtype":"float32"},{"name":"block_14_depthwise/kernel","shape":[3,3,960,1],"dtype":"float32"},{"name":"block_14_depthwise_BN/gamma","shape":[960],"dtype":"float32"},{"name":"block_14_depthwise_BN/beta","shape":[960],"dtype":"float32"},{"name":"block_14_depthwise_BN/moving_mean","shape":[960],"dtype":"float32"},{"name":"block_14_depthwise_BN/moving_variance","shape":[960],"dtype":"float32"},{"name":"block_14_project/kernel","shape":[1,1,960,160],"dtype":"float32"},{"name":"block_14_project_BN/gamma","shape":[160],"dtype":"float32"},{"name":"block_14_project_BN/beta","shape":[160],"dtype":"float32"},{"name":"block_14_project_BN/moving_mean","shape":[160],"dtype":"float32"},{"name":"block_14_project_BN/moving_variance","shape":[160],"dtype":"float32"},{"name":"block_15_expand/kernel","shape":[1,1,160,960],"dtype":"float32"},{"name":"block_15_expand_BN/gamma","shape":[960],"dtype":"float32"},{"name":"block_15_expand_BN/beta","shape":[960],"dtype":"float32"},{"name":"block_15_expand_BN/moving_mean","shape":[960],"dtype":"float32"},{"name":"block_15_expand_BN/moving_variance","shape":[960],"dtype":"float32"},{"name":"block_15_depthwise/kernel","shape":[3,3,960,1],"dtype":"float32"},{"name":"block_15_depthwise_BN/gamma","shape":[960],"dtype":"float32"},{"name":"block_15_depthwise_BN/beta","shape":[960],"dtype":"float32"},{"name":"block_15_depthwise_BN/moving_mean","shape":[960],"dtype":"float32"},{"name":"block_15_depthwise_BN/moving_variance","shape":[960],"dtype":"float32"},{"name":"block_15_project/kernel","shape":[1,1,960,160],"dtype":"float32"},{"name":"block_15_project_BN/gamma","shape":[160],"dtype":"float32"},{"name":"block_15_project_BN/beta","shape":[160],"dtype":"float32"},{"name":"block_15_project_BN/moving_mean","shape":[160],"dtype":"float32"},{"name":"block_15_project_BN/moving_variance","shape":[160],"dtype":"float32"},{"name":"block_16_expand/kernel","shape":[1,1,160,960],"dtype":"float32"},{"name":"block_16_expand_BN/gamma","shape":[960],"dtype":"float32"},{"name":"block_16_expand_BN/beta","shape":[960],"dtype":"float32"},{"name":"block_16_expand_BN/moving_mean","shape":[960],"dtype":"float32"},{"name":"block_16_expand_BN/moving_variance","shape":[960],"dtype":"float32"},{"name":"block_16_depthwise/kernel","shape":[3,3,960,1],"dtype":"float32"},{"name":"block_16_depthwise_BN/gamma","shape":[960],"dtype":"float32"},{"name":"block_16_depthwise_BN/beta","shape":[960],"dtype":"float32"},{"name":"block_16_depthwise_BN/moving_mean","shape":[960],"dtype":"float32"},{"name":"block_16_depthwise_BN/moving_variance","shape":[960],"dtype":"float32"},{"name":"block_16_project/kernel","shape":[1,1,960,320],"dtype":"float32"},{"name":"block_16_project_BN/gamma","shape":[320],"dtype":"float32"},{"name":"block_16_project_BN/beta","shape":[320],"dtype":"float32"},{"name":"block_16_project_BN/moving_mean","shape":[320],"dtype":"float32"},{"name":"block_16_project_BN/moving_variance","shape":[320],"dtype":"float32"},{"name":"Conv_1/kernel","shape":[1,1,320,1280],"dtype":"float32"},{"name":"Conv_1_bn/gamma","shape":[1280],"dtype":"float32"},{"name":"Conv_1_bn/beta","shape":[1280],"dtype":"float32"},{"name":"Conv_1_bn/moving_mean","shape":[1280],"dtype":"float32"},{"name":"Conv_1_bn/moving_variance","shape":[1280],"dtype":"float32"}]}]}


--- File: ./public/model/model.original.json ---

{"format": "layers-model", "generatedBy": "keras v3.10.0", "convertedBy": "TensorFlow.js Converter v4.22.0", "modelTopology": {"keras_version": "3.10.0", "backend": "tensorflow", "model_config": {"class_name": "Sequential", "config": {"name": "sequential", "trainable": true, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "layers": [{"class_name": "InputLayer", "config": {"dtype": "float32", "sparse": false, "ragged": false, "name": "input_layer_1", "batch_input_shape": [null, 224, 224, 3]}}, {"class_name": "RandomFlip", "config": {"name": "random_flip", "trainable": true, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "seed": null, "mode": "horizontal", "data_format": "channels_last"}}, {"class_name": "RandomRotation", "config": {"name": "random_rotation", "trainable": true, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "factor": [-0.1, 0.1], "data_format": "channels_last", "fill_mode": "reflect", "fill_value": 0.0, "interpolation": "bilinear", "seed": null}}, {"class_name": "Functional", "config": {"name": "mobilenetv2_1.00_224", "trainable": false, "layers": [{"class_name": "InputLayer", "config": {"dtype": "float32", "sparse": false, "ragged": false, "name": "input_layer", "batch_input_shape": [null, 224, 224, 3]}, "name": "input_layer", "inbound_nodes": []}, {"class_name": "Conv2D", "config": {"name": "Conv1", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 32, "kernel_size": [3, 3], "strides": [2, 2], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "Conv1", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 224, 224, 3], "dtype": "float32", "keras_history": ["input_layer", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "bn_Conv1", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "bn_Conv1", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 112, 112, 32], "dtype": "float32", "keras_history": ["Conv1", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "Conv1_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "Conv1_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 112, 112, 32], "dtype": "float32", "keras_history": ["bn_Conv1", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "expanded_conv_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "expanded_conv_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 112, 112, 32], "dtype": "float32", "keras_history": ["Conv1_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "expanded_conv_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "expanded_conv_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 112, 112, 32], "dtype": "float32", "keras_history": ["expanded_conv_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "expanded_conv_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "expanded_conv_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 112, 112, 32], "dtype": "float32", "keras_history": ["expanded_conv_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "expanded_conv_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 16, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "expanded_conv_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 112, 112, 32], "dtype": "float32", "keras_history": ["expanded_conv_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "expanded_conv_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "expanded_conv_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 112, 112, 16], "dtype": "float32", "keras_history": ["expanded_conv_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Conv2D", "config": {"name": "block_1_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 96, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_1_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 112, 112, 16], "dtype": "float32", "keras_history": ["expanded_conv_project_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_1_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_1_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 112, 112, 96], "dtype": "float32", "keras_history": ["block_1_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_1_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_1_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 112, 112, 96], "dtype": "float32", "keras_history": ["block_1_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "ZeroPadding2D", "config": {"name": "block_1_pad", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "padding": [[0, 1], [0, 1]], "data_format": "channels_last"}, "name": "block_1_pad", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 112, 112, 96], "dtype": "float32", "keras_history": ["block_1_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_1_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [2, 2], "padding": "valid", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_1_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 113, 113, 96], "dtype": "float32", "keras_history": ["block_1_pad", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_1_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_1_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 96], "dtype": "float32", "keras_history": ["block_1_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_1_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_1_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 96], "dtype": "float32", "keras_history": ["block_1_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_1_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 24, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_1_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 96], "dtype": "float32", "keras_history": ["block_1_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_1_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_1_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 24], "dtype": "float32", "keras_history": ["block_1_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Conv2D", "config": {"name": "block_2_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 144, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_2_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 24], "dtype": "float32", "keras_history": ["block_1_project_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_2_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_2_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 144], "dtype": "float32", "keras_history": ["block_2_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_2_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_2_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 144], "dtype": "float32", "keras_history": ["block_2_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_2_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_2_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 144], "dtype": "float32", "keras_history": ["block_2_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_2_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_2_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 144], "dtype": "float32", "keras_history": ["block_2_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_2_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_2_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 144], "dtype": "float32", "keras_history": ["block_2_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_2_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 24, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_2_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 144], "dtype": "float32", "keras_history": ["block_2_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_2_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_2_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 24], "dtype": "float32", "keras_history": ["block_2_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Add", "config": {"name": "block_2_add", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}}, "name": "block_2_add", "inbound_nodes": [{"args": [[{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 24], "dtype": "float32", "keras_history": ["block_1_project_BN", 0, 0]}}, {"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 24], "dtype": "float32", "keras_history": ["block_2_project_BN", 0, 0]}}]], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_3_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 144, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_3_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 24], "dtype": "float32", "keras_history": ["block_2_add", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_3_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_3_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 144], "dtype": "float32", "keras_history": ["block_3_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_3_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_3_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 144], "dtype": "float32", "keras_history": ["block_3_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "ZeroPadding2D", "config": {"name": "block_3_pad", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "padding": [[0, 1], [0, 1]], "data_format": "channels_last"}, "name": "block_3_pad", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 56, 56, 144], "dtype": "float32", "keras_history": ["block_3_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_3_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [2, 2], "padding": "valid", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_3_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 57, 57, 144], "dtype": "float32", "keras_history": ["block_3_pad", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_3_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_3_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 144], "dtype": "float32", "keras_history": ["block_3_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_3_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_3_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 144], "dtype": "float32", "keras_history": ["block_3_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_3_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 32, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_3_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 144], "dtype": "float32", "keras_history": ["block_3_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_3_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_3_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 32], "dtype": "float32", "keras_history": ["block_3_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Conv2D", "config": {"name": "block_4_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 192, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_4_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 32], "dtype": "float32", "keras_history": ["block_3_project_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_4_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_4_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_4_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_4_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_4_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_4_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_4_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_4_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_4_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_4_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_4_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_4_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_4_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_4_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_4_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_4_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 32, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_4_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_4_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_4_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_4_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 32], "dtype": "float32", "keras_history": ["block_4_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Add", "config": {"name": "block_4_add", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}}, "name": "block_4_add", "inbound_nodes": [{"args": [[{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 32], "dtype": "float32", "keras_history": ["block_3_project_BN", 0, 0]}}, {"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 32], "dtype": "float32", "keras_history": ["block_4_project_BN", 0, 0]}}]], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_5_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 192, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_5_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 32], "dtype": "float32", "keras_history": ["block_4_add", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_5_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_5_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_5_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_5_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_5_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_5_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_5_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_5_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_5_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_5_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_5_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_5_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_5_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_5_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_5_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_5_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 32, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_5_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_5_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_5_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_5_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 32], "dtype": "float32", "keras_history": ["block_5_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Add", "config": {"name": "block_5_add", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}}, "name": "block_5_add", "inbound_nodes": [{"args": [[{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 32], "dtype": "float32", "keras_history": ["block_4_add", 0, 0]}}, {"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 32], "dtype": "float32", "keras_history": ["block_5_project_BN", 0, 0]}}]], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_6_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 192, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_6_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 32], "dtype": "float32", "keras_history": ["block_5_add", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_6_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_6_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_6_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_6_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_6_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_6_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "ZeroPadding2D", "config": {"name": "block_6_pad", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "padding": [[0, 1], [0, 1]], "data_format": "channels_last"}, "name": "block_6_pad", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 28, 28, 192], "dtype": "float32", "keras_history": ["block_6_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_6_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [2, 2], "padding": "valid", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_6_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 29, 29, 192], "dtype": "float32", "keras_history": ["block_6_pad", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_6_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_6_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 192], "dtype": "float32", "keras_history": ["block_6_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_6_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_6_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 192], "dtype": "float32", "keras_history": ["block_6_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_6_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 64, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_6_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 192], "dtype": "float32", "keras_history": ["block_6_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_6_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_6_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_6_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Conv2D", "config": {"name": "block_7_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 384, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_7_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_6_project_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_7_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_7_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_7_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_7_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_7_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_7_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_7_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_7_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_7_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_7_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_7_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_7_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_7_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_7_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_7_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_7_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 64, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_7_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_7_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_7_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_7_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_7_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Add", "config": {"name": "block_7_add", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}}, "name": "block_7_add", "inbound_nodes": [{"args": [[{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_6_project_BN", 0, 0]}}, {"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_7_project_BN", 0, 0]}}]], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_8_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 384, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_8_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_7_add", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_8_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_8_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_8_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_8_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_8_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_8_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_8_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_8_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_8_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_8_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_8_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_8_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_8_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_8_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_8_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_8_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 64, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_8_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_8_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_8_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_8_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_8_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Add", "config": {"name": "block_8_add", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}}, "name": "block_8_add", "inbound_nodes": [{"args": [[{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_7_add", 0, 0]}}, {"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_8_project_BN", 0, 0]}}]], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_9_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 384, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_9_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_8_add", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_9_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_9_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_9_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_9_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_9_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_9_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_9_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_9_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_9_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_9_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_9_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_9_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_9_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_9_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_9_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_9_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 64, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_9_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_9_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_9_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_9_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_9_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Add", "config": {"name": "block_9_add", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}}, "name": "block_9_add", "inbound_nodes": [{"args": [[{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_8_add", 0, 0]}}, {"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_9_project_BN", 0, 0]}}]], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_10_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 384, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_10_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 64], "dtype": "float32", "keras_history": ["block_9_add", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_10_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_10_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_10_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_10_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_10_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_10_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_10_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_10_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_10_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_10_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_10_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_10_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_10_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_10_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_10_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_10_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 96, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_10_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 384], "dtype": "float32", "keras_history": ["block_10_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_10_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_10_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 96], "dtype": "float32", "keras_history": ["block_10_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Conv2D", "config": {"name": "block_11_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 576, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_11_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 96], "dtype": "float32", "keras_history": ["block_10_project_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_11_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_11_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_11_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_11_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_11_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_11_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_11_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_11_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_11_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_11_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_11_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_11_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_11_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_11_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_11_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_11_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 96, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_11_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_11_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_11_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_11_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 96], "dtype": "float32", "keras_history": ["block_11_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Add", "config": {"name": "block_11_add", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}}, "name": "block_11_add", "inbound_nodes": [{"args": [[{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 96], "dtype": "float32", "keras_history": ["block_10_project_BN", 0, 0]}}, {"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 96], "dtype": "float32", "keras_history": ["block_11_project_BN", 0, 0]}}]], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_12_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 576, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_12_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 96], "dtype": "float32", "keras_history": ["block_11_add", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_12_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_12_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_12_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_12_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_12_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_12_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_12_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_12_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_12_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_12_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_12_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_12_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_12_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_12_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_12_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_12_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 96, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_12_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_12_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_12_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_12_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 96], "dtype": "float32", "keras_history": ["block_12_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Add", "config": {"name": "block_12_add", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}}, "name": "block_12_add", "inbound_nodes": [{"args": [[{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 96], "dtype": "float32", "keras_history": ["block_11_add", 0, 0]}}, {"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 96], "dtype": "float32", "keras_history": ["block_12_project_BN", 0, 0]}}]], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_13_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 576, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_13_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 96], "dtype": "float32", "keras_history": ["block_12_add", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_13_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_13_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_13_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_13_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_13_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_13_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "ZeroPadding2D", "config": {"name": "block_13_pad", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "padding": [[0, 1], [0, 1]], "data_format": "channels_last"}, "name": "block_13_pad", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 14, 14, 576], "dtype": "float32", "keras_history": ["block_13_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_13_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [2, 2], "padding": "valid", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_13_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 15, 15, 576], "dtype": "float32", "keras_history": ["block_13_pad", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_13_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_13_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 576], "dtype": "float32", "keras_history": ["block_13_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_13_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_13_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 576], "dtype": "float32", "keras_history": ["block_13_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_13_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 160, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_13_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 576], "dtype": "float32", "keras_history": ["block_13_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_13_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_13_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 160], "dtype": "float32", "keras_history": ["block_13_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Conv2D", "config": {"name": "block_14_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 960, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_14_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 160], "dtype": "float32", "keras_history": ["block_13_project_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_14_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_14_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_14_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_14_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_14_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_14_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_14_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_14_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_14_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_14_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_14_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_14_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_14_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_14_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_14_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_14_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 160, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_14_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_14_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_14_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_14_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 160], "dtype": "float32", "keras_history": ["block_14_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Add", "config": {"name": "block_14_add", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}}, "name": "block_14_add", "inbound_nodes": [{"args": [[{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 160], "dtype": "float32", "keras_history": ["block_13_project_BN", 0, 0]}}, {"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 160], "dtype": "float32", "keras_history": ["block_14_project_BN", 0, 0]}}]], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_15_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 960, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_15_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 160], "dtype": "float32", "keras_history": ["block_14_add", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_15_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_15_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_15_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_15_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_15_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_15_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_15_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_15_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_15_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_15_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_15_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_15_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_15_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_15_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_15_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_15_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 160, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_15_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_15_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_15_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_15_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 160], "dtype": "float32", "keras_history": ["block_15_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Add", "config": {"name": "block_15_add", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}}, "name": "block_15_add", "inbound_nodes": [{"args": [[{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 160], "dtype": "float32", "keras_history": ["block_14_add", 0, 0]}}, {"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 160], "dtype": "float32", "keras_history": ["block_15_project_BN", 0, 0]}}]], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_16_expand", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 960, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_16_expand", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 160], "dtype": "float32", "keras_history": ["block_15_add", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_16_expand_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_16_expand_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_16_expand", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_16_expand_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_16_expand_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_16_expand_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "DepthwiseConv2D", "config": {"name": "block_16_depthwise", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "depth_multiplier": 1, "kernel_size": [3, 3], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "activation": "linear", "use_bias": false, "depthwise_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "depthwise_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "depthwise_constraint": null, "bias_constraint": null}, "name": "block_16_depthwise", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_16_expand_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_16_depthwise_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_16_depthwise_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_16_depthwise", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "block_16_depthwise_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "block_16_depthwise_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_16_depthwise_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "Conv2D", "config": {"name": "block_16_project", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 320, "kernel_size": [1, 1], "strides": [1, 1], "padding": "same", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "block_16_project", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 960], "dtype": "float32", "keras_history": ["block_16_depthwise_relu", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "block_16_project_BN", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "block_16_project_BN", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 320], "dtype": "float32", "keras_history": ["block_16_project", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "Conv2D", "config": {"name": "Conv_1", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "filters": 1280, "kernel_size": [1, 1], "strides": [1, 1], "padding": "valid", "data_format": "channels_last", "dilation_rate": [1, 1], "groups": 1, "activation": "linear", "use_bias": false, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}, "name": "Conv_1", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 320], "dtype": "float32", "keras_history": ["block_16_project_BN", 0, 0]}}], "kwargs": {}}]}, {"class_name": "BatchNormalization", "config": {"name": "Conv_1_bn", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "axis": -1, "momentum": 0.999, "epsilon": 0.001, "center": true, "scale": true, "beta_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "gamma_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "moving_mean_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "moving_variance_initializer": {"module": "keras.initializers", "class_name": "Ones", "config": {}, "registered_name": null}, "beta_regularizer": null, "gamma_regularizer": null, "beta_constraint": null, "gamma_constraint": null, "synchronized": false}, "name": "Conv_1_bn", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 1280], "dtype": "float32", "keras_history": ["Conv_1", 0, 0]}}], "kwargs": {"mask": null}}]}, {"class_name": "ReLU", "config": {"name": "out_relu", "trainable": false, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "max_value": 6.0, "negative_slope": 0.0, "threshold": 0.0}, "name": "out_relu", "inbound_nodes": [{"args": [{"class_name": "__keras_tensor__", "config": {"shape": [null, 7, 7, 1280], "dtype": "float32", "keras_history": ["Conv_1_bn", 0, 0]}}], "kwargs": {}}]}], "input_layers": [["input_layer", 0, 0]], "output_layers": [["out_relu", 0, 0]]}}, {"class_name": "GlobalAveragePooling2D", "config": {"name": "global_average_pooling2d", "trainable": true, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "data_format": "channels_last", "keepdims": false}}, {"class_name": "Dropout", "config": {"name": "dropout", "trainable": true, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "rate": 0.2, "seed": null, "noise_shape": null}}, {"class_name": "Dense", "config": {"name": "dense", "trainable": true, "dtype": {"module": "keras", "class_name": "DTypePolicy", "config": {"name": "float32"}, "registered_name": null}, "units": 4, "activation": "softmax", "use_bias": true, "kernel_initializer": {"module": "keras.initializers", "class_name": "GlorotUniform", "config": {"seed": null}, "registered_name": null}, "bias_initializer": {"module": "keras.initializers", "class_name": "Zeros", "config": {}, "registered_name": null}, "kernel_regularizer": null, "bias_regularizer": null, "kernel_constraint": null, "bias_constraint": null}}], "build_input_shape": [null, 224, 224, 3]}}, "training_config": {"loss": {"class_name": "SparseCategoricalCrossentropy", "config": {"name": "sparse_categorical_crossentropy", "reduction": "sum_over_batch_size", "from_logits": false, "ignore_class": null}}, "loss_weights": null, "metrics": ["accuracy"], "weighted_metrics": null, "run_eagerly": false, "steps_per_execution": 1, "jit_compile": false, "optimizer_config": {"class_name": "Adam", "config": {"name": "adam", "learning_rate": 0.0010000000474974513, "weight_decay": null, "clipnorm": null, "global_clipnorm": null, "clipvalue": null, "use_ema": false, "ema_momentum": 0.99, "ema_overwrite_frequency": null, "loss_scale_factor": null, "gradient_accumulation_steps": null, "beta_1": 0.9, "beta_2": 0.999, "epsilon": 1e-07, "amsgrad": false}}}}, "weightsManifest": [{"paths": ["group1-shard1of3.bin", "group1-shard2of3.bin", "group1-shard3of3.bin"], "weights": [{"name": "sequential/dense/kernel", "shape": [1280, 4], "dtype": "float32"}, {"name": "sequential/dense/bias", "shape": [4], "dtype": "float32"}, {"name": "Conv1/kernel", "shape": [3, 3, 3, 32], "dtype": "float32"}, {"name": "bn_Conv1/gamma", "shape": [32], "dtype": "float32"}, {"name": "bn_Conv1/beta", "shape": [32], "dtype": "float32"}, {"name": "bn_Conv1/moving_mean", "shape": [32], "dtype": "float32"}, {"name": "bn_Conv1/moving_variance", "shape": [32], "dtype": "float32"}, {"name": "expanded_conv_depthwise/kernel", "shape": [3, 3, 32, 1], "dtype": "float32"}, {"name": "expanded_conv_depthwise_BN/gamma", "shape": [32], "dtype": "float32"}, {"name": "expanded_conv_depthwise_BN/beta", "shape": [32], "dtype": "float32"}, {"name": "expanded_conv_depthwise_BN/moving_mean", "shape": [32], "dtype": "float32"}, {"name": "expanded_conv_depthwise_BN/moving_variance", "shape": [32], "dtype": "float32"}, {"name": "expanded_conv_project/kernel", "shape": [1, 1, 32, 16], "dtype": "float32"}, {"name": "expanded_conv_project_BN/gamma", "shape": [16], "dtype": "float32"}, {"name": "expanded_conv_project_BN/beta", "shape": [16], "dtype": "float32"}, {"name": "expanded_conv_project_BN/moving_mean", "shape": [16], "dtype": "float32"}, {"name": "expanded_conv_project_BN/moving_variance", "shape": [16], "dtype": "float32"}, {"name": "block_1_expand/kernel", "shape": [1, 1, 16, 96], "dtype": "float32"}, {"name": "block_1_expand_BN/gamma", "shape": [96], "dtype": "float32"}, {"name": "block_1_expand_BN/beta", "shape": [96], "dtype": "float32"}, {"name": "block_1_expand_BN/moving_mean", "shape": [96], "dtype": "float32"}, {"name": "block_1_expand_BN/moving_variance", "shape": [96], "dtype": "float32"}, {"name": "block_1_depthwise/kernel", "shape": [3, 3, 96, 1], "dtype": "float32"}, {"name": "block_1_depthwise_BN/gamma", "shape": [96], "dtype": "float32"}, {"name": "block_1_depthwise_BN/beta", "shape": [96], "dtype": "float32"}, {"name": "block_1_depthwise_BN/moving_mean", "shape": [96], "dtype": "float32"}, {"name": "block_1_depthwise_BN/moving_variance", "shape": [96], "dtype": "float32"}, {"name": "block_1_project/kernel", "shape": [1, 1, 96, 24], "dtype": "float32"}, {"name": "block_1_project_BN/gamma", "shape": [24], "dtype": "float32"}, {"name": "block_1_project_BN/beta", "shape": [24], "dtype": "float32"}, {"name": "block_1_project_BN/moving_mean", "shape": [24], "dtype": "float32"}, {"name": "block_1_project_BN/moving_variance", "shape": [24], "dtype": "float32"}, {"name": "block_2_expand/kernel", "shape": [1, 1, 24, 144], "dtype": "float32"}, {"name": "block_2_expand_BN/gamma", "shape": [144], "dtype": "float32"}, {"name": "block_2_expand_BN/beta", "shape": [144], "dtype": "float32"}, {"name": "block_2_expand_BN/moving_mean", "shape": [144], "dtype": "float32"}, {"name": "block_2_expand_BN/moving_variance", "shape": [144], "dtype": "float32"}, {"name": "block_2_depthwise/kernel", "shape": [3, 3, 144, 1], "dtype": "float32"}, {"name": "block_2_depthwise_BN/gamma", "shape": [144], "dtype": "float32"}, {"name": "block_2_depthwise_BN/beta", "shape": [144], "dtype": "float32"}, {"name": "block_2_depthwise_BN/moving_mean", "shape": [144], "dtype": "float32"}, {"name": "block_2_depthwise_BN/moving_variance", "shape": [144], "dtype": "float32"}, {"name": "block_2_project/kernel", "shape": [1, 1, 144, 24], "dtype": "float32"}, {"name": "block_2_project_BN/gamma", "shape": [24], "dtype": "float32"}, {"name": "block_2_project_BN/beta", "shape": [24], "dtype": "float32"}, {"name": "block_2_project_BN/moving_mean", "shape": [24], "dtype": "float32"}, {"name": "block_2_project_BN/moving_variance", "shape": [24], "dtype": "float32"}, {"name": "block_3_expand/kernel", "shape": [1, 1, 24, 144], "dtype": "float32"}, {"name": "block_3_expand_BN/gamma", "shape": [144], "dtype": "float32"}, {"name": "block_3_expand_BN/beta", "shape": [144], "dtype": "float32"}, {"name": "block_3_expand_BN/moving_mean", "shape": [144], "dtype": "float32"}, {"name": "block_3_expand_BN/moving_variance", "shape": [144], "dtype": "float32"}, {"name": "block_3_depthwise/kernel", "shape": [3, 3, 144, 1], "dtype": "float32"}, {"name": "block_3_depthwise_BN/gamma", "shape": [144], "dtype": "float32"}, {"name": "block_3_depthwise_BN/beta", "shape": [144], "dtype": "float32"}, {"name": "block_3_depthwise_BN/moving_mean", "shape": [144], "dtype": "float32"}, {"name": "block_3_depthwise_BN/moving_variance", "shape": [144], "dtype": "float32"}, {"name": "block_3_project/kernel", "shape": [1, 1, 144, 32], "dtype": "float32"}, {"name": "block_3_project_BN/gamma", "shape": [32], "dtype": "float32"}, {"name": "block_3_project_BN/beta", "shape": [32], "dtype": "float32"}, {"name": "block_3_project_BN/moving_mean", "shape": [32], "dtype": "float32"}, {"name": "block_3_project_BN/moving_variance", "shape": [32], "dtype": "float32"}, {"name": "block_4_expand/kernel", "shape": [1, 1, 32, 192], "dtype": "float32"}, {"name": "block_4_expand_BN/gamma", "shape": [192], "dtype": "float32"}, {"name": "block_4_expand_BN/beta", "shape": [192], "dtype": "float32"}, {"name": "block_4_expand_BN/moving_mean", "shape": [192], "dtype": "float32"}, {"name": "block_4_expand_BN/moving_variance", "shape": [192], "dtype": "float32"}, {"name": "block_4_depthwise/kernel", "shape": [3, 3, 192, 1], "dtype": "float32"}, {"name": "block_4_depthwise_BN/gamma", "shape": [192], "dtype": "float32"}, {"name": "block_4_depthwise_BN/beta", "shape": [192], "dtype": "float32"}, {"name": "block_4_depthwise_BN/moving_mean", "shape": [192], "dtype": "float32"}, {"name": "block_4_depthwise_BN/moving_variance", "shape": [192], "dtype": "float32"}, {"name": "block_4_project/kernel", "shape": [1, 1, 192, 32], "dtype": "float32"}, {"name": "block_4_project_BN/gamma", "shape": [32], "dtype": "float32"}, {"name": "block_4_project_BN/beta", "shape": [32], "dtype": "float32"}, {"name": "block_4_project_BN/moving_mean", "shape": [32], "dtype": "float32"}, {"name": "block_4_project_BN/moving_variance", "shape": [32], "dtype": "float32"}, {"name": "block_5_expand/kernel", "shape": [1, 1, 32, 192], "dtype": "float32"}, {"name": "block_5_expand_BN/gamma", "shape": [192], "dtype": "float32"}, {"name": "block_5_expand_BN/beta", "shape": [192], "dtype": "float32"}, {"name": "block_5_expand_BN/moving_mean", "shape": [192], "dtype": "float32"}, {"name": "block_5_expand_BN/moving_variance", "shape": [192], "dtype": "float32"}, {"name": "block_5_depthwise/kernel", "shape": [3, 3, 192, 1], "dtype": "float32"}, {"name": "block_5_depthwise_BN/gamma", "shape": [192], "dtype": "float32"}, {"name": "block_5_depthwise_BN/beta", "shape": [192], "dtype": "float32"}, {"name": "block_5_depthwise_BN/moving_mean", "shape": [192], "dtype": "float32"}, {"name": "block_5_depthwise_BN/moving_variance", "shape": [192], "dtype": "float32"}, {"name": "block_5_project/kernel", "shape": [1, 1, 192, 32], "dtype": "float32"}, {"name": "block_5_project_BN/gamma", "shape": [32], "dtype": "float32"}, {"name": "block_5_project_BN/beta", "shape": [32], "dtype": "float32"}, {"name": "block_5_project_BN/moving_mean", "shape": [32], "dtype": "float32"}, {"name": "block_5_project_BN/moving_variance", "shape": [32], "dtype": "float32"}, {"name": "block_6_expand/kernel", "shape": [1, 1, 32, 192], "dtype": "float32"}, {"name": "block_6_expand_BN/gamma", "shape": [192], "dtype": "float32"}, {"name": "block_6_expand_BN/beta", "shape": [192], "dtype": "float32"}, {"name": "block_6_expand_BN/moving_mean", "shape": [192], "dtype": "float32"}, {"name": "block_6_expand_BN/moving_variance", "shape": [192], "dtype": "float32"}, {"name": "block_6_depthwise/kernel", "shape": [3, 3, 192, 1], "dtype": "float32"}, {"name": "block_6_depthwise_BN/gamma", "shape": [192], "dtype": "float32"}, {"name": "block_6_depthwise_BN/beta", "shape": [192], "dtype": "float32"}, {"name": "block_6_depthwise_BN/moving_mean", "shape": [192], "dtype": "float32"}, {"name": "block_6_depthwise_BN/moving_variance", "shape": [192], "dtype": "float32"}, {"name": "block_6_project/kernel", "shape": [1, 1, 192, 64], "dtype": "float32"}, {"name": "block_6_project_BN/gamma", "shape": [64], "dtype": "float32"}, {"name": "block_6_project_BN/beta", "shape": [64], "dtype": "float32"}, {"name": "block_6_project_BN/moving_mean", "shape": [64], "dtype": "float32"}, {"name": "block_6_project_BN/moving_variance", "shape": [64], "dtype": "float32"}, {"name": "block_7_expand/kernel", "shape": [1, 1, 64, 384], "dtype": "float32"}, {"name": "block_7_expand_BN/gamma", "shape": [384], "dtype": "float32"}, {"name": "block_7_expand_BN/beta", "shape": [384], "dtype": "float32"}, {"name": "block_7_expand_BN/moving_mean", "shape": [384], "dtype": "float32"}, {"name": "block_7_expand_BN/moving_variance", "shape": [384], "dtype": "float32"}, {"name": "block_7_depthwise/kernel", "shape": [3, 3, 384, 1], "dtype": "float32"}, {"name": "block_7_depthwise_BN/gamma", "shape": [384], "dtype": "float32"}, {"name": "block_7_depthwise_BN/beta", "shape": [384], "dtype": "float32"}, {"name": "block_7_depthwise_BN/moving_mean", "shape": [384], "dtype": "float32"}, {"name": "block_7_depthwise_BN/moving_variance", "shape": [384], "dtype": "float32"}, {"name": "block_7_project/kernel", "shape": [1, 1, 384, 64], "dtype": "float32"}, {"name": "block_7_project_BN/gamma", "shape": [64], "dtype": "float32"}, {"name": "block_7_project_BN/beta", "shape": [64], "dtype": "float32"}, {"name": "block_7_project_BN/moving_mean", "shape": [64], "dtype": "float32"}, {"name": "block_7_project_BN/moving_variance", "shape": [64], "dtype": "float32"}, {"name": "block_8_expand/kernel", "shape": [1, 1, 64, 384], "dtype": "float32"}, {"name": "block_8_expand_BN/gamma", "shape": [384], "dtype": "float32"}, {"name": "block_8_expand_BN/beta", "shape": [384], "dtype": "float32"}, {"name": "block_8_expand_BN/moving_mean", "shape": [384], "dtype": "float32"}, {"name": "block_8_expand_BN/moving_variance", "shape": [384], "dtype": "float32"}, {"name": "block_8_depthwise/kernel", "shape": [3, 3, 384, 1], "dtype": "float32"}, {"name": "block_8_depthwise_BN/gamma", "shape": [384], "dtype": "float32"}, {"name": "block_8_depthwise_BN/beta", "shape": [384], "dtype": "float32"}, {"name": "block_8_depthwise_BN/moving_mean", "shape": [384], "dtype": "float32"}, {"name": "block_8_depthwise_BN/moving_variance", "shape": [384], "dtype": "float32"}, {"name": "block_8_project/kernel", "shape": [1, 1, 384, 64], "dtype": "float32"}, {"name": "block_8_project_BN/gamma", "shape": [64], "dtype": "float32"}, {"name": "block_8_project_BN/beta", "shape": [64], "dtype": "float32"}, {"name": "block_8_project_BN/moving_mean", "shape": [64], "dtype": "float32"}, {"name": "block_8_project_BN/moving_variance", "shape": [64], "dtype": "float32"}, {"name": "block_9_expand/kernel", "shape": [1, 1, 64, 384], "dtype": "float32"}, {"name": "block_9_expand_BN/gamma", "shape": [384], "dtype": "float32"}, {"name": "block_9_expand_BN/beta", "shape": [384], "dtype": "float32"}, {"name": "block_9_expand_BN/moving_mean", "shape": [384], "dtype": "float32"}, {"name": "block_9_expand_BN/moving_variance", "shape": [384], "dtype": "float32"}, {"name": "block_9_depthwise/kernel", "shape": [3, 3, 384, 1], "dtype": "float32"}, {"name": "block_9_depthwise_BN/gamma", "shape": [384], "dtype": "float32"}, {"name": "block_9_depthwise_BN/beta", "shape": [384], "dtype": "float32"}, {"name": "block_9_depthwise_BN/moving_mean", "shape": [384], "dtype": "float32"}, {"name": "block_9_depthwise_BN/moving_variance", "shape": [384], "dtype": "float32"}, {"name": "block_9_project/kernel", "shape": [1, 1, 384, 64], "dtype": "float32"}, {"name": "block_9_project_BN/gamma", "shape": [64], "dtype": "float32"}, {"name": "block_9_project_BN/beta", "shape": [64], "dtype": "float32"}, {"name": "block_9_project_BN/moving_mean", "shape": [64], "dtype": "float32"}, {"name": "block_9_project_BN/moving_variance", "shape": [64], "dtype": "float32"}, {"name": "block_10_expand/kernel", "shape": [1, 1, 64, 384], "dtype": "float32"}, {"name": "block_10_expand_BN/gamma", "shape": [384], "dtype": "float32"}, {"name": "block_10_expand_BN/beta", "shape": [384], "dtype": "float32"}, {"name": "block_10_expand_BN/moving_mean", "shape": [384], "dtype": "float32"}, {"name": "block_10_expand_BN/moving_variance", "shape": [384], "dtype": "float32"}, {"name": "block_10_depthwise/kernel", "shape": [3, 3, 384, 1], "dtype": "float32"}, {"name": "block_10_depthwise_BN/gamma", "shape": [384], "dtype": "float32"}, {"name": "block_10_depthwise_BN/beta", "shape": [384], "dtype": "float32"}, {"name": "block_10_depthwise_BN/moving_mean", "shape": [384], "dtype": "float32"}, {"name": "block_10_depthwise_BN/moving_variance", "shape": [384], "dtype": "float32"}, {"name": "block_10_project/kernel", "shape": [1, 1, 384, 96], "dtype": "float32"}, {"name": "block_10_project_BN/gamma", "shape": [96], "dtype": "float32"}, {"name": "block_10_project_BN/beta", "shape": [96], "dtype": "float32"}, {"name": "block_10_project_BN/moving_mean", "shape": [96], "dtype": "float32"}, {"name": "block_10_project_BN/moving_variance", "shape": [96], "dtype": "float32"}, {"name": "block_11_expand/kernel", "shape": [1, 1, 96, 576], "dtype": "float32"}, {"name": "block_11_expand_BN/gamma", "shape": [576], "dtype": "float32"}, {"name": "block_11_expand_BN/beta", "shape": [576], "dtype": "float32"}, {"name": "block_11_expand_BN/moving_mean", "shape": [576], "dtype": "float32"}, {"name": "block_11_expand_BN/moving_variance", "shape": [576], "dtype": "float32"}, {"name": "block_11_depthwise/kernel", "shape": [3, 3, 576, 1], "dtype": "float32"}, {"name": "block_11_depthwise_BN/gamma", "shape": [576], "dtype": "float32"}, {"name": "block_11_depthwise_BN/beta", "shape": [576], "dtype": "float32"}, {"name": "block_11_depthwise_BN/moving_mean", "shape": [576], "dtype": "float32"}, {"name": "block_11_depthwise_BN/moving_variance", "shape": [576], "dtype": "float32"}, {"name": "block_11_project/kernel", "shape": [1, 1, 576, 96], "dtype": "float32"}, {"name": "block_11_project_BN/gamma", "shape": [96], "dtype": "float32"}, {"name": "block_11_project_BN/beta", "shape": [96], "dtype": "float32"}, {"name": "block_11_project_BN/moving_mean", "shape": [96], "dtype": "float32"}, {"name": "block_11_project_BN/moving_variance", "shape": [96], "dtype": "float32"}, {"name": "block_12_expand/kernel", "shape": [1, 1, 96, 576], "dtype": "float32"}, {"name": "block_12_expand_BN/gamma", "shape": [576], "dtype": "float32"}, {"name": "block_12_expand_BN/beta", "shape": [576], "dtype": "float32"}, {"name": "block_12_expand_BN/moving_mean", "shape": [576], "dtype": "float32"}, {"name": "block_12_expand_BN/moving_variance", "shape": [576], "dtype": "float32"}, {"name": "block_12_depthwise/kernel", "shape": [3, 3, 576, 1], "dtype": "float32"}, {"name": "block_12_depthwise_BN/gamma", "shape": [576], "dtype": "float32"}, {"name": "block_12_depthwise_BN/beta", "shape": [576], "dtype": "float32"}, {"name": "block_12_depthwise_BN/moving_mean", "shape": [576], "dtype": "float32"}, {"name": "block_12_depthwise_BN/moving_variance", "shape": [576], "dtype": "float32"}, {"name": "block_12_project/kernel", "shape": [1, 1, 576, 96], "dtype": "float32"}, {"name": "block_12_project_BN/gamma", "shape": [96], "dtype": "float32"}, {"name": "block_12_project_BN/beta", "shape": [96], "dtype": "float32"}, {"name": "block_12_project_BN/moving_mean", "shape": [96], "dtype": "float32"}, {"name": "block_12_project_BN/moving_variance", "shape": [96], "dtype": "float32"}, {"name": "block_13_expand/kernel", "shape": [1, 1, 96, 576], "dtype": "float32"}, {"name": "block_13_expand_BN/gamma", "shape": [576], "dtype": "float32"}, {"name": "block_13_expand_BN/beta", "shape": [576], "dtype": "float32"}, {"name": "block_13_expand_BN/moving_mean", "shape": [576], "dtype": "float32"}, {"name": "block_13_expand_BN/moving_variance", "shape": [576], "dtype": "float32"}, {"name": "block_13_depthwise/kernel", "shape": [3, 3, 576, 1], "dtype": "float32"}, {"name": "block_13_depthwise_BN/gamma", "shape": [576], "dtype": "float32"}, {"name": "block_13_depthwise_BN/beta", "shape": [576], "dtype": "float32"}, {"name": "block_13_depthwise_BN/moving_mean", "shape": [576], "dtype": "float32"}, {"name": "block_13_depthwise_BN/moving_variance", "shape": [576], "dtype": "float32"}, {"name": "block_13_project/kernel", "shape": [1, 1, 576, 160], "dtype": "float32"}, {"name": "block_13_project_BN/gamma", "shape": [160], "dtype": "float32"}, {"name": "block_13_project_BN/beta", "shape": [160], "dtype": "float32"}, {"name": "block_13_project_BN/moving_mean", "shape": [160], "dtype": "float32"}, {"name": "block_13_project_BN/moving_variance", "shape": [160], "dtype": "float32"}, {"name": "block_14_expand/kernel", "shape": [1, 1, 160, 960], "dtype": "float32"}, {"name": "block_14_expand_BN/gamma", "shape": [960], "dtype": "float32"}, {"name": "block_14_expand_BN/beta", "shape": [960], "dtype": "float32"}, {"name": "block_14_expand_BN/moving_mean", "shape": [960], "dtype": "float32"}, {"name": "block_14_expand_BN/moving_variance", "shape": [960], "dtype": "float32"}, {"name": "block_14_depthwise/kernel", "shape": [3, 3, 960, 1], "dtype": "float32"}, {"name": "block_14_depthwise_BN/gamma", "shape": [960], "dtype": "float32"}, {"name": "block_14_depthwise_BN/beta", "shape": [960], "dtype": "float32"}, {"name": "block_14_depthwise_BN/moving_mean", "shape": [960], "dtype": "float32"}, {"name": "block_14_depthwise_BN/moving_variance", "shape": [960], "dtype": "float32"}, {"name": "block_14_project/kernel", "shape": [1, 1, 960, 160], "dtype": "float32"}, {"name": "block_14_project_BN/gamma", "shape": [160], "dtype": "float32"}, {"name": "block_14_project_BN/beta", "shape": [160], "dtype": "float32"}, {"name": "block_14_project_BN/moving_mean", "shape": [160], "dtype": "float32"}, {"name": "block_14_project_BN/moving_variance", "shape": [160], "dtype": "float32"}, {"name": "block_15_expand/kernel", "shape": [1, 1, 160, 960], "dtype": "float32"}, {"name": "block_15_expand_BN/gamma", "shape": [960], "dtype": "float32"}, {"name": "block_15_expand_BN/beta", "shape": [960], "dtype": "float32"}, {"name": "block_15_expand_BN/moving_mean", "shape": [960], "dtype": "float32"}, {"name": "block_15_expand_BN/moving_variance", "shape": [960], "dtype": "float32"}, {"name": "block_15_depthwise/kernel", "shape": [3, 3, 960, 1], "dtype": "float32"}, {"name": "block_15_depthwise_BN/gamma", "shape": [960], "dtype": "float32"}, {"name": "block_15_depthwise_BN/beta", "shape": [960], "dtype": "float32"}, {"name": "block_15_depthwise_BN/moving_mean", "shape": [960], "dtype": "float32"}, {"name": "block_15_depthwise_BN/moving_variance", "shape": [960], "dtype": "float32"}, {"name": "block_15_project/kernel", "shape": [1, 1, 960, 160], "dtype": "float32"}, {"name": "block_15_project_BN/gamma", "shape": [160], "dtype": "float32"}, {"name": "block_15_project_BN/beta", "shape": [160], "dtype": "float32"}, {"name": "block_15_project_BN/moving_mean", "shape": [160], "dtype": "float32"}, {"name": "block_15_project_BN/moving_variance", "shape": [160], "dtype": "float32"}, {"name": "block_16_expand/kernel", "shape": [1, 1, 160, 960], "dtype": "float32"}, {"name": "block_16_expand_BN/gamma", "shape": [960], "dtype": "float32"}, {"name": "block_16_expand_BN/beta", "shape": [960], "dtype": "float32"}, {"name": "block_16_expand_BN/moving_mean", "shape": [960], "dtype": "float32"}, {"name": "block_16_expand_BN/moving_variance", "shape": [960], "dtype": "float32"}, {"name": "block_16_depthwise/kernel", "shape": [3, 3, 960, 1], "dtype": "float32"}, {"name": "block_16_depthwise_BN/gamma", "shape": [960], "dtype": "float32"}, {"name": "block_16_depthwise_BN/beta", "shape": [960], "dtype": "float32"}, {"name": "block_16_depthwise_BN/moving_mean", "shape": [960], "dtype": "float32"}, {"name": "block_16_depthwise_BN/moving_variance", "shape": [960], "dtype": "float32"}, {"name": "block_16_project/kernel", "shape": [1, 1, 960, 320], "dtype": "float32"}, {"name": "block_16_project_BN/gamma", "shape": [320], "dtype": "float32"}, {"name": "block_16_project_BN/beta", "shape": [320], "dtype": "float32"}, {"name": "block_16_project_BN/moving_mean", "shape": [320], "dtype": "float32"}, {"name": "block_16_project_BN/moving_variance", "shape": [320], "dtype": "float32"}, {"name": "Conv_1/kernel", "shape": [1, 1, 320, 1280], "dtype": "float32"}, {"name": "Conv_1_bn/gamma", "shape": [1280], "dtype": "float32"}, {"name": "Conv_1_bn/beta", "shape": [1280], "dtype": "float32"}, {"name": "Conv_1_bn/moving_mean", "shape": [1280], "dtype": "float32"}, {"name": "Conv_1_bn/moving_variance", "shape": [1280], "dtype": "float32"}]}]}


--- File: ./public/robots.txt ---

# https://www.robotstxt.org/robotstxt.html
User-agent: *
Disallow:



--- File: ./src/App.jsx ---

// src/App.jsx

import React, { useEffect, useCallback, useState } from "react";
// [PERBAIKAN 1] Impor useSelector dan selector isAuthenticated
import { useDispatch, useSelector } from 'react-redux'; 
import { setCredentials, selectIsAuthenticated } from './services/authSlice'; 
import Routes from "./Routes";
import { useCreateAlertMutation } from './services/alertsApi';
import { useCreateDiagnosisMutation } from './services/diagnosisApi';
import { useCreateFarmTaskMutation, useUpdateFarmTaskMutation, useDeleteFarmTaskMutation } from './services/farmTasksApi';
import { retryQueue } from './offline/queueService';
import { Toaster, toast } from 'react-hot-toast';

function App() {
  const dispatch = useDispatch();
  // [PERBAIKAN 2] Dapatkan status autentikasi dari Redux state
  const isAuthenticated = useSelector(selectIsAuthenticated); 

  const [createAlert] = useCreateAlertMutation();
  const [createDiagnosis] = useCreateDiagnosisMutation();
  const [createEvent] = useCreateFarmTaskMutation();
  const [updateEvent] = useUpdateFarmTaskMutation();
  const [deleteEvent] = useDeleteFarmTaskMutation();
  const [isOnline, setIsOnline] = useState(() =>
    typeof navigator === 'undefined' ? true : navigator.onLine
  );

  // Logika untuk memuat sesi login saat aplikasi pertama kali dibuka/direfresh
  useEffect(() => {
    const token = localStorage.getItem('sessionToken');
    const userProfile = localStorage.getItem('userProfile');

    if (token && userProfile) {
      try {
        const user = JSON.parse(userProfile);
        dispatch(setCredentials({ user, token }));
        console.log("Sesi berhasil dimuat dari localStorage.");
      } catch (e) {
        console.error("Gagal mem-parsing userProfile dari localStorage", e);
      }
    }
  }, [dispatch]);

  const apiClient = useCallback(async (request) => {
    switch (request.type) {
        case 'createAlert': return createAlert(request.payload).unwrap();
        case 'createDiagnosis': return createDiagnosis(request.payload).unwrap();
        case 'createEvent': return createEvent(request.payload).unwrap();
        case 'updateEvent': return updateEvent(request.payload).unwrap();
        case 'deleteEvent': return deleteEvent(request.payload.id).unwrap();
        default: throw new Error(`Tipe permintaan tidak dikenal: ${request.type}`);
      }
  }, [createAlert, createDiagnosis, createEvent, updateEvent, deleteEvent]);

  // useEffect untuk menangani sinkronisasi
  useEffect(() => {
    if (typeof window === 'undefined') return;
    const syncChannel = new BroadcastChannel('sync-channel');

    const sync = () => {
        // [PERBAIKAN 3] Tambahkan kondisi: HANYA jalankan sinkronisasi jika online DAN sudah terautentikasi.
        if (navigator.onLine && isAuthenticated) {
            console.log('Kondisi terpenuhi (Online & Authenticated). Mencoba sinkronisasi otomatis...');
            retryQueue(apiClient);
        } else {
            console.log(`Sinkronisasi ditunda. Online: ${navigator.onLine}, Authenticated: ${isAuthenticated}`);
        }
    };

    syncChannel.onmessage = (event) => {
      if (event.data.action === 'queue-updated') {
        console.log('Menerima siaran: antrean diperbarui. Memicu sinkronisasi.');
        sync();
      }
    };
    
    window.addEventListener('online', sync);
    
    // Panggil sync() pertama kali. Jika belum login, dia akan ditunda secara otomatis oleh logika di atas.
    sync();

    return () => {
      syncChannel.close();
      window.removeEventListener('online', sync);
    };
  // [PERBAIKAN 4] Tambahkan isAuthenticated sebagai dependency. Hook ini akan otomatis berjalan kembali ketika state login berubah.
  }, [apiClient, isAuthenticated]); 

  // useEffect untuk menampilkan status online/offline
  useEffect(() => {
    if (typeof window === 'undefined') return;
    const updateBody = (online) => {
      setIsOnline(online);
      if (typeof document !== 'undefined') {
        document.body.classList.toggle('is-offline', !online);
      }
    };
    updateBody(navigator.onLine ?? true);

    const handleOnline = () => {
      updateBody(true);
      toast.success('Koneksi kembali online', { id: 'network-status' });
    };
    const handleOffline = () => {
      updateBody(false);
      toast.error('Sedang offline. Data baru antri dulu.', {
        id: 'network-status',
        duration: 6000,
      });
    };

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  return (
    <>
      <Routes />
      <NetworkStatusPill isOnline={isOnline} />
      <Toaster position="top-right" toastOptions={{ duration: 5000 }} />
    </>
  );
}

export default App;

function NetworkStatusPill({ isOnline }) {
  if (isOnline) return null;
  return (
    <div className="fixed top-4 right-4 z-[600] rounded-full bg-warning text-warning-foreground px-4 py-2 text-xs font-semibold shadow-lg border border-warning/40">
      Mode offline - data tersimpan lokal
    </div>
  );
}


--- File: ./src/Routes.jsx ---

import React from "react";
import { BrowserRouter, Routes as RouterRoutes, Route } from "react-router-dom";
import ScrollToTop from "components/ScrollToTop";
import ErrorBoundary from "components/ErrorBoundary";
import NotFound from "pages/NotFound";
import HomeDashboard from './pages/home-dashboard';
import PhotoDiagnosis from './pages/photo-diagnosis';
import CommunityAlerts from './pages/community-alerts';
import DiagnosisResults from './pages/diagnosis-results';
import FarmingCalendar from './pages/farming-calendar';
import DiagnosisHistory from './pages/diagnosis-history'; // <-- LANGKAH 1: IMPORT HALAMAN BARU
import LoginPage from './pages/login'; // <-- TAMBAHKAN BARIS INI
import RegisterPage from './pages/register'; // <-- TAMBAHKAN BARIS INI
import ForgotPasswordPage from './pages/forgot-password'; // <-- Tambahkan ini
import ResetPasswordPage from './pages/reset-password'; // <-- TAMBAHKAN INI


const Routes = () => {
  return (
    <BrowserRouter>
      <ErrorBoundary>
      <ScrollToTop />
      <RouterRoutes>
        {/* Define your route here */}
        <Route path="/" element={<HomeDashboard />} />
        <Route path="/home-dashboard" element={<HomeDashboard />} />
        <Route path="/photo-diagnosis" element={<PhotoDiagnosis />} />
        <Route path="/community-alerts" element={<CommunityAlerts />} />
        <Route path="/diagnosis-results" element={<DiagnosisResults />} />
        <Route path="/farming-calendar" element={<FarmingCalendar />} />
        
        {/* LANGKAH 2: TAMBAHKAN RUTE BARU DI SINI */}
        <Route path="/diagnosis-history" element={<DiagnosisHistory />} />

        <Route path="/login" element={<LoginPage />} /> {/* <-- TAMBAHKAN BARIS INI */}
        <Route path="/register" element={<RegisterPage />} /> {/* <-- TAMBAHKAN BARIS INI */}
        <Route path="/forgot-password" element={<ForgotPasswordPage />} /> {/* <-- Tambahkan ini */}
              <Route path="/reset-password" element={<ResetPasswordPage />} /> {/* <-- TAMBAHKAN INI */}


        <Route path="*" element={<NotFound />} />
      </RouterRoutes>
      </ErrorBoundary>
    </BrowserRouter>
  );
};

export default Routes;


--- File: ./src/ai/__tests__/modelArtifacts.test.js ---

import { describe, it, expect } from 'vitest';
import fs from 'node:fs';
import path from 'node:path';

const modelPath = path.resolve(process.cwd(), 'public', 'model', 'model.json');

describe('local TF.js model artifact', () => {
  it('is exported as a layers-model with batch_input_shape on every InputLayer', () => {
    const raw = fs.readFileSync(modelPath, 'utf-8');
    const data = JSON.parse(raw);

    expect(data.format).toBe('layers-model');

    const inputLayerConfigs = [];
    const visit = (node) => {
      if (!node || typeof node !== 'object') return;
      if (Array.isArray(node)) {
        node.forEach(visit);
        return;
      }
      if (node.class_name === 'InputLayer' && node.config) {
        inputLayerConfigs.push(node.config);
      }
      Object.values(node).forEach(visit);
    };

    visit(data.modelTopology?.model_config);
    expect(inputLayerConfigs.length).toBeGreaterThan(0);

    for (const cfg of inputLayerConfigs) {
      expect(cfg.batch_input_shape, 'InputLayer harus memiliki batch_input_shape').toBeTruthy();
    }
  });
});



--- File: ./src/ai/localDiagnosis.js ---

// src/ai/localDiagnosis.js
// Memuat TensorFlow.js secara dinamis dan menjalankan diagnosis lokal berbasis model TF.js.

import modelUrl from '/model/model.json?url';

const TFJS_CDN_URL = 'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0/dist/tf.min.js';

let tfInstance = null;
let tfLoadPromise = null;
let modelInstance = null;
let augRegistered = false;

function ensureAugmentationStubs(tf) {
  if (augRegistered) return;
  const { serialization, layers } = tf;
  if (!serialization || !layers) return;

  class NoOpRandomFlip extends layers.Layer {
    static className = 'RandomFlip';
    constructor(config) {
      super(config || {});
    }
    call(inputs) {
      return Array.isArray(inputs) ? inputs[0] : inputs;
    }
    getConfig() {
      return { ...super.getConfig() };
    }
  }

  class NoOpRandomRotation extends layers.Layer {
    static className = 'RandomRotation';
    constructor(config) {
      super(config || {});
    }
    call(inputs) {
      return Array.isArray(inputs) ? inputs[0] : inputs;
    }
    getConfig() {
      return { ...super.getConfig() };
    }
  }

  serialization.registerClass(NoOpRandomFlip);
  serialization.registerClass(NoOpRandomRotation);
  augRegistered = true;
}

async function injectTfScript() {
  if (tfInstance) return tfInstance;

  if (typeof window === 'undefined') {
    throw new Error('TF.js hanya bisa dimuat di lingkungan browser.');
  }

  if (tfLoadPromise) return tfLoadPromise;

  tfLoadPromise = new Promise((resolve, reject) => {
    const existing = document.getElementById('tfjs-script');
    if (existing) {
      existing.addEventListener('load', () => {
        if (window.tf) {
          tfInstance = window.tf;
          resolve(tfInstance);
        } else {
          reject(new Error('window.tf tidak ditemukan setelah skrip dimuat.'));
        }
      }, { once: true });
      existing.addEventListener('error', () => reject(new Error('Gagal memuat skrip TF.js (existing).')), { once: true });
      return;
    }

    console.log('Menginjeksikan skrip TensorFlow.js @4.22.0...');
    const script = document.createElement('script');
    script.id = 'tfjs-script';
    script.src = TFJS_CDN_URL;
    script.async = true;
    script.onload = async () => {
      tfInstance = window.tf;
      if (!tfInstance || typeof tfInstance.setBackend !== 'function') {
        reject(new Error('window.tf tidak valid setelah skrip dimuat.'));
        return;
      }
      try {
        await tfInstance.setBackend('webgl');
        await tfInstance.ready();
        ensureAugmentationStubs(tfInstance);
        console.log('TF.js backend siap:', tfInstance.getBackend(), 'versi:', tfInstance.version_tfjs);
        resolve(tfInstance);
      } catch (err) {
        reject(err);
      }
    };
    script.onerror = () => reject(new Error('Gagal memuat skrip TF.js dari CDN.'));
    document.head.appendChild(script);
  });

  return tfLoadPromise;
}

async function tryLoadTf() {
  try {
    return await injectTfScript();
  } catch (err) {
    console.warn('TFJS unavailable, using mock fallback:', err?.message || err);
    return null;
  }
}

async function tryLoadModel(tf) {
  if (modelInstance) return modelInstance;
  ensureAugmentationStubs(tf);
  try {
    console.log(`Mencoba memuat model (layers) langsung dari: ${modelUrl}`);
    const model = await tf.loadLayersModel(modelUrl, {
      fetchFunc: (url, init) => fetch(url, { ...init, cache: 'no-store' }),
    });
    console.log('Model berhasil dimuat.');
    modelInstance = model;
    return modelInstance;
  } catch (err) {
    console.warn('Model not found or failed to load, using mock fallback:', err?.message || err);
    return null;
  }
}

async function fileToInputTensor(tf, file, size = 224) {
  const bitmap = await createImageBitmap(file);
  return tf.tidy(() => {
    const tensor = tf.browser.fromPixels(bitmap).toFloat();
    const normalized = tensor.div(255);
    const resized = tf.image.resizeBilinear(normalized, [size, size]);
    return resized.expandDims(0);
  });
}

function mockPredict() {
  console.log('Fallback: Menjalankan mockPredict().');
  return {
    diagnosis: {
      label: 'Bercak Daun (MOCK)',
      confidence: 75,
      severity: 'sedang',
      description: 'Model lokal gagal dimuat. Gunakan hasil server atau coba ulang.'
    },
    recommendations: [
      {
        id: 'rec_mock_1',
        title: 'Periksa koneksi & console',
        description: 'Lihat pesan error di console (F12) untuk detail mengapa model gagal dimuat.',
        priority: 'tinggi',
        timeframe: 'Segera'
      }
    ]
  };
}

export async function runLocalDiagnosis(imageFile) {
  try {
    const tf = await tryLoadTf();
    if (!tf) return mockPredict();

    const model = await tryLoadModel(tf);
    if (!model) return mockPredict();

    console.log('Memproses gambar untuk input model...');
    const input = await fileToInputTensor(tf, imageFile, 224);

    console.log('Menjalankan prediksi...');
    const output = model.predict(input);
    const data = await output.data();

    const maxIndex = data.indexOf(Math.max(...data));
    const confidence = Math.round(data[maxIndex] * 100);
    const classLabels = ['Blight', 'Common_Rust', 'Gray_Leaf_Spot', 'Healthy'];
    const label = classLabels[maxIndex] || 'Unknown';

    input.dispose();
    output.dispose();

    const severityMap = {
      Blight: 'berat',
      Common_Rust: 'sedang',
      Gray_Leaf_Spot: 'sedang',
      Healthy: 'ringan'
    };
    const descriptionMap = {
      Blight: 'Terdeteksi Hawar Daun (Blight). Monitor penyebaran dan lakukan tindakan cepat.',
      Common_Rust: 'Terdeteksi Karat Biasa. Perhatikan bercak coklat/oranye pada daun.',
      Gray_Leaf_Spot: 'Terdeteksi Bercak Abu-abu. Biasanya moderat tapi perlu diawasi.',
      Healthy: 'Tanaman tampak sehat. Lanjutkan pemantauan rutin.'
    };

    return {
      diagnosis: {
        label,
        confidence,
        severity: severityMap[label] || 'tidak diketahui',
        description: descriptionMap[label] || 'Analisis AI selesai.'
      },
      recommendations: [
        {
          id: 'rec_tf_1',
          title: `Langkah untuk ${label}`,
          description: 'Ikuti panduan budidaya yang sesuai dan konsultasi jika gejala memburuk.',
          priority: 'sedang',
          timeframe: '2-3 hari'
        },
        {
          id: 'rec_tf_2',
          title: 'Pencegahan umum',
          description: 'Pertahankan sanitasi lahan, sirkulasi udara, dan nutrisi yang seimbang.',
          priority: 'rendah',
          timeframe: 'Berkelanjutan'
        }
      ]
    };
  } catch (err) {
    console.error('Terjadi error saat diagnosis lokal, menggunakan mock:', err);
    return mockPredict();
  }
}

export async function compressImage(file, quality = 0.8) {
  const bitmap = await createImageBitmap(file);
  const canvas = document.createElement('canvas');
  canvas.width = bitmap.width;
  canvas.height = bitmap.height;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(bitmap, 0, 0);
  const blob = await new Promise((resolve) => canvas.toBlob(resolve, 'image/jpeg', quality));
  if (!blob) return file;
  return new File([blob], file.name.replace(/\.[^.]+$/, '') + '.jpg', { type: 'image/jpeg' });
}



--- File: ./src/components/AppIcon.jsx ---

import React from 'react';
import * as LucideIcons from 'lucide-react';
import { HelpCircle } from 'lucide-react';

function Icon({
    name,
    size = 24,
    color = "currentColor",
    className = "",
    strokeWidth = 2,
    ...props
}) {
    const IconComponent = LucideIcons?.[name];

    if (!IconComponent) {
        return <HelpCircle size={size} color="gray" strokeWidth={strokeWidth} className={className} {...props} />;
    }

    return <IconComponent
        size={size}
        color={color}
        strokeWidth={strokeWidth}
        className={className}
        {...props}
    />;
}
export default Icon;


--- File: ./src/components/AppImage.jsx ---

// src/components/AppImage.jsx
import React, { useEffect, useState } from 'react';

/**
 * AppImage â€“ sederhana, TANPA fetch/HEAD.
 * - Render <img> langsung.
 * - onError â†’ fallback.
 * - Tidak set crossOrigin (biar tidak kena CORS check).
 */
export default function AppImage({
  src,
  alt = '',
  className = '',
  fallbackSrc = '/assets/images/no_image.png',
  ...rest
}) {
  const [currentSrc, setCurrentSrc] = useState(src || fallbackSrc);

  useEffect(() => {
    setCurrentSrc(src || fallbackSrc);
  }, [src, fallbackSrc]);

  const handleError = () => {
    if (currentSrc !== fallbackSrc) {
      setCurrentSrc(fallbackSrc);
    }
  };

  return (
    <img
      src={currentSrc || fallbackSrc}
      alt={alt}
      className={className}
      loading="lazy"
      onError={handleError}
      {...rest}
    />
  );
}



--- File: ./src/components/ErrorBoundary.jsx ---

import React from "react";
import Icon from "./AppIcon";

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    error.__ErrorBoundary = true;
    window.__COMPONENT_ERROR__?.(error, errorInfo);
    // console.log("Error caught by ErrorBoundary:", error, errorInfo);
  }

  render() {
    if (this.state?.hasError) {
      return (
        <div className="min-h-screen flex items-center justify-center bg-neutral-50">
          <div className="text-center p-8 max-w-md">
            <div className="flex justify-center items-center mb-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="42px" height="42px" viewBox="0 0 32 33" fill="none">
                <path d="M16 28.5C22.6274 28.5 28 23.1274 28 16.5C28 9.87258 22.6274 4.5 16 4.5C9.37258 4.5 4 9.87258 4 16.5C4 23.1274 9.37258 28.5 16 28.5Z" stroke="#343330" strokeWidth="2" strokeMiterlimit="10" />
                <path d="M11.5 15.5C12.3284 15.5 13 14.8284 13 14C13 13.1716 12.3284 12.5 11.5 12.5C10.6716 12.5 10 13.1716 10 14C10 14.8284 10.6716 15.5 11.5 15.5Z" fill="#343330" />
                <path d="M20.5 15.5C21.3284 15.5 22 14.8284 22 14C22 13.1716 21.3284 12.5 20.5 12.5C19.6716 12.5 19 13.1716 19 14C19 14.8284 19.6716 15.5 20.5 15.5Z" fill="#343330" />
                <path d="M21 22.5C19.9625 20.7062 18.2213 19.5 16 19.5C13.7787 19.5 12.0375 20.7062 11 22.5" stroke="#343330" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
              </svg>
            </div>
            <div className="flex flex-col gap-1 text-center">
              <h1 className="text-2xl font-medium text-neutral-800">Something went wrong</h1>
              <p className="text-neutral-600 text-base w w-8/12 mx-auto">We encountered an unexpected error while processing your request.</p>
            </div>
            <div className="flex justify-center items-center mt-6">
              <button
                onClick={() => {
                  window.location.href = "/";
                }}
                className="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded flex items-center gap-2 transition-colors duration-200 shadow-sm"
              >
                <Icon name="ArrowLeft" size={18} color="#fff" />
                Back
              </button>
            </div>
          </div >
        </div >
      );
    }

    return this.props?.children;
  }
}

export default ErrorBoundary;


--- File: ./src/components/ScrollToTop.jsx ---

import { useEffect } from "react";
import { useLocation } from "react-router-dom";

const ScrollToTop = () => {
  const { pathname } = useLocation();

  useEffect(() => {
    window.scrollTo(0, 0);
  }, [pathname]);

  return null;
};

export default ScrollToTop;


--- File: ./src/components/layout/DesktopTopNav.jsx ---

// src/components/layout/DesktopTopNav.jsx
import React from "react";
import { useLocation, useNavigate } from "react-router-dom";
import Icon from "../AppIcon";

export default function DesktopTopNav({ showBack = false, title, subtitle }) {
  const location = useLocation();
  const navigate = useNavigate();
  const pathname = location.pathname || "";

  // Tentukan id tab yang aktif berdasarkan pathname
  const activeId = (() => {
    if (pathname === "/" || pathname.startsWith("/home-dashboard")) return "home";
    if (pathname.startsWith("/photo-diagnosis") || pathname.startsWith("/diagnosis-results")) return "diagnosis";
    if (pathname.startsWith("/farming-calendar")) return "calendar";
    if (pathname.startsWith("/community-alerts")) return "community";
    if (pathname.startsWith("/diagnosis-history")) return "history";
    return "";
  })();

  const items = [
    { id: "home",      label: "Beranda",   path: "/home-dashboard",   icon: "Home" },
    { id: "diagnosis", label: "Diagnosis", path: "/photo-diagnosis",  icon: "Camera" },
    { id: "calendar",  label: "Kalender",  path: "/farming-calendar", icon: "Calendar" },
    { id: "community", label: "Komunitas", path: "/community-alerts", icon: "AlertTriangle" },
    { id: "history",   label: "Riwayat",   path: "/diagnosis-history",icon: "History" },
  ];

  const isActive = (id) => id === activeId;

  return (
    <header className="hidden md:block sticky top-0 z-50 border-b border-border bg-card/80 backdrop-blur">
      <div className="mx-auto max-w-screen-xl px-4 md:px-6 lg:px-8">
        <div className="flex h-14 items-center gap-3">
          {showBack && (
            <button
              onClick={() => navigate(-1)}
              className="inline-flex h-9 w-9 items-center justify-center rounded-lg hover:bg-muted"
              aria-label="Kembali"
              title="Kembali"
            >
              <Icon name="ArrowLeft" size={20} />
            </button>
          )}

          <div className="flex items-center gap-2 pr-4 border-r border-border">
            <span className="text-sm font-semibold">AI Tani Kupang</span>
            <span className="hidden lg:inline text-xs text-muted-foreground">Web</span>
          </div>

          <nav className="flex-1">
            <ul className="flex items-center gap-2">
              {items.map((it) => (
                <li key={it.id}>
                  <button
                    onClick={() => navigate(it.path)}
                    className={`inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm hover:bg-muted ${
                      isActive(it.id)
                        ? "bg-primary/10 text-primary font-semibold"
                        : "text-muted-foreground"
                    }`}
                    aria-current={isActive(it.id) ? "page" : undefined}
                    title={it.label}
                  >
                    <Icon name={it.icon} size={16} />
                    <span className="hidden sm:inline">{it.label}</span>
                  </button>
                </li>
              ))}
            </ul>
          </nav>

          {(title || subtitle) && (
            <div className="ml-auto hidden lg:block text-right">
              {title && <div className="text-sm font-semibold text-foreground">{title}</div>}
              {subtitle && <div className="text-xs text-muted-foreground">{subtitle}</div>}
            </div>
          )}
        </div>
      </div>
    </header>
  );
}



--- File: ./src/components/layout/MobileLayout.jsx ---

// src/components/layout/MobileLayout.jsx
import React from "react";
import { Outlet, NavLink } from "react-router-dom";
import BottomNavigation from "../ui/BottomNavigation";
import Icon from "../AppIcon";
import ErrorBoundary from "../ErrorBoundary";

const linkBase =
  "inline-flex items-center gap-2 px-3 py-2 rounded-xl text-sm font-medium transition-smooth";
const linkIdle =
  "text-muted-foreground hover:text-foreground hover:bg-muted/60";
const linkActive =
  "text-foreground bg-muted";

export default function MobileLayout() {
  return (
    <div className="min-h-dvh bg-background text-foreground">
      {/* Top navigation: hanya desktop/tablet */}
      <header className="hidden md:block sticky top-0 z-50 border-b border-border bg-card/80 backdrop-blur supports-[backdrop-filter]:bg-card/60">
        <div className="mx-auto w-full max-w-screen-xl px-6">
          <div className="h-14 flex items-center justify-between">
            <div className="flex items-center gap-2 px-2 py-1 rounded-lg">
              <span className="text-base font-semibold">AI Tani Kupang</span>
              <span className="text-xs text-muted-foreground">Web</span>
            </div>
            <nav className="flex items-center gap-1">
              {[
                { to: "/home-dashboard", label: "Beranda",    icon: "Home" },
                { to: "/photo-diagnosis", label: "Diagnosis",  icon: "Camera" },
                { to: "/farming-calendar",label: "Kalender",   icon: "Calendar" },
                { to: "/community-alerts",label: "Komunitas",  icon: "Users" },
                { to: "/diagnosis-history",label: "Riwayat",   icon: "History" },
              ].map((it) => (
                <NavLink
                  key={it.to}
                  to={it.to}
                  className={({ isActive }) =>
                    `${linkBase} ${isActive ? linkActive : linkIdle}`
                  }
                >
                  <Icon name={it.icon} size={18} />
                  {it.label}
                </NavLink>
              ))}
            </nav>
          </div>
        </div>
      </header>

      {/* Konten */}
      <main className="mx-auto w-full px-4 md:px-6 lg:px-8">
        <div className="mx-auto w-full max-w-screen-sm md:max-w-3xl lg:max-w-6xl py-4 md:py-8">
          <ErrorBoundary>
            <Outlet />
          </ErrorBoundary>
        </div>
      </main>

      {/* Bottom nav: hanya mobile */}
      <div className="md:hidden">
        <BottomNavigation />
      </div>
    </div>
  );
}



--- File: ./src/components/ui/BottomNavigation.jsx ---

// src/components/ui/BottomNavigation.jsx
import React from "react";
import { useLocation, useNavigate } from "react-router-dom";
import Icon from "../AppIcon";

export default function BottomNavigation() {
  const location = useLocation();
  const navigate = useNavigate();
  const pathname = location.pathname || "";

  // Sama seperti Desktop: mapping aktif berdasarkan pathname
  const activeId = (() => {
    if (pathname === "/" || pathname.startsWith("/home-dashboard")) return "home";
    if (pathname.startsWith("/photo-diagnosis") || pathname.startsWith("/diagnosis-results")) return "diagnosis";
    if (pathname.startsWith("/farming-calendar")) return "calendar";
    if (pathname.startsWith("/community-alerts")) return "community";
    return "";
  })();

  const items = [
    { id: "home",      label: "Beranda",   path: "/home-dashboard",   icon: "Home" },
    { id: "diagnosis", label: "Diagnosis", path: "/photo-diagnosis",  icon: "Camera" },
    { id: "calendar",  label: "Kalender",  path: "/farming-calendar", icon: "Calendar" },
    { id: "community", label: "Komunitas", path: "/community-alerts", icon: "AlertTriangle" },
  ];

  const isActive = (id) => id === activeId;

  return (
    // hanya mobile
    <nav className="md:hidden fixed bottom-0 inset-x-0 z-50 border-t border-border bg-card/90 backdrop-blur supports-[backdrop-filter]:bg-card/70">
      <div className="mx-auto max-w-[420px] px-3">
        <ul className="grid grid-cols-4 gap-1 py-2 text-xs">
          {items.map((it) => {
            const active = isActive(it.id);
            return (
              <li key={it.id}>
                <button
                  onClick={() => navigate(it.path)}
                  className={`w-full flex flex-col items-center justify-center rounded-lg px-2 py-1 transition-smooth ${
                    active
                      ? "text-primary bg-primary/10"
                      : "text-muted-foreground hover:text-foreground hover:bg-muted/60"
                  }`}
                  aria-label={it.label}
                  title={it.label}
                >
                  <Icon name={it.icon} size={22} strokeWidth={active ? 2.4 : 2} className="mb-0.5" />
                  <span className={`font-medium ${active ? "font-semibold" : ""}`}>{it.label}</span>
                </button>
              </li>
            );
          })}
        </ul>
      </div>
    </nav>
  );
}



--- File: ./src/components/ui/Button.jsx ---

// src/components/ui/Button.jsx

import React from 'react';
import { Slot } from "@radix-ui/react-slot";
import { cva } from "class-variance-authority";
import { cn } from "../../utils/cn";
import Icon from '../AppIcon';

const buttonVariants = cva(
    "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
    {
        variants: {
            variant: {
                default: "bg-primary text-primary-foreground hover:bg-primary/90",
                destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
                outline: "border border-input hover:bg-accent hover:text-accent-foreground",
                secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
                ghost: "hover:bg-accent hover:text-accent-foreground",
                link: "text-primary underline-offset-4 hover:underline",
                success: "bg-success text-success-foreground hover:bg-success/90",
                warning: "bg-warning text-warning-foreground hover:bg-warning/90",
                danger: "bg-error text-error-foreground hover:bg-error/90",
            },
            size: {
                default: "h-10 px-4 py-2",
                sm: "h-9 rounded-md px-3",
                lg: "h-11 rounded-md px-8",
                icon: "h-10 w-10",
                xs: "h-8 rounded-md px-2 text-xs",
                xl: "h-12 rounded-md px-10 text-base",
            },
        },
        defaultVariants: {
            variant: "default",
            size: "default",
        },
    }
);

const Button = React.forwardRef(({
    className,
    variant,
    size,
    asChild = false,
    children,
    loading = false,
    iconName = null,
    iconPosition = 'left',
    iconSize = null,
    fullWidth = false,
    disabled = false,
    ...props
}, ref) => {
    const Comp = asChild ? Slot : "button";

    const iconSizeMap = {
        xs: 12,
        sm: 14,
        default: 16,
        lg: 18,
        xl: 20,
        icon: 16,
    };

    const calculatedIconSize = iconSize || iconSizeMap?.[size] || 16;

    // [PERBAIKAN] Mengganti SVG spinner dengan versi yang valid dan lebih sederhana.
    const LoadingSpinner = () => (
        <svg
            className="animate-spin h-5 w-5 mr-3"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
        >
            <circle
                className="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                strokeWidth="4"
            ></circle>
            <path
                className="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
        </svg>
    );

    const renderIcon = () => {
        if (!iconName) return null;
        try {
            return (
                <Icon
                    name={iconName}
                    size={calculatedIconSize}
                    className={cn(
                        children && iconPosition === 'left' && "mr-2",
                        children && iconPosition === 'right' && "ml-2"
                    )}
                />
            );
        } catch {
            return null;
        }
    };

    const renderFallbackButton = () => (
        <button
            className={cn(
                buttonVariants({ variant, size, className }),
                fullWidth && "w-full"
            )}
            ref={ref}
            disabled={disabled || loading}
            {...props}
        >
            {loading && <LoadingSpinner />}
            {iconName && iconPosition === 'left' && !loading && renderIcon()}
            {children}
            {iconName && iconPosition === 'right' && !loading && renderIcon()}
        </button>
    );

    if (asChild) {
        // ... (logika asChild tetap sama)
    }

    return (
        <Comp
            className={cn(
                buttonVariants({ variant, size, className }),
                fullWidth && "w-full"
            )}
            ref={ref}
            disabled={disabled || loading}
            {...props}
        >
            {loading && <LoadingSpinner />}
            {iconName && iconPosition === 'left' && !loading && renderIcon()}
            {children}
            {iconName && iconPosition === 'right' && !loading && renderIcon()}
        </Comp>
    );
});

Button.displayName = "Button";
export default Button;


--- File: ./src/components/ui/Checkbox.jsx ---

import React from "react";
import { Check, Minus } from "lucide-react";
import { cn } from "../../utils/cn";

const Checkbox = React.forwardRef(({
    className,
    id,
    checked,
    indeterminate = false,
    disabled = false,
    required = false,
    label,
    description,
    error,
    size = "default",
    ...props
}, ref) => {
    // Generate unique ID if not provided
    const checkboxId = id || `checkbox-${Math.random()?.toString(36)?.substr(2, 9)}`;

    // Size variants
    const sizeClasses = {
        sm: "h-4 w-4",
        default: "h-4 w-4",
        lg: "h-5 w-5"
    };

    return (
        <div className={cn("flex items-start space-x-2", className)}>
            <div className="relative flex items-center">
                <input
                    type="checkbox"
                    ref={ref}
                    id={checkboxId}
                    checked={checked}
                    disabled={disabled}
                    required={required}
                    className="sr-only"
                    {...props}
                />

                <label
                    htmlFor={checkboxId}
                    className={cn(
                        "peer shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground cursor-pointer transition-colors",
                        sizeClasses?.[size],
                        checked && "bg-primary text-primary-foreground border-primary",
                        indeterminate && "bg-primary text-primary-foreground border-primary",
                        error && "border-destructive",
                        disabled && "cursor-not-allowed opacity-50"
                    )}
                >
                    {checked && !indeterminate && (
                        <Check className="h-3 w-3 text-current flex items-center justify-center" />
                    )}
                    {indeterminate && (
                        <Minus className="h-3 w-3 text-current flex items-center justify-center" />
                    )}
                </label>
            </div>
            {(label || description || error) && (
                <div className="flex-1 space-y-1">
                    {label && (
                        <label
                            htmlFor={checkboxId}
                            className={cn(
                                "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",
                                error ? "text-destructive" : "text-foreground"
                            )}
                        >
                            {label}
                            {required && <span className="text-destructive ml-1">*</span>}
                        </label>
                    )}

                    {description && !error && (
                        <p className="text-sm text-muted-foreground">
                            {description}
                        </p>
                    )}

                    {error && (
                        <p className="text-sm text-destructive">
                            {error}
                        </p>
                    )}
                </div>
            )}
        </div>
    );
});

Checkbox.displayName = "Checkbox";

// Checkbox Group component
const CheckboxGroup = React.forwardRef(({
    className,
    children,
    label,
    description,
    error,
    required = false,
    disabled = false,
    ...props
}, ref) => {
    return (
        <fieldset
            ref={ref}
            disabled={disabled}
            className={cn("space-y-3", className)}
            {...props}
        >
            {label && (
                <legend className={cn(
                    "text-sm font-medium",
                    error ? "text-destructive" : "text-foreground"
                )}>
                    {label}
                    {required && <span className="text-destructive ml-1">*</span>}
                </legend>
            )}

            {description && !error && (
                <p className="text-sm text-muted-foreground">
                    {description}
                </p>
            )}

            <div className="space-y-2">
                {children}
            </div>

            {error && (
                <p className="text-sm text-destructive">
                    {error}
                </p>
            )}
        </fieldset>
    );
});

CheckboxGroup.displayName = "CheckboxGroup";

export { Checkbox, CheckboxGroup };


--- File: ./src/components/ui/Input.jsx ---

import React from "react";
import { cn } from "../../utils/cn";

const Input = React.forwardRef(({
    className,
    type = "text",
    label,
    description,
    error,
    required = false,
    id,
    ...props
}, ref) => {
    // Generate unique ID if not provided
    const inputId = id || `input-${Math.random()?.toString(36)?.substr(2, 9)}`;

    // Base input classes
    const baseInputClasses = "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50";

    // Checkbox-specific styles
    if (type === "checkbox") {
        return (
            <input
                type="checkbox"
                className={cn(
                    "h-4 w-4 rounded border border-input bg-background text-primary focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
                    className
                )}
                ref={ref}
                id={inputId}
                {...props}
            />
        );
    }

    // Radio button-specific styles
    if (type === "radio") {
        return (
            <input
                type="radio"
                className={cn(
                    "h-4 w-4 rounded-full border border-input bg-background text-primary focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
                    className
                )}
                ref={ref}
                id={inputId}
                {...props}
            />
        );
    }

    // For regular inputs with wrapper structure
    return (
        <div className="space-y-2">
            {label && (
                <label
                    htmlFor={inputId}
                    className={cn(
                        "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",
                        error ? "text-destructive" : "text-foreground"
                    )}
                >
                    {label}
                    {required && <span className="text-destructive ml-1">*</span>}
                </label>
            )}

            <input
                type={type}
                className={cn(
                    baseInputClasses,
                    error && "border-destructive focus-visible:ring-destructive",
                    className
                )}
                ref={ref}
                id={inputId}
                {...props}
            />

            {description && !error && (
                <p className="text-sm text-muted-foreground">
                    {description}
                </p>
            )}

            {error && (
                <p className="text-sm text-destructive">
                    {error}
                </p>
            )}
        </div>
    );
});

Input.displayName = "Input";

export default Input;


--- File: ./src/components/ui/LoadingOverlay.jsx ---

import React from 'react';
import Icon from '../AppIcon';

const LoadingOverlay = ({ 
  isVisible = false, 
  message = 'Memproses...', 
  animationType = 'plant',
  className = '' 
}) => {
  if (!isVisible) return null;

  const renderLoadingAnimation = () => {
    switch (animationType) {
      case 'plant':
        return (
          <div className="loading-plant">
            <Icon name="Sprout" size={48} className="text-primary" />
          </div>
        );
      case 'camera':
        return (
          <div className="loading-plant">
            <Icon name="Camera" size={48} className="text-primary" />
          </div>
        );
      case 'sync':
        return (
          <div className="animate-spin">
            <Icon name="RefreshCw" size={48} className="text-primary" />
          </div>
        );
      default:
        return (
          <div className="loading-plant">
            <Icon name="Loader2" size={48} className="text-primary animate-spin" />
          </div>
        );
    }
  };

  return (
    <div 
      className={`
        fixed inset-0 bg-background/80 backdrop-blur-sm z-200 
        flex flex-col items-center justify-center p-6
        ${className}
      `}
      role="dialog"
      aria-modal="true"
      aria-labelledby="loading-message"
    >
      <div className="flex flex-col items-center space-y-4">
        {renderLoadingAnimation()}
        
        <div className="text-center">
          <p 
            id="loading-message"
            className="text-lg font-medium text-foreground mb-2"
          >
            {message}
          </p>
          <p className="text-sm text-muted-foreground">
            Mohon tunggu sebentar...
          </p>
        </div>
        
        {/* Progress indicator dots */}
        <div className="flex space-x-2">
          <div className="w-2 h-2 bg-primary rounded-full animate-pulse"></div>
          <div className="w-2 h-2 bg-primary rounded-full animate-pulse" style={{ animationDelay: '0.2s' }}></div>
          <div className="w-2 h-2 bg-primary rounded-full animate-pulse" style={{ animationDelay: '0.4s' }}></div>
        </div>
      </div>
    </div>
  );
};

export default LoadingOverlay;


--- File: ./src/components/ui/OfflineStatusBanner.jsx ---

// src/components/ui/OfflineStatusBanner.jsx
import React, { useState, useEffect } from 'react';
import Icon from '../AppIcon';

const OfflineStatusBanner = ({
  isOnline = true,
  pendingSyncCount = 0,
  onRetrySync = null,
  className = ''
}) => {
  const [isVisible, setIsVisible] = useState(false);
  const [showDetails, setShowDetails] = useState(false);

  useEffect(() => {
    // tampilkan banner saat offline ATAU ada pending sync
    setIsVisible(!isOnline || pendingSyncCount > 0);
  }, [isOnline, pendingSyncCount]);

  const handleRetry = () => {
    if (onRetrySync) onRetrySync();
  };

  const getBannerContent = () => {
    if (!isOnline) {
      return {
        icon: 'WifiOff',
        title: 'Tidak ada koneksi internet',
        message: 'Data akan disinkronkan saat koneksi kembali',
        bgColor: 'bg-warning/10',
        textColor: 'text-warning-foreground',
        iconColor: 'text-warning',
      };
    }
    if (pendingSyncCount > 0) {
      return {
        icon: 'CloudOff',
        title: `${pendingSyncCount} data menunggu sinkronisasi`,
        message: 'Benih telah ditanam, akan tumbuh saat terhubung',
        bgColor: 'bg-secondary/10',
        textColor: 'text-secondary-foreground',
        iconColor: 'text-secondary',
      };
    }
    return null;
  };

  if (!isVisible) return null;

  const content = getBannerContent();
  if (!content) return null;

  return (
    <div
      className={`${content.bgColor} border-b border-border transition-smooth ${className}`}
      role="banner"
      aria-live="polite"
    >
      <div className="px-4 py-3">
        <div className="flex items-center justify-between">
          <div className="flex items-center space-x-3 flex-1">
            <Icon name={content.icon} size={20} className={content.iconColor} />
            <div className="flex-1 min-w-0">
              <p className={`text-sm font-medium ${content.textColor}`}>{content.title}</p>
              {showDetails && (
                <p className={`text-xs ${content.textColor} opacity-80 mt-1`}>
                  {content.message}
                </p>
              )}
            </div>
          </div>

          <div className="flex items-center space-x-2">
            {onRetrySync && isOnline && pendingSyncCount > 0 && (
              <button
                onClick={handleRetry}
                className="text-xs px-3 py-1 rounded-md font-medium bg-secondary text-secondary-foreground hover:bg-secondary/90 transition-smooth haptic-feedback"
                aria-label="Coba sinkronisasi ulang"
              >
                Sinkron
              </button>
            )}
            <button
              onClick={() => setShowDetails(!showDetails)}
              className={`p-1 rounded-md transition-smooth ${content.iconColor} hover:bg-black/5`}
              aria-label={showDetails ? 'Sembunyikan detail' : 'Tampilkan detail'}
            >
              <Icon name={showDetails ? 'ChevronUp' : 'ChevronDown'} size={16} />
            </button>
          </div>
        </div>

        {/* indikator status */}
        <div className="flex items-center mt-2 space-x-2">
          <div className={`w-2 h-2 rounded-full ${isOnline ? 'bg-success animate-pulse' : 'bg-warning'}`} />
          <span className={`text-xs ${content.textColor} opacity-70`}>
            {isOnline ? 'Terhubung' : 'Terputus'}
          </span>
        </div>
      </div>
    </div>
  );
};

export default OfflineStatusBanner;



--- File: ./src/components/ui/Select.jsx ---

// components/ui/Select.jsx - Shadcn style Select
import React, { useState } from "react";
import { ChevronDown, Check, Search, X } from "lucide-react";
import { cn } from "../../utils/cn";
import Button from "./Button";
import Input from "./Input";

const Select = React.forwardRef(({
    className,
    options = [],
    value,
    defaultValue,
    placeholder = "Select an option",
    multiple = false,
    disabled = false,
    required = false,
    label,
    description,
    error,
    searchable = false,
    clearable = false,
    loading = false,
    id,
    name,
    onChange,
    onOpenChange,
    ...props
}, ref) => {
    const [isOpen, setIsOpen] = useState(false);
    const [searchTerm, setSearchTerm] = useState("");

    // Generate unique ID if not provided
    const selectId = id || `select-${Math.random()?.toString(36)?.substr(2, 9)}`;

    // Filter options based on search
    const filteredOptions = searchable && searchTerm
        ? options?.filter(option =>
            option?.label?.toLowerCase()?.includes(searchTerm?.toLowerCase()) ||
            (option?.value && option?.value?.toString()?.toLowerCase()?.includes(searchTerm?.toLowerCase()))
        )
        : options;

    // Get selected option(s) for display
    const getSelectedDisplay = () => {
        if (!value) return placeholder;

        if (multiple) {
            const selectedOptions = options?.filter(opt => value?.includes(opt?.value));
            if (selectedOptions?.length === 0) return placeholder;
            if (selectedOptions?.length === 1) return selectedOptions?.[0]?.label;
            return `${selectedOptions?.length} items selected`;
        }

        const selectedOption = options?.find(opt => opt?.value === value);
        return selectedOption ? selectedOption?.label : placeholder;
    };

    const handleToggle = () => {
        if (!disabled) {
            const newIsOpen = !isOpen;
            setIsOpen(newIsOpen);
            onOpenChange?.(newIsOpen);
            if (!newIsOpen) {
                setSearchTerm("");
            }
        }
    };

    const handleOptionSelect = (option) => {
        if (multiple) {
            const newValue = value || [];
            const updatedValue = newValue?.includes(option?.value)
                ? newValue?.filter(v => v !== option?.value)
                : [...newValue, option?.value];
            onChange?.(updatedValue);
        } else {
            onChange?.(option?.value);
            setIsOpen(false);
            onOpenChange?.(false);
        }
    };

    const handleClear = (e) => {
        e?.stopPropagation();
        onChange?.(multiple ? [] : '');
    };

    const handleSearchChange = (e) => {
        setSearchTerm(e?.target?.value);
    };

    const isSelected = (optionValue) => {
        if (multiple) {
            return value?.includes(optionValue) || false;
        }
        return value === optionValue;
    };

    const hasValue = multiple ? value?.length > 0 : value !== undefined && value !== '';

    return (
        <div className={cn("relative", className)}>
            {label && (
                <label
                    htmlFor={selectId}
                    className={cn(
                        "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 mb-2 block",
                        error ? "text-destructive" : "text-foreground"
                    )}
                >
                    {label}
                    {required && <span className="text-destructive ml-1">*</span>}
                </label>
            )}
            <div className="relative">
                <button
                    ref={ref}
                    id={selectId}
                    type="button"
                    className={cn(
                        "flex h-10 w-full items-center justify-between rounded-md border border-input bg-white text-black px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
                        error && "border-destructive focus:ring-destructive",
                        !hasValue && "text-muted-foreground"
                    )}
                    onClick={handleToggle}
                    disabled={disabled}
                    aria-expanded={isOpen}
                    aria-haspopup="listbox"
                    {...props}
                >
                    <span className="truncate">{getSelectedDisplay()}</span>

                    <div className="flex items-center gap-1">
                        {loading && (
                            <svg className="animate-spin h-4 w-4" viewBox="0 0 24 24">
                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" />
                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                            </svg>
                        )}

                        {clearable && hasValue && !loading && (
                            <Button
                                variant="ghost"
                                size="icon"
                                className="h-4 w-4"
                                onClick={handleClear}
                            >
                                <X className="h-3 w-3" />
                            </Button>
                        )}

                        <ChevronDown className={cn("h-4 w-4 transition-transform", isOpen && "rotate-180")} />
                    </div>
                </button>

                {/* Hidden native select for form submission */}
                <select
                    name={name}
                    value={value || ''}
                    onChange={() => { }} // Controlled by our custom logic
                    className="sr-only"
                    tabIndex={-1}
                    multiple={multiple}
                    required={required}
                >
                    <option value="">Select...</option>
                    {options?.map(option => (
                        <option key={option?.value} value={option?.value}>
                            {option?.label}
                        </option>
                    ))}
                </select>

                {/* Dropdown */}
                {isOpen && (
                    <div className="absolute z-50 w-full mt-1 bg-white text-black border border-border rounded-md shadow-md">
                        {searchable && (
                            <div className="p-2 border-b">
                                <div className="relative">
                                    <Search className="absolute left-2 top-2.5 h-4 w-4 text-muted-foreground" />
                                    <Input
                                        placeholder="Search options..."
                                        value={searchTerm}
                                        onChange={handleSearchChange}
                                        className="pl-8"
                                    />
                                </div>
                            </div>
                        )}

                        <div className="py-1 max-h-60 overflow-auto">
                            {filteredOptions?.length === 0 ? (
                                <div className="px-3 py-2 text-sm text-muted-foreground">
                                    {searchTerm ? 'No options found' : 'No options available'}
                                </div>
                            ) : (
                                filteredOptions?.map((option) => (
                                    <div
                                        key={option?.value}
                                        className={cn(
                                            "relative flex cursor-pointer select-none items-center rounded-sm px-3 py-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground",
                                            isSelected(option?.value) && "bg-primary text-primary-foreground",
                                            option?.disabled && "pointer-events-none opacity-50"
                                        )}
                                        onClick={() => !option?.disabled && handleOptionSelect(option)}
                                    >
                                        <span className="flex-1">{option?.label}</span>
                                        {multiple && isSelected(option?.value) && (
                                            <Check className="h-4 w-4" />
                                        )}
                                        {option?.description && (
                                            <span className="text-xs text-muted-foreground ml-2">
                                                {option?.description}
                                            </span>
                                        )}
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                )}
            </div>
            {description && !error && (
                <p className="text-sm text-muted-foreground mt-1">
                    {description}
                </p>
            )}
            {error && (
                <p className="text-sm text-destructive mt-1">
                    {error}
                </p>
            )}
        </div>
    );
});

Select.displayName = "Select";

export default Select;


--- File: ./src/components/ui/ShareActionSheet.jsx ---

import React, { useState } from 'react';
import Icon from '../AppIcon';
import Button from './Button';

const ShareActionSheet = ({ 
  isOpen = false, 
  onClose = () => {}, 
  shareData = {},
  className = '' 
}) => {
  const [copySuccess, setCopySuccess] = useState(false);

  const formatShareText = () => {
    const { title, description, results, timestamp } = shareData;
    
    let shareText = `ğŸŒ± AI Tani Kupang - ${title}\n\n`;
    
    if (description) {
      shareText += `ğŸ“ ${description}\n\n`;
    }
    
    if (results && Array.isArray(results)) {
      shareText += `ğŸ” Hasil Diagnosis:\n`;
      results?.forEach((result, index) => {
        shareText += `${index + 1}. ${result?.name} (${result?.confidence}%)\n`;
      });
      shareText += '\n';
    }
    
    if (timestamp) {
      shareText += `ğŸ“… ${new Date(timestamp)?.toLocaleString('id-ID')}\n\n`;
    }
    
    shareText += `Dibuat dengan AI Tani Kupang ğŸš€`;
    
    return shareText;
  };

  const handleWhatsAppShare = () => {
    const text = encodeURIComponent(formatShareText());
    const whatsappUrl = `https://wa.me/?text=${text}`;
    window.open(whatsappUrl, '_blank');
    onClose();
  };

  const handleCopyToClipboard = async () => {
    try {
      await navigator.clipboard?.writeText(formatShareText());
      setCopySuccess(true);
      setTimeout(() => setCopySuccess(false), 2000);
    } catch (err) {
      console.error('Failed to copy text: ', err);
      // Fallback for older browsers
      const textArea = document.createElement('textarea');
      textArea.value = formatShareText();
      document.body?.appendChild(textArea);
      textArea?.select();
      document.execCommand('copy');
      document.body?.removeChild(textArea);
      setCopySuccess(true);
      setTimeout(() => setCopySuccess(false), 2000);
    }
  };

  const handleNativeShare = async () => {
    if (navigator.share) {
      try {
        await navigator.share({
          title: shareData?.title || 'AI Tani Kupang',
          text: formatShareText(),
        });
        onClose();
      } catch (err) {
        if (err?.name !== 'AbortError') {
          console.error('Error sharing:', err);
        }
      }
    }
  };

  if (!isOpen) return null;

  return (
    <>
      {/* Backdrop */}
      <div 
        className="fixed inset-0 bg-black/50 z-300 transition-smooth"
        onClick={onClose}
        aria-hidden="true"
      />
      
      {/* Action Sheet */}
      <div 
        className={`
          fixed bottom-0 left-0 right-0 z-300
          bg-card rounded-t-lg border-t border-border
          transform transition-smooth
          ${className}
        `}
        role="dialog"
        aria-modal="true"
        aria-labelledby="share-title"
      >
        <div className="p-6">
          {/* Header */}
          <div className="flex items-center justify-between mb-6">
            <h3 
              id="share-title"
              className="text-lg font-semibold text-foreground"
            >
              Bagikan Hasil
            </h3>
            <button
              onClick={onClose}
              className="p-2 rounded-lg hover:bg-muted transition-smooth"
              aria-label="Tutup"
            >
              <Icon name="X" size={20} />
            </button>
          </div>
          
          {/* Preview */}
          <div className="bg-muted rounded-lg p-4 mb-6">
            <p className="text-sm text-muted-foreground mb-2">Preview:</p>
            <div className="text-sm text-foreground whitespace-pre-line max-h-32 overflow-y-auto">
              {formatShareText()}
            </div>
          </div>
          
          {/* Share Options */}
          <div className="space-y-3">
            {/* WhatsApp */}
            <Button
              variant="outline"
              fullWidth
              iconName="MessageCircle"
              iconPosition="left"
              onClick={handleWhatsAppShare}
              className="justify-start"
            >
              Bagikan ke WhatsApp
            </Button>
            
            {/* Native Share (if supported) */}
            {navigator.share && (
              <Button
                variant="outline"
                fullWidth
                iconName="Share"
                iconPosition="left"
                onClick={handleNativeShare}
                className="justify-start"
              >
                Bagikan ke Aplikasi Lain
              </Button>
            )}
            
            {/* Copy to Clipboard */}
            <Button
              variant="outline"
              fullWidth
              iconName={copySuccess ? "Check" : "Copy"}
              iconPosition="left"
              onClick={handleCopyToClipboard}
              className="justify-start"
            >
              {copySuccess ? 'Berhasil Disalin!' : 'Salin ke Clipboard'}
            </Button>
          </div>
          
          {/* Cancel */}
          <div className="mt-6 pt-4 border-t border-border">
            <Button
              variant="ghost"
              fullWidth
              onClick={onClose}
            >
              Batal
            </Button>
          </div>
        </div>
      </div>
    </>
  );
};

export default ShareActionSheet;


--- File: ./src/index.jsx ---

console.log("Aplikasi Mulai: index.jsx sedang dieksekusi."); // <-- PENANDA 1

import React from "react";
import { createRoot } from "react-dom/client";
import { configureStore } from '@reduxjs/toolkit';
import { Provider } from 'react-redux';
import { api } from './services/api'; 
import App from "./App";
import "./styles/tailwind.css";
import "./styles/index.css";
import authReducer from './services/authSlice'; // <-- 1. TAMBAHKAN IMPORT INI


console.log("Aplikasi Konfigurasi: Membuat Redux store."); // <-- PENANDA 2
const store = configureStore({
  reducer: {
    [api.reducerPath]: api.reducer,
        auth: authReducer, // <-- 2. TAMBAHKAN REDUCER BARU DI SINI

  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware().concat(api.middleware),
});

const container = document.getElementById("root");
const root = createRoot(container);

console.log("Aplikasi Render: Menjalankan root.render()."); // <-- PENANDA 3
root.render(
  <Provider store={store}>
    <App />
  </Provider>
);


--- File: ./src/offline/db.js ---

// src/offline/db.js
import { openDB } from 'idb';

const DB_NAME = 'ai-tani-kupang-db';
const DB_VERSION = 4; // bump untuk memastikan upgrade events store

export const dbPromise = openDB(DB_NAME, DB_VERSION, {
  upgrade(db, oldVersion, newVersion, transaction) {
    // 1) Request Queue
    if (!db.objectStoreNames.contains('request-queue')) {
      const rq = db.createObjectStore('request-queue', { keyPath: 'id' });
      rq.createIndex('ns', 'ns', { unique: false });
    } else {
      try {
        const rq = transaction.objectStore('request-queue');
        const hasIndex = rq.indexNames && rq.indexNames.contains
          ? rq.indexNames.contains('ns')
          : Array.from(rq.indexNames || []).includes('ns');
        if (!hasIndex) rq.createIndex('ns', 'ns', { unique: false });
      } catch {}
    }

    // 2) Events LKG store
    if (!db.objectStoreNames.contains('events')) {
      const ev = db.createObjectStore('events', { keyPath: 'id' });
      ev.createIndex('ns', 'ns', { unique: false });
      ev.createIndex('date', 'date', { unique: false }); // YYYY-MM-DD
    } else {
      try {
        const ev = transaction.objectStore('events');
        const names = Array.from(ev.indexNames || []);
        if (!names.includes('ns')) ev.createIndex('ns', 'ns', { unique: false });
        if (!names.includes('date')) ev.createIndex('date', 'date', { unique: false });
      } catch {}
    }
  },
});



--- File: ./src/offline/queueService.js ---

// src/offline/queueService.js
import { dbPromise } from './db';

// namespace per-tenant (biar antrean user A tidak campur user B)
const getTenantNs = () => {
  const accountId = localStorage.getItem('accountId') || 'demo';
  const userId = localStorage.getItem('userId') || 'demo';
  return `${accountId}:${userId}`;
};

const syncChannel = new BroadcastChannel('sync-channel');

const genId = () => (crypto?.randomUUID ? crypto.randomUUID() : `req_${Date.now()}_${Math.random().toString(16).slice(2)}`);

export async function enqueueRequest(request) {
  const db = await dbPromise;
  const ns = getTenantNs();

  const item = {
    id: genId(),
    ns,
    createdAt: new Date().toISOString(),
    ...request, // { type: 'createEvent' | 'updateEvent' | 'deleteEvent' | 'createAlert', payload }
  };

  await db.add('request-queue', item);
  console.log(`Queued [${ns}]`, item);
  syncChannel.postMessage({ action: 'queue-updated' });
}

// Minta sinkronisasi segera melalui BroadcastChannel yang dipantau App.jsx
export function requestSyncNow() {
  try {
    syncChannel.postMessage({ action: 'queue-updated' });
    console.log('Sync requested via BroadcastChannel.');
  } catch (e) {
    console.warn('Failed to request sync:', e);
  }
}

export async function getQueuedRequests() {
  const db = await dbPromise;
  const ns = getTenantNs();
  const all = await db.getAll('request-queue');
  return all.filter((req) => req.ns === ns);
}

export async function clearRequest(id) {
  const db = await dbPromise;
  await db.delete('request-queue', id);
  console.log('Dequeued:', id);
}

let isSyncing = false;

/**
 * retryQueue(apiClient)
 *  - apiClient: function (req) => Promise<void>
 *    Bentuk req: { id, ns, type, payload, createdAt }
 */
export async function retryQueue(apiClient) {
  if (isSyncing) {
    console.log('Sinkronisasi sudah berjalan; panggilan diabaikan.');
    return;
  }

  isSyncing = true;
  try {
    console.log('Mulai sinkronisasi antrean...');
    const requests = await getQueuedRequests();
    if (!requests.length) {
      console.log('Antrean kosong untuk tenant ini.');
      return;
    }

    for (const req of requests) {
      try {
        await apiClient(req); // kirim ke server
        await clearRequest(req.id);
      } catch (err) {
        console.error('Gagal kirim request; stop dan coba lagi nanti:', req, err);
        break; // hentikan loop â€” kemungkinan masih offline
      }
    }
  } finally {
    isSyncing = false;
    console.log('Selesai sinkronisasi antrean.');
  }
}

// =============================
// ğŸ’¾ LKG Cache Helpers (Events)
// =============================

const normalizeEventForStore = (e) => {
  const date = e.date || (e.start_at ? new Date(e.start_at).toISOString().slice(0, 10) : undefined);
  return { ...e, date };
};

export async function upsertEventsLocal(events) {
  if (!Array.isArray(events) || !events.length) return;
  const db = await dbPromise;
  const ns = getTenantNs();
  const tx = db.transaction('events', 'readwrite');
  for (const raw of events) {
    const e = normalizeEventForStore(raw);
    await tx.store.put({ ...e, ns });
  }
  await tx.done;
}

export async function upsertEventLocal(event) {
  if (!event) return;
  const db = await dbPromise;
  const ns = getTenantNs();
  const e = normalizeEventForStore(event);
  const tx = db.transaction('events', 'readwrite');
  await tx.store.put({ ...e, ns });
  await tx.done;
}

export async function getEventsByRange({ from, to }) {
  const db = await dbPromise;
  const ns = getTenantNs();
  const tx = db.transaction('events', 'readonly');
  const idx = tx.store.index('date');
  const fromKey = (from || new Date().toISOString()).slice(0, 10);
  const toKey = (to || new Date().toISOString()).slice(0, 10);
  const range = IDBKeyRange.bound(fromKey, toKey);
  const all = await idx.getAll(range);
  await tx.done;
  return (all || []).filter((e) => e.ns === ns && !e.__deleted);
}



--- File: ./src/offline/replayClient.js ---

// src/offline/replayClient.js

// Basis URL API (tanpa /api di akhir). Gunakan VITE_API_BASE_URL, fallback ke 127.0.0.1
export const API_BASE =
  (import.meta.env.VITE_API_BASE_URL || 'http://127.0.0.1:8787').replace(/\/$/, '');

// Header tenant (wajib sama dengan Worker)
const buildHeaders = () => {
  const h = new Headers();
  h.set('X-Account-Id', localStorage.getItem('accountId') || 'demo');
  h.set('X-User-Id', localStorage.getItem('userId') || 'demo');
  return h;
};

// Util: DataURL -> File (kalau foto offline disimpan sebagai dataURL)
const dataURLtoFile = (dataurl, filename = 'offline-photo.jpg') => {
  const [head, body] = dataurl.split(',');
  const mime = head.match(/:(.*?);/)[1];
  const bin = atob(body);
  const arr = new Uint8Array(bin.length);
  for (let i = 0; i < bin.length; i++) arr[i] = bin.charCodeAt(i);
  return new File([arr], filename, { type: mime });
};

// Builder URL: pastikan hit ke prefix /api agar Worker tetap menormalkan dengan aman
const apiUrl = (path) => {
  const p = path.startsWith('/') ? path : `/${path}`;
  return `${API_BASE}/api${p}`;
};

/**
 * apiClient(req) dipanggil oleh queueService.retryQueue(apiClient)
 * req: { id, type, payload, ns, createdAt, ... }
 * type yang didukung di sini:
 *  - 'createEvent'  (POST /api/events)
 *  - 'updateEvent'  (PATCH /api/events/:id)
 *  - 'deleteEvent'  (DELETE /api/events/:id)
 *  - 'createAlert'  (POST /api/alerts)  <-- opsional, kalau kamu enqueue alert
 */
export async function apiClient(req) {
  const headers = buildHeaders();
  let res;

  switch (req.type) {
    case 'createEvent': {
      headers.set('Content-Type', 'application/json');

      // Pastikan struktur body sesuai backend kamu
      const body = JSON.stringify({
        id: req.payload.id,
        title: req.payload.title,
        type: req.payload.type ?? null,
        crop: req.payload.crop ?? null,
        location: req.payload.location ?? null,
        notes: req.payload.notes ?? null, // biarkan string/JSON-string, worker akan parse bila perlu
        start_at:
          req.payload.start_at ||
          new Date(
            req.payload.date + (req.payload.time ? `T${req.payload.time}:00Z` : 'T00:00:00Z')
          ).toISOString(),
        end_at: req.payload.end_at ?? null,
        all_day: req.payload.all_day ? 1 : 0,
        status: req.payload.status ?? 'pending',
        source_type: req.payload.source_type ?? null,
        source_id: req.payload.source_id ?? null,
      });

      res = await fetch(apiUrl('/events'), { method: 'POST', headers, body });
      break;
    }

    case 'updateEvent': {
      headers.set('Content-Type', 'application/json');
      const { id, ...updates } = req.payload;
      res = await fetch(apiUrl(`/events/${id}`), {
        method: 'PATCH',
        headers,
        body: JSON.stringify(updates),
      });
      break;
    }

    case 'deleteEvent': {
      const id = req.payload?.id || req.payload;
      res = await fetch(apiUrl(`/events/${id}`), { method: 'DELETE', headers });
      break;
    }

    case 'createAlert': {
      // Kirim sebagai FormData agar cocok dengan handler /alerts (bisa form atau json)
      const p = { ...req.payload };
      const fd = new FormData();

      for (const [k, v] of Object.entries(p)) {
        if (k === 'photo') {
          if (typeof v === 'string' && v.startsWith('data:')) {
            const file = dataURLtoFile(v, p.photoName || 'offline-photo.jpg');
            fd.append('photo', file, file.name);
          } else if (v instanceof File) {
            fd.append('photo', v, v.name);
          }
        } else if (v != null && typeof v === 'object') {
          fd.append(k, JSON.stringify(v));
        } else if (v != null) {
          fd.append(k, v);
        }
      }

      // NOTE: jangan set Content-Type untuk FormData â€” biarkan browser yang set boundary
      res = await fetch(apiUrl('/alerts'), { method: 'POST', headers, body: fd });
      break;
    }

    default:
      throw new Error(`Unknown queued request type: ${req.type}`);
  }

  if (!res.ok) {
    const text = await res.text().catch(() => '');
    throw new Error(`Replay failed [${req.type}]: ${res.status} ${text}`);
  }

  // sebagian endpoint 204 No Content
  if (res.status === 204) return {};
  return res.json().catch(() => ({}));
}



--- File: ./src/pages/NotFound.jsx ---

import React from 'react';
import { useNavigate } from 'react-router-dom';
import Button from 'components/ui/Button';
import Icon from 'components/AppIcon';

const NotFound = () => {
  const navigate = useNavigate();

  const handleGoHome = () => {
    navigate('/');
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-background p-4">
      <div className="text-center max-w-md">
        <div className="flex justify-center mb-6">
          <div className="relative">
            <h1 className="text-9xl font-bold text-primary opacity-20">404</h1>
          </div>
        </div>

        <h2 className="text-2xl font-medium text-onBackground mb-2">Page Not Found</h2>
        <p className="text-onBackground/70 mb-8">
          The page you're looking for doesn't exist. Let's get you back!
        </p>

        <div className="flex flex-col sm:flex-row gap-4 justify-center">
          <Button
            variant="primary"
            icon={<Icon name="ArrowLeft" />}
            iconPosition="left"
            onClick={() => window.history?.back()}
          >
            Go Back
          </Button>

          <Button
            variant="outline"
            icon={<Icon name="Home" />}
            iconPosition="left"
            onClick={handleGoHome}
          >
            Back to Home
          </Button>
        </div>
      </div>
    </div>
  );
};

export default NotFound;



--- File: ./src/pages/community-alerts/components/AlertCard.jsx ---

// src/pages/community-alerts/components/AlertCard.jsx
import React from 'react';
import Icon from '../../../components/AppIcon';
import AppImage from '../../../components/AppImage';
import normalizePhotoUrl from '../../../utils/normalizePhotoUrl'; // â† tambah ini

const AlertCard = ({ alert, onViewDetails, className = '' }) => {
  const pestType = alert?.pestType || alert?.pest_type || 'Hama';
  const severity = (alert?.severity || '').toLowerCase();

  const getSeverityConfig = (sev) => {
    switch (sev) {
      case 'tinggi':
      case 'high':
        return { color: 'text-error', bg: 'bg-error/10', border: 'border-error/20', label: 'Tinggi', icon: 'AlertTriangle' };
      case 'sedang':
      case 'medium':
        return { color: 'text-warning', bg: 'bg-warning/10', border: 'border-warning/20', label: 'Sedang', icon: 'AlertCircle' };
      case 'rendah':
      case 'low':
      case 'baik':
        return { color: 'text-success', bg: 'bg-success/10', border: 'border-success/20', label: 'Baik', icon: 'CheckCircle' };
      default:
        return { color: 'text-muted-foreground', bg: 'bg-muted', border: 'border-border', label: 'Unknown', icon: 'HelpCircle' };
    }
  };

  const formatDistance = (d) => {
    if (d == null || Number.isNaN(d)) return null;
    if (d < 1) return `${Math.round(d * 1000)}m`;
    return `${d.toFixed(1)}km`;
  };

  const formatTimeAgo = (ts) => {
    if (!ts) return '';
    const now = new Date();
    const t = new Date(ts);
    const ms = now - t;
    const h = Math.floor(ms / 3_600_000);
    if (h < 1) return `${Math.max(0, Math.floor(ms / 60_000))} menit lalu`;
    if (h < 24) return `${h} jam lalu`;
    return t.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' });
  };

  const severityConfig = getSeverityConfig(severity);
  const affectedCrops =
    typeof alert?.affectedCrops === 'string'
      ? alert.affectedCrops
      : Array.isArray(alert?.affectedCrops)
        ? alert.affectedCrops.join(', ')
        : typeof alert?.affected_crops === 'string'
          ? alert.affected_crops
          : Array.isArray(alert?.affected_crops)
            ? alert.affected_crops.join(', ')
            : 'Tanaman tidak spesifik';

  // ==== Ganti jadi satu pintu normalisasi (hindari double-encode/spasi raw) ====
  const imgSrc = normalizePhotoUrl(alert?.photoKey, (alert?.photoUrl || alert?.photo_url || null));

  return (
    <div
      className={`bg-card border border-border rounded-xl p-6 hover:shadow-lg hover:border-primary/20 transition-smooth cursor-pointer ${className}`}
      onClick={() => onViewDetails(alert)}
    >
      {imgSrc && (
        <div className="mb-4 overflow-hidden rounded-lg border border-border/60">
          <AppImage
            src={imgSrc}
            alt="Foto laporan"
            className="w-full h-40 object-cover"
            loading="lazy"
          />
        </div>
      )}

      <div className="flex items-start justify-between mb-4">
        <div className="flex items-center space-x-3">
          <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${severityConfig.bg}`}>
            <Icon name={severityConfig.icon} size={24} className={severityConfig.color} />
          </div>
          <div>
            <h3 className="text-xl font-semibold text-foreground">{pestType}</h3>
            <p className="text-sm text-muted-foreground">
              {(alert?.distance != null ? `${formatDistance(alert.distance)} â€¢ ` : '')}{formatTimeAgo(alert?.timestamp)}
            </p>
          </div>
        </div>
        <div className={`px-3 py-1.5 rounded-lg font-bold text-xs border ${severityConfig.color} ${severityConfig.bg} ${severityConfig.border}`}>
          {severityConfig.label}
        </div>
      </div>

      <div className="space-y-3 mb-4">
        <p className="text-foreground line-clamp-2 leading-relaxed">
          {alert?.description?.split('\n')?.[0]}
        </p>
        <div className="flex items-center space-x-2">
          <Icon name="Leaf" size={16} className="text-primary" />
          <span className="text-sm font-medium text-foreground">{affectedCrops}</span>
        </div>
        <div className="flex items-center space-x-2">
          <Icon name="MapPin" size={16} className="text-muted-foreground" />
          <span className="text-sm text-muted-foreground">
            {alert?.reporterLocation || alert?.location || 'Lokasi tidak tersedia'}
          </span>
        </div>
      </div>

      <div className="flex items-center justify-between pt-4 border-t border-border">
        <div className="flex items-center space-x-4">
          {alert?.hasPhoto && !imgSrc && (
            <div className="flex items-center space-x-1 text-primary">
              <Icon name="Camera" size={16} /><span className="text-xs font-medium">Ada foto</span>
            </div>
          )}
          {(alert?.affectedArea || alert?.area) && (
            <div className="flex items-center space-x-1 text-muted-foreground">
              <Icon name="Square" size={16} /><span className="text-xs">{alert?.affectedArea || alert?.area}</span>
            </div>
          )}
        </div>
        <div className="flex items-center space-x-1 text-primary">
          <span className="text-xs font-medium">Lihat detail</span><Icon name="ChevronRight" size={16} />
        </div>
      </div>
    </div>
  );
};

export default AlertCard;



--- File: ./src/pages/community-alerts/components/AlertDetailModal.jsx ---

// src/pages/community-alerts/components/AlertDetailModal.jsx
import React, { useState } from 'react';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';
import AppImage from '../../../components/AppImage';
import normalizePhotoUrl from '../../../utils/normalizePhotoUrl'; // â† tambah ini

function getSeverityConfig(sevRaw) {
  const sev = (sevRaw || '').toLowerCase();
  switch (sev) {
    case 'tinggi':
    case 'high':
      return { color: 'text-error', bg: 'bg-error/10', border: 'border-error/20', label: 'tinggi' };
    case 'sedang':
    case 'medium':
      return { color: 'text-warning', bg: 'bg-warning/10', border: 'border-warning/20', label: 'sedang' };
    case 'rendah':
    case 'low':
    case 'baik':
      return { color: 'text-success', bg: 'bg-success/10', border: 'border-success/20', label: 'rendah' };
    default:
      return { color: 'text-muted-foreground', bg: 'bg-muted', border: 'border-border', label: '-' };
  }
}

function fmtDate(ts) {
  if (!ts) return '-';
  try {
    const d = new Date(ts);
    return d.toLocaleString('id-ID', {
      day: '2-digit',
      month: 'long',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
    });
  } catch {
    return String(ts);
  }
}

function ensureCoords(c) {
  if (!c) return null;
  if (typeof c === 'string') {
    try { return JSON.parse(c); } catch { return null; }
  }
  if (typeof c === 'object' && c.lat != null && c.lng != null) return c;
  return null;
}

export default function AlertDetailModal({ isOpen, onClose, alert, className = '' }) {
  const [tab, setTab] = useState('detail');

  const pestType = alert?.pestType ?? alert?.pest_type ?? 'Hama';
  const severityCfg = getSeverityConfig(alert?.severity);
  const affectedCrops =
    typeof alert?.affectedCrops === 'string'
      ? alert.affectedCrops
      : Array.isArray(alert?.affectedCrops)
        ? alert.affectedCrops.join(', ')
        : typeof alert?.affected_crops === 'string'
          ? alert.affected_crops
          : Array.isArray(alert?.affected_crops)
            ? alert.affected_crops.join(', ')
            : 'Tanaman tidak spesifik';

  const coords = ensureCoords(alert?.coordinates);

  // ==== Ganti jadi satu pintu normalisasi (hindari double-encode/spasi raw) ====
  const imgSrc = normalizePhotoUrl(alert?.photoKey, (alert?.photoUrl ?? alert?.photo_url ?? null));

  const mapEmbedUrl = (() => {
    if (!coords) return null;
    const d = 0.01; // sekitar ~1.1km
    const minLon = coords.lng - d;
    const minLat = coords.lat - d;
    const maxLon = coords.lng + d;
    const maxLat = coords.lat + d;
    return `https://www.openstreetmap.org/export/embed.html?bbox=${minLon},${minLat},${maxLon},${maxLat}&layer=mapnik&marker=${coords.lat},${coords.lng}`;
  })();

  if (!isOpen) return null;

  return (
    <>
      <div className="fixed inset-0 bg-black/50 z-300 transition-smooth" onClick={onClose} />
      <div className={`fixed inset-0 z-300 overflow-y-auto flex items-center justify-center p-4 ${className}`}>
        <div className="bg-card rounded-xl border border-border w-full max-w-2xl">
          {/* Header */}
          <div className="flex items-center justify-between p-4 border-b border-border">
            <div className="flex items-center gap-2">
              <Icon name="AlertTriangle" size={20} className={severityCfg.color} />
              <div className="leading-tight">
                <div className="font-semibold text-foreground capitalize">{pestType}</div>
                <div className="text-xs text-muted-foreground">
                  {alert?.location || (coords ? `${coords.lat}, ${coords.lng}` : '-')}{' â€¢ '}
                  {fmtDate(alert?.timestamp)}
                </div>
              </div>
            </div>
            <Button variant="ghost" size="icon" iconName="X" onClick={onClose} />
          </div>

          {/* Foto */}
          {imgSrc && (
            <div className="mx-4 mt-4 overflow-hidden rounded-lg border border-border/60">
              <AppImage
                src={imgSrc}
                alt="Foto laporan"
                className="w-full h-60 object-cover"
                loading="lazy"
              />
            </div>
          )}

          {/* Tabs */}
          <div className="px-4 mt-4">
            <div className="flex items-center gap-4 border-b border-border">
              <button
                className={`py-2 text-sm font-medium ${tab === 'detail' ? 'text-primary border-b-2 border-primary' : 'text-muted-foreground'}`}
                onClick={() => setTab('detail')}
                type="button"
              >
                Detail Peringatan
              </button>
              <button
                className={`py-2 text-sm font-medium ${tab === 'discuss' ? 'text-primary border-b-2 border-primary' : 'text-muted-foreground'}`}
                onClick={() => setTab('discuss')}
                type="button"
              >
                Diskusi Komunitas
              </button>
            </div>
          </div>

          {/* Body */}
          {tab === 'detail' ? (
            <div className="p-4 space-y-6">
              <div className="flex items-center gap-4">
                <div className={`inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-semibold ${severityCfg.bg} ${severityCfg.color} ${severityCfg.border} border`}>
                  <Icon name="AlertTriangle" size={14} />
                  {`Tingkat Bahaya: ${severityCfg.label}`}
                </div>
                {alert?.distance != null && (
                  <div className="text-xs text-muted-foreground flex items-center gap-1">
                    <Icon name="Ruler" size={14} /> Jarak: {typeof alert.distance === 'number' ? `${alert.distance.toFixed(1)}km` : `${alert.distance}`} 
                  </div>
                )}
              </div>

              <section>
                <h4 className="text-sm font-semibold text-foreground mb-1">Deskripsi</h4>
                <p className="text-sm text-foreground whitespace-pre-wrap">
                  {alert?.description || '-'}
                </p>
              </section>

              <section>
                <h4 className="text-sm font-semibold text-foreground mb-1">Tanaman Terserang</h4>
                <div className="text-sm">{affectedCrops}</div>
              </section>

              <section className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="p-3 rounded-lg border border-border">
                  <div className="text-xs text-muted-foreground mb-1">Luas Area</div>
                  <div className="text-sm text-foreground">{alert?.affectedArea ?? alert?.affected_area ?? '-'}</div>
                </div>
                <div className="p-3 rounded-lg border border-border">
                  <div className="text-xs text-muted-foreground mb-1">Intensitas</div>
                  <div className="text-sm text-foreground">{alert?.pestCount ?? alert?.pest_count ?? '-'}</div>
                </div>
              </section>

              <section>
                <h4 className="text-sm font-semibold text-foreground mb-2">Lokasi</h4>
                {coords ? (
                  <div className="overflow-hidden rounded-lg border border-border">
                    <iframe
                      title="Lokasi peringatan (OSM)"
                      src={mapEmbedUrl}
                      className="w-full h-64"
                      loading="lazy"
                      referrerPolicy="no-referrer-when-downgrade"
                    />
                  </div>
                ) : (
                  <div className="text-sm text-muted-foreground">Lokasi tidak tersedia</div>
                )}
              </section>
            </div>
          ) : (
            <div className="p-4">
              <div className="text-sm text-muted-foreground">
                Fitur diskusi akan ditambahkan.
              </div>
            </div>
          )}

          {/* Footer */}
          <div className="p-4 border-t border-border flex justify-end">
            <Button variant="default" onClick={onClose} iconName="Check">Tutup</Button>
          </div>
        </div>
      </div>
    </>
  );
}



--- File: ./src/pages/community-alerts/components/AlertFilters.jsx ---

import React, { useState } from 'react';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';
import Select from '../../../components/ui/Select';

const AlertFilters = ({
  filters,
  onFilterChange,
  alertCount,
  onClearFilters,
  className = ''
}) => {
  const [isExpanded, setIsExpanded] = useState(false);

  const pestTypeOptions = [
    { value: 'all', label: 'Semua Hama' },
    { value: 'wereng', label: 'Wereng' },
    { value: 'ulat', label: 'Ulat' },
    { value: 'kutu', label: 'Kutu' },
    { value: 'trips', label: 'Trips' },
    { value: 'penggerek', label: 'Penggerek' }
  ];

  const severityOptions = [
    { value: 'all', label: 'Semua Tingkat' },
    { value: 'tinggi', label: 'Tinggi' },
    { value: 'sedang', label: 'Sedang' },
    { value: 'rendah', label: 'Baik' }
  ];

  const distanceOptions = [
    { value: 'all', label: 'Semua Jarak' },
    { value: '1', label: 'Dalam 1km' },
    { value: '5', label: 'Dalam 5km' },
    { value: '10', label: 'Dalam 10km' },
    { value: '25', label: 'Dalam 25km' }
  ];

  const timeOptions = [
    { value: '6', label: '6 jam terakhir' },
    { value: '12', label: '12 jam terakhir' },
    { value: '24', label: '24 jam terakhir' },
    { value: '72', label: '3 hari terakhir' },
    { value: '168', label: '1 minggu terakhir' }
  ];

  const hasActiveFilters = 
    filters?.pestType !== 'all' || 
    filters?.severity !== 'all' || 
    filters?.distance !== 'all' ||
    filters?.timeWindow !== '24';

  return (
    <div className={`bg-card border border-border rounded-xl shadow-sm ${className}`}>
      {/* Filter Header */}
      <div className="p-4 border-b border-border">
        <div className="flex items-center justify-between">
          <div className="flex items-center space-x-3">
            <div className="flex items-center space-x-2">
              <Icon name="Filter" size={20} className="text-muted-foreground" />
              <span className="text-lg font-bold text-foreground">Filter</span>
            </div>
            
            {hasActiveFilters && (
              <div className="w-2 h-2 bg-primary rounded-full" />
            )}
          </div>

          <div className="flex items-center space-x-2">
            {hasActiveFilters && (
              <Button
                variant="ghost"
                size="sm"
                onClick={onClearFilters}
                className="text-primary hover:text-primary/80 rounded-lg"
              >
                Reset
              </Button>
            )}
            
            <button
              onClick={() => setIsExpanded(!isExpanded)}
              className="p-2 rounded-lg hover:bg-muted transition-smooth"
            >
              <Icon 
                name={isExpanded ? "ChevronUp" : "ChevronDown"} 
                size={20} 
                className="text-muted-foreground" 
              />
            </button>
          </div>
        </div>
        
        {/* Results count */}
        <div className="flex items-center space-x-2 mt-2">
          <div className="text-sm text-muted-foreground">
            Menampilkan <span className="font-bold text-foreground">{alertCount}</span> peringatan
          </div>
          
          {hasActiveFilters && (
            <div className="flex items-center space-x-1">
              <div className="w-1 h-1 bg-muted-foreground rounded-full" />
              <span className="text-xs text-primary font-medium">Filter aktif</span>
            </div>
          )}
        </div>
      </div>
      
      {/* Filter Controls */}
      {isExpanded && (
        <div className="p-4 space-y-6">
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {/* Pest Type Filter */}
            <div>
              <label className="block text-sm font-bold text-foreground mb-2">
                Jenis Hama
              </label>
              <Select
                value={filters?.pestType}
                onChange={(value) => onFilterChange('pestType', value)}
                options={pestTypeOptions}
                className="w-full rounded-xl"
              />
            </div>

            {/* Severity Filter */}
            <div>
              <label className="block text-sm font-bold text-foreground mb-2">
                Tingkat Bahaya
              </label>
              <Select
                value={filters?.severity}
                onChange={(value) => onFilterChange('severity', value)}
                options={severityOptions}
                className="w-full rounded-xl"
              />
            </div>

            {/* Distance Filter */}
            <div>
              <label className="block text-sm font-bold text-foreground mb-2">
                Jarak
              </label>
              <Select
                value={filters?.distance}
                onChange={(value) => onFilterChange('distance', value)}
                options={distanceOptions}
                className="w-full rounded-xl"
              />
            </div>

            {/* Time Window Filter */}
            <div>
              <label className="block text-sm font-bold text-foreground mb-2">
                Periode Waktu
              </label>
              <Select
                value={filters?.timeWindow}
                onChange={(value) => onFilterChange('timeWindow', value)}
                options={timeOptions}
                className="w-full rounded-xl"
              />
            </div>
          </div>

          {/* Quick Filter Pills */}
          <div className="pt-4 border-t border-border">
            <div className="text-sm font-bold text-foreground mb-3">
              Filter Cepat
            </div>
            
            <div className="flex flex-wrap gap-3">
              <button
                onClick={() => {
                  onFilterChange('severity', 'tinggi');
                  onFilterChange('distance', '5');
                }}
                className="px-4 py-2 text-sm font-bold bg-error/10 text-error border border-error/20 rounded-xl hover:bg-error/20 transition-smooth"
              >
                ğŸš¨ Darurat Terdekat
              </button>
              
              <button
                onClick={() => {
                  onFilterChange('timeWindow', '6');
                  onFilterChange('distance', '10');
                }}
                className="px-4 py-2 text-sm font-bold bg-warning/10 text-warning border border-warning/20 rounded-xl hover:bg-warning/20 transition-smooth"
              >
                â° Baru Dilaporkan
              </button>
              
              <button
                onClick={() => {
                  onFilterChange('distance', '1');
                }}
                className="px-4 py-2 text-sm font-bold bg-primary/10 text-primary border border-primary/20 rounded-xl hover:bg-primary/20 transition-smooth"
              >
                ğŸ“ Sekitar Saya
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default AlertFilters;


--- File: ./src/pages/community-alerts/components/CommunityMap.jsx ---

// src/pages/community-alerts/components/CommunityMap.jsx
import React, { useEffect, useRef } from 'react';

// Lightweight Leaflet loader via CDN to avoid bundling
function useLeaflet() {
  const loadedRef = useRef(false);
  useEffect(() => {
    if (loadedRef.current) return;
    loadedRef.current = true;
    // CSS
    if (!document.getElementById('leaflet-css')) {
      const link = document.createElement('link');
      link.id = 'leaflet-css';
      link.rel = 'stylesheet';
      link.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
      document.head.appendChild(link);
    }
    // JS
    if (!document.getElementById('leaflet-js')) {
      const script = document.createElement('script');
      script.id = 'leaflet-js';
      script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
      script.defer = true;
      document.body.appendChild(script);
    }
  }, []);
}

export default function CommunityMap({ alerts = [], userPos = null }) {
  const mapRef = useRef(null);
  const containerRef = useRef(null);
  useLeaflet();

  useEffect(() => {
    const ensure = () => typeof window !== 'undefined' && window.L && containerRef.current;
    let retries = 0;
    const init = () => {
      if (!ensure()) {
        if (retries++ < 20) setTimeout(init, 200);
        return;
      }
      const L = window.L;
      if (!mapRef.current) {
        const center = userPos ? [userPos.lat, userPos.lon || userPos.lng] : [-10.177, 123.607];
        const map = L.map(containerRef.current).setView(center, 11);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 18,
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
        mapRef.current = map;
      }
      const map = mapRef.current;
      // Clear existing markers layer if any
      if (map._alertLayer) {
        map.removeLayer(map._alertLayer);
      }
      const layer = window.L.layerGroup();
      alerts.forEach((a) => {
        const c = a.coordinates;
        if (!c || typeof c.lat !== 'number' || typeof (c.lon ?? c.lng) !== 'number') return;
        const marker = window.L.marker([c.lat, c.lon ?? c.lng]).bindPopup(
          `<strong>${(a.pestType || 'Laporan')}</strong><br/>${(a.description || '').slice(0, 60)}...`
        );
        layer.addLayer(marker);
      });
      layer.addTo(map);
      map._alertLayer = layer;
    };
    init();
  }, [alerts, userPos]);

  return (
    <div className="w-full h-64 rounded-xl border border-border overflow-hidden bg-muted" ref={containerRef} aria-label="Peta Komunitas" />
  );
}




--- File: ./src/pages/community-alerts/components/ReportPestModal.jsx ---

// src/pages/community-alerts/components/ReportPestModal.jsx
import React, { useEffect, useState } from 'react';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';
import Input from '../../../components/ui/Input';
import { useCreateAlertMutation } from '../../../services/alertsApi';
import { enqueueRequest } from '../../../offline/queueService';

// Helper: File -> Data URL (untuk antrean offline)
const fileToDataURL = (file) =>
  new Promise((resolve, reject) => {
    const r = new FileReader();
    r.onload = () => resolve(r.result);
    r.onerror = reject;
    r.readAsDataURL(file);
  });

const PEST_TYPES = [
  { value: 'wereng', label: 'Wereng' },
  { value: 'ulat', label: 'Ulat' },
  { value: 'kutu', label: 'Kutu Daun' },
  { value: 'trips', label: 'Trips' },
  { value: 'penggerek', label: 'Penggerek Batang' },
  { value: 'lainnya', label: 'Lainnya' },
];

const SEVERITIES = [
  { value: 'rendah', label: 'Rendah - Sedikit kerusakan' },
  { value: 'sedang', label: 'Sedang - Kerusakan terlihat' },
  { value: 'tinggi', label: 'Tinggi - Kerusakan parah' },
];

const initialForm = {
  pestType: '',
  severity: 'sedang',
  affectedCrops: '',
  description: '',
  affectedArea: '',
  pestCount: '',
  location: '',
  coordinates: null,   // { lat, lng }
  photo: null,
};

export default function ReportPestModal({ isOpen, onClose, className = '' }) {
  const [createAlert] = useCreateAlertMutation();
  const [form, setForm] = useState(initialForm);
  const [photoPreview, setPhotoPreview] = useState(null);
  const [locStatus, setLocStatus] = useState('idle'); // idle|loading|success|error
  const [submitting, setSubmitting] = useState(false);

  // Ambil GPS otomatis saat modal dibuka
  useEffect(() => {
    if (!isOpen) return;
    if (!navigator.geolocation) return;
    setLocStatus('loading');
    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const coords = { lat: pos.coords.latitude, lng: pos.coords.longitude };
        setForm((s) => ({
          ...s,
          coordinates: coords,
          location: `${coords.lat.toFixed(6)}, ${coords.lng.toFixed(6)}`
        }));
        setLocStatus('success');
      },
      () => setLocStatus('error'),
      { enableHighAccuracy: true, maximumAge: 60000, timeout: 8000 }
    );
  }, [isOpen]);

  const onChange = (field, value) => setForm((s) => ({ ...s, [field]: value }));

  const handlePhotoUpload = (e) => {
    const file = e.target.files?.[0] || null;
    if (!file) {
      setForm((s) => ({ ...s, photo: null }));
      setPhotoPreview(null);
      return;
    }
    const allowed = ['image/jpeg', 'image/png', 'image/webp'];
    const maxBytes = 5 * 1024 * 1024; // 5MB
    if (!allowed.includes(file.type)) {
      alert('Format foto harus JPG, PNG, atau WEBP');
      return;
    }
    if (file.size > maxBytes) {
      alert('Ukuran foto maksimal 5MB');
      return;
    }
    setForm((s) => ({ ...s, photo: file }));
    setPhotoPreview(URL.createObjectURL(file));
  };

  const getCurrentLocation = () => {
    setLocStatus('loading');
    if (!navigator.geolocation) {
      setLocStatus('error');
      return;
    }
    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const coords = { lat: pos.coords.latitude, lng: pos.coords.longitude };
        setForm((s) => ({
          ...s,
          coordinates: coords,
          location: `${coords.lat.toFixed(6)}, ${coords.lng.toFixed(6)}`,
        }));
        setLocStatus('success');
      },
      () => setLocStatus('error')
    );
  };

  const buildPayload = async (forQueue = false) => {
    const payload = {
      pestType: form.pestType || 'unknown',
      severity: form.severity || 'sedang',
      description: form.description || '',
      affectedCrops: form.affectedCrops || null,
      affectedArea: form.affectedArea || null,
      pestCount: form.pestCount || null,
      location: form.location || null,
      coordinates: form.coordinates || null,
      timestamp: new Date().toISOString(),
    };
    if (form.photo) {
      if (forQueue) {
        payload.photo = await fileToDataURL(form.photo);
        payload.photoName = form.photo.name || 'photo.jpg';
      } else {
        payload.photo = form.photo; // akan dikirim multipart oleh RTK Query
      }
    }
    return payload;
  };

  const resetAndClose = (cb) => {
    setForm(initialForm);
    setPhotoPreview(null);
    setLocStatus('idle');
    cb && cb();
    onClose();
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (submitting) return;
    setSubmitting(true);
    try {
      const payload = await buildPayload(false);
      await createAlert(payload).unwrap();
      resetAndClose(() => alert('Laporan berhasil terkirim!'));
    } catch {
      try {
        const offlinePayload = await buildPayload(true);
        await enqueueRequest({ type: 'createAlert', payload: offlinePayload });
        resetAndClose(() =>
          alert('Anda sedang offline. Laporan disimpan & akan disinkronkan otomatis saat online.')
        );
      } catch {
        alert('Gagal menyimpan laporan. Coba lagi.');
      }
    } finally {
      setSubmitting(false);
    }
  };

  if (!isOpen) return null;

  return (
    <>
      {/* Backdrop */}
      // Ganti menjadi seperti ini:

{/* Backdrop */}
<div className="fixed inset-0 bg-black/50 z-[299] transition-smooth" onClick={() => !submitting && onClose()} />
{/* Modal Wrapper */}
<div className={`fixed inset-0 z-[300] overflow-y-auto flex items-center justify-center p-4 ${className}`}>
        <div className="bg-card rounded-lg border border-border w-full max-w-2xl max-h-[90vh] overflow-y-auto">
          {/* Header */}
          <div className="flex items-center justify-between p-6 border-b border-border">
            <div className="flex items-center space-x-2">
              <Icon name="AlertTriangle" size={24} className="text-warning" />
              <h2 className="text-xl font-semibold text-foreground">Laporkan Hama</h2>
            </div>
            <Button variant="ghost" size="icon" iconName="X" onClick={onClose} disabled={submitting} />
          </div>

          {/* Form */}
          <form onSubmit={handleSubmit} className="p-6 space-y-6">
            {/* Jenis Hama */}
            <div>
              <label className="block text-sm font-medium text-foreground mb-2">Jenis Hama *</label>
              <select
                value={form.pestType}
                onChange={(e) => onChange('pestType', e.target.value)}
                required
                className="w-full px-3 py-2 bg-input border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring"
              >
                <option value="">Pilih jenis hama</option>
                {PEST_TYPES.map((t) => (
                  <option key={t.value} value={t.value}>{t.label}</option>
                ))}
              </select>
            </div>

            {/* Tingkat Bahaya */}
            <div>
              <label className="block text-sm font-medium text-foreground mb-2">Tingkat Bahaya *</label>
              <select
                value={form.severity}
                onChange={(e) => onChange('severity', e.target.value)}
                required
                className="w-full px-3 py-2 bg-input border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring"
              >
                {SEVERITIES.map((s) => (
                  <option key={s.value} value={s.value}>{s.label}</option>
                ))}
              </select>
            </div>

            {/* Tanaman */}
            <Input
              label="Tanaman yang Terserang *"
              type="text"
              placeholder="Contoh: Padi, Jagung, Kacang"
              value={form.affectedCrops}
              onChange={(e) => onChange('affectedCrops', e.target.value)}
              required
            />

            {/* Deskripsi */}
            <div>
              <label className="block text-sm font-medium text-foreground mb-2">Deskripsi Kerusakan *</label>
              <textarea
                value={form.description}
                onChange={(e) => onChange('description', e.target.value)}
                placeholder="Jelaskan kerusakan yang terlihat pada tanaman..."
                required
                rows={4}
                className="w-full px-3 py-2 bg-input border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-ring resize-none"
              />
            </div>

            {/* Area & jumlah */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <Input
                label="Luas Area Terserang"
                type="text"
                placeholder="Contoh: 0.5 hektar"
                value={form.affectedArea}
                onChange={(e) => onChange('affectedArea', e.target.value)}
              />
              <Input
                label="Perkiraan Jumlah Hama"
                type="text"
                placeholder="Contoh: Banyak, Sedikit"
                value={form.pestCount}
                onChange={(e) => onChange('pestCount', e.target.value)}
              />
            </div>

            {/* Lokasi + GPS */}
            <div>
              <label className="block text-sm font-medium text-foreground mb-2">Lokasi</label>
              <div className="flex space-x-2">
                <Input
                  type="text"
                  placeholder="Koordinat akan terisi otomatis"
                  value={form.location}
                  onChange={(e) => onChange('location', e.target.value)}
                  className="flex-1"
                />
                <Button
                  type="button"
                  variant="outline"
                  iconName={locStatus === 'loading' ? 'Loader2' : 'MapPin'}
                  onClick={getCurrentLocation}
                  disabled={locStatus === 'loading'}
                  className={locStatus === 'loading' ? 'animate-spin' : ''}
                >
                  {locStatus === 'loading' ? 'Mencari...' : 'GPS'}
                </Button>
              </div>
              {locStatus === 'success' && <p className="text-xs text-success mt-1">Lokasi berhasil didapat</p>}
              {locStatus === 'error' && <p className="text-xs text-destructive mt-1">Gagal mendapatkan lokasi</p>}
            </div>

            {/* Foto */}
            <div>
              <label className="block text-sm font-medium text-foreground mb-2">Foto Kerusakan</label>
              <div className="space-y-3">
                <input
                  type="file"
                  accept="image/*"
                  onChange={handlePhotoUpload}
                  className="w-full px-3 py-2 bg-input border border-border rounded-md file:mr-4 file:py-1 file:px-3 file:rounded-md file:border-0 file:text-sm file:bg-primary file:text-primary-foreground hover:file:bg-primary/90"
                />
                {photoPreview && (
                  <div className="relative w-full h-48 bg-muted rounded-md overflow-hidden">
                    <img src={photoPreview} alt="Preview foto hama" className="w-full h-full object-cover" />
                    <button
                      type="button"
                      onClick={() => { setPhotoPreview(null); setForm((s) => ({ ...s, photo: null })); }}
                      className="absolute top-2 right-2 bg-error text-error-foreground rounded-full p-1 hover:bg-error/90"
                    >
                      <Icon name="X" size={16} />
                    </button>
                  </div>
                )}
              </div>
            </div>

            {/* Tombol aksi */}
            <div className="flex space-x-3 pt-4">
              <Button type="button" variant="outline" fullWidth onClick={onClose} disabled={submitting}>Batal</Button>
              <Button
  type="submit"
  variant="default"
  fullWidth
  loading={false}            // <â€” matikan spinner agar tidak render SVG path error
  iconName="Send"
  iconPosition="left"
  disabled={submitting}
>
  {submitting ? 'Mengirim...' : 'Kirim Laporan'}
</Button>


            </div>
          </form>
        </div>
      </div>
    </>
  );
}



--- File: ./src/pages/community-alerts/components/__tests__/AlertCard.test.jsx ---

import { render, screen, fireEvent, cleanup } from '@testing-library/react';
import { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';
import AlertCard from '../AlertCard';

const baseAlert = {
  pestType: 'Ulat Grayak',
  severity: 'high',
  timestamp: '2024-01-02T00:00:00Z',
  distance: 0.4,
  description: 'Serangan berat\nSegera tangani',
  affectedCrops: ['Jagung', 'Padi'],
  reporterLocation: 'Kupang',
  photoKey: 'folder/foto jagung.jpg',
  hasPhoto: true,
};

describe('AlertCard', () => {
  beforeEach(() => {
    vi.useFakeTimers();
    vi.setSystemTime(new Date('2024-01-02T02:00:00Z'));
  });

  afterEach(() => {
    vi.useRealTimers();
    cleanup();
  });

  it('shows severity, metadata, and normalized photo preview', () => {
    render(<AlertCard alert={baseAlert} onViewDetails={() => {}} />);

    expect(screen.getByText('Tinggi')).toBeInTheDocument();
    expect(screen.getByText(/400m/)).toBeInTheDocument();
    expect(screen.getByText(/2 jam lalu/)).toBeInTheDocument();
    expect(screen.getByText('Jagung, Padi')).toBeInTheDocument();

    const img = screen.getByRole('img', { name: /foto laporan/i });
    expect(img).toHaveAttribute('src', '/api/photos/folder%2Ffoto%20jagung.jpg');
  });

  it('falls back to helper text when alert hasPhoto but no usable URL', () => {
    const alertWithoutPhoto = { ...baseAlert, photoKey: null, photoUrl: null };
    render(<AlertCard alert={alertWithoutPhoto} onViewDetails={() => {}} />);

    expect(screen.queryByRole('img', { name: /foto laporan/i })).not.toBeInTheDocument();
    expect(screen.getByText(/ada foto/i)).toBeInTheDocument();
  });

  it('invokes onViewDetails with the alert payload when clicked', () => {
    const handleView = vi.fn();
    render(<AlertCard alert={baseAlert} onViewDetails={handleView} />);

    fireEvent.click(screen.getByText(/lihat detail/i));

    expect(handleView).toHaveBeenCalledTimes(1);
    expect(handleView).toHaveBeenCalledWith(baseAlert);
  });
});



--- File: ./src/pages/community-alerts/components/__tests__/AlertDetailModal.test.jsx ---

import { render, screen, fireEvent, cleanup } from '@testing-library/react';
import { describe, it, expect, afterEach, vi } from 'vitest';
import AlertDetailModal from '../AlertDetailModal';

const baseAlert = {
  pestType: 'Wereng Cokelat',
  severity: 'medium',
  affectedCrops: ['Padi', 'Jagung'],
  coordinates: { lat: -10.159, lng: 123.601 },
  photoUrl: 'https://cdn.example.com/wereng foto 1.jpeg',
  timestamp: '2024-03-10T01:30:00Z',
  location: 'Kab. Kupang',
  distance: 2.5,
  description: 'Serangan terlihat pada daun bagian bawah.',
  affectedArea: '2 Ha',
  pestCount: 120,
};

describe('AlertDetailModal', () => {
  afterEach(() => {
    cleanup();
  });

  it('does not render anything when isOpen is false', () => {
    const { container } = render(
      <AlertDetailModal isOpen={false} onClose={() => {}} alert={baseAlert} />
    );
    expect(container).toBeEmptyDOMElement();
  });

  it('shows detail information, normalized photo, and map embed when open', () => {
    render(<AlertDetailModal isOpen alert={baseAlert} onClose={() => {}} />);

    expect(screen.getByText(/tingkat bahaya: sedang/i)).toBeInTheDocument();
    expect(screen.getByText(/Kab\. Kupang/i)).toBeInTheDocument();
    expect(screen.getByText(/Serangan terlihat/i)).toBeInTheDocument();

    const img = screen.getByRole('img', { name: /foto laporan/i });
    expect(img).toHaveAttribute('src', 'https://cdn.example.com/wereng%20foto%201.jpeg');

    const iframe = screen.getByTitle(/lokasi peringatan/i);
    expect(iframe.getAttribute('src')).toContain('bbox=');
    expect(iframe.getAttribute('src')).toContain('marker=-10.159,123.601');
  });

  it('switches to discussion tab when corresponding button is pressed', () => {
    render(<AlertDetailModal isOpen alert={baseAlert} onClose={() => {}} />);

    fireEvent.click(screen.getByRole('button', { name: /diskusi komunitas/i }));

    expect(screen.getByText(/Fitur diskusi akan ditambahkan/i)).toBeInTheDocument();
  });

  it('invokes onClose when the footer button is pressed', () => {
    const handleClose = vi.fn();
    render(<AlertDetailModal isOpen alert={baseAlert} onClose={handleClose} />);

    fireEvent.click(screen.getByRole('button', { name: /tutup/i }));

    expect(handleClose).toHaveBeenCalledTimes(1);
  });
});



--- File: ./src/pages/community-alerts/index.jsx ---

// src/pages/community-alerts/index.jsx
import React, { useState, useEffect, useMemo } from 'react';
import { useNavigate } from 'react-router-dom';
import { useGetAlertsQuery } from '../../services/alertsApi';
import { getQueuedRequests, requestSyncNow } from '../../offline/queueService';
import Icon from '../../components/AppIcon';
import Button from '../../components/ui/Button';
import LoadingOverlay from '../../components/ui/LoadingOverlay';
import OfflineStatusBanner from '../../components/ui/OfflineStatusBanner';
import BottomNavigation from '../../components/ui/BottomNavigation';
import DesktopTopNav from '../../components/layout/DesktopTopNav';
import AlertCard from './components/AlertCard';
import AlertFilters from './components/AlertFilters';
import ReportPestModal from './components/ReportPestModal';
import AlertDetailModal from './components/AlertDetailModal';
import CommunityMap from './components/CommunityMap';

// util jarak (km)
function haversineKm(a, b) {
  const R = 6371;
  const dLat = (b.lat - a.lat) * Math.PI / 180;
  const dLng = (b.lng - a.lng) * Math.PI / 180;
  const la1 = a.lat * Math.PI / 180;
  const la2 = b.lat * Math.PI / 180;
  const x = Math.sin(dLat/2)**2 + Math.cos(la1)*Math.cos(la2)*Math.sin(dLng/2)**2;
  return 2 * R * Math.asin(Math.sqrt(x));
}

export default function CommunityAlerts() {
  const navigate = useNavigate();

  const [filters, setFilters] = useState({ pestType: 'all', severity: 'all', distance: 'all', timeWindow: '24' });
  const [search, setSearch] = useState('');
  const [isReportModalOpen, setIsReportModalOpen] = useState(false);
  const [selectedAlert, setSelectedAlert] = useState(null);
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [pendingSyncCount, setPendingSyncCount] = useState(0);
  const [userPos, setUserPos] = useState(null);

  const { data: allAlertsRaw = [], isLoading, isError, error, refetch } =
    useGetAlertsQuery(undefined, { skip: !isOnline });

  // Posisi user (sekali)
  useEffect(() => {
    if (!navigator.geolocation) return;
    navigator.geolocation.getCurrentPosition(
      (pos) => setUserPos({ lat: pos.coords.latitude, lng: pos.coords.longitude }),
      ()    => setUserPos(null),
      { enableHighAccuracy: true, maximumAge: 60000, timeout: 8000 }
    );
  }, []);

  // Normalisasi & jarak
  const allAlerts = useMemo(() => {
    return (allAlertsRaw || []).map((a) => {
      let coords = a.coordinates;
      if (coords && typeof coords === 'string') {
        try { coords = JSON.parse(coords); } catch { coords = null; }
      }
      const hasCoords = coords && typeof coords.lat === 'number' && typeof coords.lng === 'number';
      const hasUser   = userPos && typeof userPos.lat === 'number' && typeof userPos.lng === 'number';
      const distance  = hasCoords && hasUser ? haversineKm(userPos, coords) : null;

      const pestType = a.pestType || a.pest_type || 'Hama';
      const desc = a.description || '';
      return { ...a, pestType, coordinates: coords, distance, _desc: desc.toLowerCase() };
    });
  }, [allAlertsRaw, userPos]);

  // Filter + search
  const filteredAlerts = useMemo(() => {
    let list = allAlerts;
    const { pestType, severity, distance } = filters;

    if (pestType !== 'all') list = list.filter((a) => (a.pestType || '').toLowerCase() === pestType.toLowerCase());
    if (severity !== 'all') list = list.filter((a) => (a.severity || '').toLowerCase() === severity.toLowerCase());
    if (distance !== 'all') {
      const maxKm = parseFloat(distance);
      list = list.filter((a) => a.distance != null && a.distance <= maxKm);
    }
    if (search.trim()) {
      const q = search.trim().toLowerCase();
      list = list.filter((a) =>
        (a.pestType || '').toLowerCase().includes(q) || (a.description || '').toLowerCase().includes(q)
      );
    }
    return list;
  }, [allAlerts, filters, search]);

  // Nearby (â‰¤3 km) untuk sidebar
  const nearby3km = useMemo(() => {
    return allAlerts
      .filter((a) => a.distance != null && a.distance <= 3)
      .sort((a, b) => (a.distance ?? 0) - (b.distance ?? 0))
      .slice(0, 5);
  }, [allAlerts]);

  // Online/offline
  useEffect(() => {
    const handleOnline = () => setIsOnline(true);
    const handleOffline = () => setIsOnline(false);
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);
  useEffect(() => { if (isOnline) refetch(); }, [isOnline, refetch]);

  // Cek antrean offline
  useEffect(() => {
    const checkQueue = async () => {
      const requests = await getQueuedRequests();
      setPendingSyncCount(requests.length);
    };
    checkQueue();
    const interval = setInterval(checkQueue, 5000);
    return () => clearInterval(interval);
  }, [isOnline]);

  const handleFilterChange = (type, value) => setFilters((p) => ({ ...p, [type]: value }));
  const handleClearFilters  = () => setFilters({ pestType: 'all', severity: 'all', distance: 'all', timeWindow: '24' });

  if (isLoading) return <LoadingOverlay isVisible={true} message="Memuat peringatan komunitas..." animationType="sync" />;

  if (isError && !isOnline) {
    // offline + error â†’ lanjut (cached/empty)
  } else if (isError) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen text-center p-4">
        <Icon name="WifiOff" size={48} className="text-destructive mb-4" />
        <h2 className="text-xl font-bold text-foreground mb-2">Gagal Memuat Data</h2>
        <p className="text-muted-foreground mb-4">Terjadi kesalahan saat mengambil data peringatan.</p>
        <p className="text-xs text-muted-foreground bg-muted p-2 rounded-md">
          Detail Error: {error?.status} {JSON.stringify(error?.data)}
        </p>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      {/* NAV DESKTOP */}
      <div className="hidden md:block">
        <DesktopTopNav />
      </div>

      <div className="mx-auto w-full max-w-screen-xl px-4 md:px-6 lg:px-8 bg-background min-h-screen">
        <OfflineStatusBanner
          isOnline={isOnline}
          pendingSyncCount={pendingSyncCount}
          onRetrySync={() => requestSyncNow()}
        />

        {/* Header halaman */}
        <div className="bg-card border-b border-border sticky top-0 z-30">
          <div className="px-0 md:px-2 lg:px-4 py-4 md:py-6">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <button
                  onClick={() => navigate('/home-dashboard')}
                  className="p-2 rounded-xl hover:bg-muted transition-smooth"
                  aria-label="Kembali ke beranda"
                >
                  <Icon name="ArrowLeft" size={24} className="text-foreground" />
                </button>
                <div>
                  <h1 className="text-2xl font-bold text-foreground">Komunitas</h1>
                  <p className="text-sm text-muted-foreground">Pantau hama di sekitar Anda</p>
                </div>
              </div>

              <Button
                variant="default"
                iconName="Plus"
                iconPosition="left"
                onClick={() => setIsReportModalOpen(true)}
                className="shrink-0 rounded-xl"
              >
                Laporkan
              </Button>
            </div>
          </div>
        </div>

        {/* Desktop: 2 kolom (8/4). Mobile: stack */}
        <div className="py-6 md:py-8">
          <div className="grid grid-cols-1 md:grid-cols-12 gap-6">
            {/* Sidebar kanan */}
            <aside className="order-2 md:order-2 md:col-span-4">
              <div className="sticky md:top-20 space-y-6">
                {/* Ringkasan */}
                <div className="bg-card border border-border rounded-xl p-5 shadow-sm">
                  <div className="flex items-center justify-between">
                    <div className="text-sm text-muted-foreground">Total Peringatan</div>
                    <div className="text-xs text-muted-foreground">{nearby3km.length} dalam 3 km</div>
                  </div>
                  <div className="mt-2 text-3xl font-extrabold">{filteredAlerts.length}</div>
                  <div className="mt-3 grid grid-cols-3 gap-2 text-center">
                    <div className="bg-success/10 text-success rounded-lg py-2 text-xs">
                      Rendah<br/>{filteredAlerts.filter(a => (a.severity||'').toLowerCase()==='rendah' || (a.severity||'').toLowerCase()==='baik').length}
                    </div>
                    <div className="bg-warning/10 text-warning rounded-lg py-2 text-xs">
                      Sedang<br/>{filteredAlerts.filter(a => (a.severity||'').toLowerCase()==='sedang').length}
                    </div>
                    <div className="bg-error/10 text-error rounded-lg py-2 text-xs">
                      Tinggi<br/>{filteredAlerts.filter(a => (a.severity||'').toLowerCase()==='tinggi').length}
                    </div>
                  </div>
                </div>

                {/* Nearby â‰¤3km */}
                <div className="bg-card border border-border rounded-xl p-5 shadow-sm">
                  <div className="flex items-center gap-2 mb-3">
                    <Icon name="MapPin" size={18} className="text-primary" />
                    <h3 className="text-sm font-semibold">Peringatan â‰¤ 3 km</h3>
                  </div>
                  {nearby3km.length === 0 ? (
                    <div className="text-xs text-muted-foreground">Belum ada laporan dekat lokasi Anda.</div>
                  ) : (
                    <ul className="space-y-3 text-sm">
                      {nearby3km.map((a) => (
                        <li key={a.id} className="border border-border rounded-lg p-3">
                          <div className="flex items-center justify-between">
                            <div className="font-medium">{a.pest_type || a.pestType || 'Hama'}</div>
                            <div className={`text-[10px] px-2 py-0.5 rounded-md border ${
                              (a.severity||'').toLowerCase()==='tinggi' ? 'bg-error/10 text-error border-error/30'
                              : (a.severity||'').toLowerCase()==='sedang' ? 'bg-warning/10 text-warning border-warning/30'
                              : 'bg-success/10 text-success border-success/30'
                            }`}>
                              {a.severity || '-'}
                            </div>
                          </div>
                          <div className="text-xs text-muted-foreground mt-1">
                            {(a.distance ?? 0).toFixed(2)} km â€¢ {new Date(a.timestamp).toLocaleDateString('id-ID', { day: '2-digit', month: 'short' })}
                          </div>
                        </li>
                      ))}
                    </ul>
                  )}
                </div>

                {/* Filter (desktop) */}
                <div className="hidden md:block bg-card border border-border rounded-xl p-4 shadow-sm">
                  <AlertFilters
                    filters={filters}
                    onFilterChange={handleFilterChange}
                    alertCount={filteredAlerts.length}
                    onClearFilters={handleClearFilters}
                  />
                </div>
              </div>
            </aside>

            {/* Konten utama */}
            <section className="order-1 md:order-1 md:col-span-8">
              {/* Map on top of list */}
              <div className="bg-card border border-border rounded-xl p-3 mb-4">
                <div className="flex items-center justify-between mb-2 px-1">
                  <h3 className="text-base font-semibold text-foreground">Peta Laporan Komunitas</h3>
                  <div className="text-xs text-muted-foreground flex items-center gap-1">
                    <Icon name="Map" size={14} />
                    <span>Overlay sederhana</span>
                  </div>
                </div>
                <CommunityMap alerts={filteredAlerts} userPos={userPos} />
              </div>
              {/* Search + chips */}
              <div className="bg-card border border-border rounded-xl p-4 mb-4">
                <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                  <div className="flex-1">
                    <div className="relative">
                      <Icon name="Search" size={18} className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground" />
                      <input
                        value={search}
                        onChange={(e) => setSearch(e.target.value)}
                        placeholder="Cari hama / deskripsi..."
                        className="w-full pl-9 pr-3 py-2 rounded-lg border border-border bg-background focus:outline-none focus:ring-2 focus:ring-primary/40"
                      />
                    </div>
                  </div>
                  <div className="flex items-center gap-2">
                    {["3","5","10"].map(r => (
                      <button key={r}
                        onClick={() => setFilters((f) => ({ ...f, distance: r }))}
                        className={`px-3 py-1.5 rounded-lg text-xs border ${filters.distance===r ? 'bg-primary/10 text-primary border-primary/30' : 'bg-muted text-muted-foreground border-border'}`}
                      >â‰¤{r} km</button>
                    ))}
                    <button onClick={handleClearFilters}
                      className="px-3 py-1.5 rounded-lg text-xs border bg-muted text-muted-foreground border-border">
                      Reset
                    </button>
                  </div>
                </div>

                {/* Filter mobile */}
                <div className="mt-3 md:hidden">
                  <AlertFilters
                    filters={filters}
                    onFilterChange={handleFilterChange}
                    alertCount={filteredAlerts.length}
                    onClearFilters={handleClearFilters}
                  />
                </div>
              </div>

              {/* List card */}
              <div className="space-y-4">
                <div className="flex items-center justify-between px-1">
                  <h3 className="text-xl font-bold text-foreground">Peringatan Terbaru</h3>
                  {filteredAlerts.length > 0 && (
                    <div className="text-sm text-muted-foreground">Diurutkan berdasarkan jarak</div>
                  )}
                </div>

                {filteredAlerts.length === 0 ? (
                  <div className="text-center py-16">
                    <div className="w-20 h-20 bg-muted rounded-xl flex items-center justify-center mx-auto mb-4">
                      <Icon name="Search" size={40} className="text-muted-foreground" />
                    </div>
                    <h3 className="text-xl font-bold text-foreground mb-2">Tidak ada peringatan</h3>
                    <p className="text-muted-foreground mb-6">Coba ubah filter atau laporkan hama baru</p>
                    <Button variant="outline" iconName="Plus" iconPosition="left"
                      onClick={() => setIsReportModalOpen(true)} className="rounded-xl">
                      Buat Laporan Baru
                    </Button>
                  </div>
                ) : (
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {filteredAlerts.map((alert) => (
                      <AlertCard key={alert.id} alert={alert} onViewDetails={setSelectedAlert} />
                    ))}
                  </div>
                )}
              </div>
            </section>
          </div>
        </div>

        {/* Modals */}
        <ReportPestModal isOpen={isReportModalOpen} onClose={() => setIsReportModalOpen(false)} />
        <AlertDetailModal alert={selectedAlert} isOpen={!!selectedAlert} onClose={() => setSelectedAlert(null)} />

        {/* NAV MOBILE */}
        <div className="md:hidden">
          <BottomNavigation />
        </div>
      </div>
    </div>
  );
}



--- File: ./src/pages/diagnosis-history/components/HistoryCard.jsx ---

import React from 'react';
import Icon from '../../../components/AppIcon';

const HistoryCard = ({ historyItem, onViewDetails }) => {
  const getSeverityColor = (severity) => {
    switch (severity?.toLowerCase()) {
      case 'sedang': return 'text-warning';
      case 'berat': return 'text-error';
      default: return 'text-success';
    }
  };

  const formatDate = (timestamp) => {
    return new Date(timestamp).toLocaleDateString('id-ID', {
      day: 'numeric', month: 'long', year: 'numeric'
    });
  };

  return (
    <div 
      className="bg-card border border-border rounded-lg p-4 cursor-pointer hover:bg-muted/50 transition-smooth"
      onClick={() => onViewDetails(historyItem)}
    >
      <div className="flex items-center space-x-4">
        <div className="w-16 h-16 bg-muted rounded-lg flex-shrink-0 overflow-hidden">
          {historyItem?.photo_url ? (
            <img src={historyItem.photo_url} alt="Foto diagnosis" className="w-full h-full object-cover" loading="lazy" />
          ) : (
            <Icon name="Leaf" size={32} className="text-muted-foreground m-auto" />
          )}
        </div>
        <div className="flex-1 min-w-0">
          <div className="flex items-center justify-between">
            <p className={`text-sm font-medium ${getSeverityColor(historyItem.result_severity)}`}>
              {historyItem.result_severity?.toUpperCase()}
            </p>
            <p className="text-xs text-muted-foreground">{formatDate(historyItem.timestamp)}</p>
          </div>
          <h3 className="text-base font-semibold text-foreground truncate mt-1">
            {historyItem.result_label}
          </h3>
          <p className="text-sm text-muted-foreground truncate">
            Tanaman: {historyItem.crop_type} â€¢ Lahan: {historyItem.field_id}
          </p>
        </div>
        <Icon name="ChevronRight" size={20} className="text-muted-foreground" />
      </div>
    </div>
  );
};

export default HistoryCard;



--- File: ./src/pages/diagnosis-history/index.jsx ---

import React from 'react';
import { useNavigate } from 'react-router-dom';
import { useGetDiagnosisHistoryQuery } from '../../services/diagnosisApi';
import BottomNavigation from '../../components/ui/BottomNavigation';
import LoadingOverlay from '../../components/ui/LoadingOverlay';
import Icon from '../../components/AppIcon';
import Button from '../../components/ui/Button';
import HistoryCard from './components/HistoryCard';
import DesktopTopNav from '../../components/layout/DesktopTopNav';

const DiagnosisHistory = () => {
  const navigate = useNavigate();
  const { data: history = [], isLoading, isError } = useGetDiagnosisHistoryQuery();

  const handleViewDetails = (historyItem) => {
    const diagnosisDataForNextPage = {
      id: historyItem.id,
      timestamp: historyItem.timestamp,
      image: {
        url: historyItem.photo_url || null,
        cropType: historyItem.crop_type,
        location: {
          lat: historyItem.latitude,
          lng: historyItem.longitude,
          address: historyItem.field_id,
        },
      },
      diagnosis: {
        label: historyItem.result_label,
        description: historyItem.result_description,
        confidence: historyItem.result_confidence,
        severity: historyItem.result_severity,
        affectedAreas: [],
      },
      recommendations: [
        {
          id: 'rec_hist_1',
          title: `Tindakan untuk ${historyItem.result_label}`,
          description: 'Lakukan penanganan sesuai anjuran ahli pertanian.',
          priority: 'sedang',
          timing: 'Segera',
          steps: ['Amati gejala secara berkala.', 'Konsultasikan dengan ahli jika gejala memburuk.'],
          costEstimate: 'Rendah',
        },
        {
          id: 'rec_hist_2',
          title: 'Pencegahan di Masa Depan',
          description:
            'Jaga kebersihan lahan dan lakukan rotasi tanaman untuk musim tanam berikutnya.',
          priority: 'rendah',
          timing: 'Musim Tanam Berikutnya',
          steps: ['Bersihkan gulma dan sisa tanaman.', 'Pilih varietas yang lebih tahan penyakit.'],
          costEstimate: 'Rendah',
        },
      ],
      environmentalFactors: [],
    };

    navigate('/diagnosis-results', { state: { diagnosisData: diagnosisDataForNextPage } });
  };

  const renderContent = () => {
    if (isLoading) return <LoadingOverlay isVisible={true} message="Memuat riwayat..." />;

    if (isError) {
      return (
        <div className="text-center py-16">
          <Icon name="WifiOff" size={40} className="text-destructive mx-auto mb-4" />
          <h3 className="text-xl font-bold text-foreground mb-2">Gagal Memuat Riwayat</h3>
          <p className="text-muted-foreground">
            Terjadi kesalahan saat mengambil data. Periksa koneksi Anda.
          </p>
        </div>
      );
    }

    if (history.length === 0) {
      return (
        <div className="text-center py-16">
          <Icon name="History" size={40} className="text-muted-foreground mx-auto mb-4" />
          <h3 className="text-xl font-bold text-foreground mb-2">Belum Ada Riwayat</h3>
          <p className="text-muted-foreground mb-6">
            Lakukan diagnosis pertama Anda untuk melihat riwayat di sini.
          </p>
          <Button
            variant="default"
            iconName="Camera"
            iconPosition="left"
            onClick={() => navigate('/photo-diagnosis')}
          >
            Mulai Diagnosis
          </Button>
        </div>
      );
    }

    return (
      <div className="space-y-4">
        {history.map((item) => (
          <HistoryCard key={item.id} historyItem={item} onViewDetails={handleViewDetails} />
        ))}
      </div>
    );
  };

  return (
    <div className="min-h-screen bg-background">
      {/* NAV DESKTOP (tanpa back) */}
      <div className="hidden md:block">
        <DesktopTopNav />
      </div>

      <div className="mx-auto w-full max-w-screen-xl px-4 md:px-6 lg:px-8">
        {/* HEADER DALAM CONTAINER */}
        <div className="bg-card border-b border-border sticky top-0 z-30">
          <div className="px-0 md:px-2 lg:px-4 py-4 md:py-6">
            <div className="flex items-center gap-3">
              <button
                onClick={() => navigate('/home-dashboard')}
                className="p-2 rounded-xl hover:bg-muted transition-smooth"
                aria-label="Kembali ke beranda"
              >
                <Icon name="ArrowLeft" size={24} className="text-foreground" />
              </button>
              <div>
                <h1 className="text-2xl font-bold text-foreground">Riwayat Diagnosis</h1>
                <p className="text-sm text-muted-foreground">Semua hasil analisis AI Anda</p>
              </div>
            </div>
          </div>
        </div>

        <div className="py-6 pb-24">{renderContent()}</div>

        {/* NAV MOBILE */}
        <div className="md:hidden">
          <BottomNavigation />
        </div>
      </div>
    </div>
  );
};

export default DiagnosisHistory;



--- File: ./src/pages/diagnosis-results/components/ActionButtons.jsx ---

import React from 'react';
import { useNavigate } from 'react-router-dom';
import Button from '../../../components/ui/Button';

const ActionButtons = ({ onShare, onSaveAllPlans, hasRecommendations }) => {
  const navigate = useNavigate();

  return (
    <div className="bg-card border-t border-border p-4 space-y-3">
      {/* Primary Actions */}
      <div className="flex flex-col gap-3">
        <Button
          variant="outline"
          fullWidth
          iconName="Share"
          iconPosition="left"
          onClick={onShare}
        >
          Bagikan Hasil
        </Button>
        
        {hasRecommendations && (
          <Button
            variant="default"
            fullWidth
            iconName="Save"
            iconPosition="left"
            onClick={onSaveAllPlans}
          >
            Simpan Semua
          </Button>
        )}
      </div>
      
      {/* Navigation Actions */}
      <div className="grid grid-cols-2 gap-3">
        <Button
          variant="secondary"
          fullWidth
          iconName="Camera"
          iconPosition="left"
          onClick={() => navigate('/photo-diagnosis')}
        >
          Diagnosis Lagi
        </Button>
        
        <Button
          variant="secondary"
          fullWidth
          iconName="Calendar"
          iconPosition="left"
          onClick={() => navigate('/farming-calendar')}
        >
          Lihat Kalender
        </Button>
      </div>
      
      {/* Community Action */}
      <Button
        variant="ghost"
        fullWidth
        iconName="Users"
        iconPosition="left"
        onClick={() => navigate('/community-alerts')}
        className="text-muted-foreground"
      >
        Cek Peringatan Komunitas
      </Button>
    </div>
  );
};

export default ActionButtons;


--- File: ./src/pages/diagnosis-results/components/CropImageDisplay.jsx ---

import React from 'react';
import Image from '../../../components/AppImage';
import Icon from '../../../components/AppIcon';

const CropImageDisplay = ({ imageUrl, cropType, timestamp, location }) => {
  return (
    <div className="bg-card rounded-lg border border-border overflow-hidden shadow-agricultural">
      <div className="relative">
        <Image
          src={imageUrl}
          alt="Foto tanaman yang dianalisis"
          className="w-full h-64 object-cover"
        />
        <div className="absolute top-3 right-3 bg-black/60 backdrop-blur-sm rounded-lg px-2 py-1">
          <span className="text-white text-xs font-medium">
            {cropType}
          </span>
        </div>
      </div>
      <div className="p-4 bg-muted/30">
        <div className="flex items-center justify-between text-sm text-muted-foreground">
          <div className="flex items-center space-x-2">
            <Icon name="Calendar" size={16} />
            <span>{new Date(timestamp)?.toLocaleDateString('id-ID', {
              day: 'numeric',
              month: 'long',
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            })}</span>
          </div>
          
          {location && (
            <div className="flex items-center space-x-2">
              <Icon name="MapPin" size={16} />
              <span className="truncate max-w-32">
                {location?.address || `${location?.lat?.toFixed(4)}, ${location?.lng?.toFixed(4)}`}
              </span>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default CropImageDisplay;


--- File: ./src/pages/diagnosis-results/components/DiagnosisCard.jsx ---

import React from 'react';
import Icon from '../../../components/AppIcon';

const DiagnosisCard = ({ diagnosis }) => {
  const getSeverityColor = (severity) => {
    switch (severity?.toLowerCase()) {
      case 'ringan':
        return 'text-success bg-success/10 border-success/20';
      case 'sedang':
        return 'text-warning bg-warning/10 border-warning/20';
      case 'berat':
        return 'text-error bg-error/10 border-error/20';
      default:
        return 'text-muted-foreground bg-muted/10 border-border';
    }
  };

  const getConfidenceColor = (confidence) => {
    if (confidence >= 80) return 'text-success';
    if (confidence >= 60) return 'text-warning';
    return 'text-error';
  };

  return (
    <div className="bg-card rounded-lg border border-border p-6 shadow-agricultural">
      <div className="flex items-start justify-between mb-4">
        <div className="flex-1">
          <h3 className="text-lg font-semibold text-foreground mb-2">
            {diagnosis?.label}
          </h3>
          <p className="text-sm text-muted-foreground leading-relaxed">
            {diagnosis?.description}
          </p>
        </div>
        
        <div className="ml-4 text-right">
          <div className={`text-2xl font-bold ${getConfidenceColor(diagnosis?.confidence)}`}>
            {diagnosis?.confidence}%
          </div>
          <p className="text-xs text-muted-foreground">Akurasi</p>
        </div>
      </div>
      <div className="flex items-center justify-between">
        <div className={`
          inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border
          ${getSeverityColor(diagnosis?.severity)}
        `}>
          <Icon 
            name={diagnosis?.severity === 'berat' ? 'AlertTriangle' : 
                  diagnosis?.severity === 'sedang' ? 'AlertCircle' : 'CheckCircle'} 
            size={16} 
            className="mr-2" 
          />
          Tingkat: {diagnosis?.severity}
        </div>
        
        <div className="flex items-center text-sm text-muted-foreground">
          <Icon name="Zap" size={16} className="mr-1" />
          AI Analysis
        </div>
      </div>
      {diagnosis?.affectedAreas && (
        <div className="mt-4 pt-4 border-t border-border">
          <h4 className="text-sm font-medium text-foreground mb-2">
            Area Terpengaruh
          </h4>
          <div className="flex flex-wrap gap-2">
            {diagnosis?.affectedAreas?.map((area, index) => (
              <span 
                key={index}
                className="inline-flex items-center px-2 py-1 bg-muted rounded-md text-xs text-muted-foreground"
              >
                {area}
              </span>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};

export default DiagnosisCard;


--- File: ./src/pages/diagnosis-results/components/DiagnosisHeader.jsx ---

import React from 'react';
import { useNavigate } from 'react-router-dom';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';

const DiagnosisHeader = ({ onShare }) => {
  const navigate = useNavigate();

  return (
     <div className="bg-card border-b border-border sticky top-0 z-50 shadow-md">
      <div className="flex items-center justify-between p-4">
        <div className="flex items-center space-x-3">
          <Button
            variant="ghost"
            size="icon"
            onClick={() => navigate(-1)}
            className="rounded-full"
          >
            <Icon name="ArrowLeft" size={20} />
          </Button>
          <div>
            <h1 className="text-2xl font-bold text-foreground">
              Hasil Diagnosis
            </h1>
            <p className="text-sm text-muted-foreground">
              Analisis AI Tanaman
            </p>
          </div>
        </div>
        
        <Button
          variant="outline"
          size="sm"
          iconName="Share"
          iconPosition="left"
          onClick={onShare}
          className="rounded-full"
        >
          Bagikan
        </Button>
      </div>
    </div>
  );
};

export default DiagnosisHeader;


--- File: ./src/pages/diagnosis-results/components/EnvironmentalFactors.jsx ---

import React from 'react';
import Icon from '../../../components/AppIcon';

const EnvironmentalFactors = ({ factors }) => {
  const getFactorIcon = (type) => {
    switch (type) {
      case 'temperature': return 'Thermometer';
      case 'humidity': return 'Droplets';
      case 'rainfall': return 'CloudRain';
      case 'soil_moisture': return 'Sprout';
      case 'sunlight': return 'Sun';
      default: return 'Info';
    }
  };

  const getFactorLabel = (type) => {
    switch (type) {
      case 'temperature': return 'Suhu';
      case 'humidity': return 'Kelembaban';
      case 'rainfall': return 'Curah Hujan';
      case 'soil_moisture': return 'Kelembaban Tanah';
      case 'sunlight': return 'Sinar Matahari';
      default: return type;
    }
  };

  const getFactorColor = (impact) => {
    switch (impact?.toLowerCase()) {
      case 'positive': return 'text-success bg-success/10';
      case 'negative': return 'text-error bg-error/10';
      case 'neutral': return 'text-muted-foreground bg-muted/10';
      default: return 'text-muted-foreground bg-muted/10';
    }
  };

  return (
    <div className="bg-card rounded-lg border border-border p-6 shadow-agricultural">
      <div className="flex items-center mb-4">
        <Icon name="CloudSun" size={20} className="text-primary mr-2" />
        <h3 className="text-lg font-semibold text-foreground">
          Faktor Lingkungan
        </h3>
      </div>
      <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
        {factors?.map((factor, index) => (
          <div 
            key={index}
            className={`
              p-4 rounded-lg border transition-smooth
              ${getFactorColor(factor?.impact)}
            `}
          >
            <div className="flex items-center justify-between mb-2">
              <div className="flex items-center space-x-2">
                <Icon name={getFactorIcon(factor?.type)} size={18} />
                <span className="font-medium text-sm">
                  {getFactorLabel(factor?.type)}
                </span>
              </div>
              <span className="text-lg font-semibold">
                {factor?.value}
              </span>
            </div>
            
            <p className="text-xs opacity-80 leading-relaxed">
              {factor?.description}
            </p>
            
            {factor?.recommendation && (
              <div className="mt-2 pt-2 border-t border-current/20">
                <p className="text-xs font-medium">
                  ğŸ’¡ {factor?.recommendation}
                </p>
              </div>
            )}
          </div>
        ))}
      </div>
      <div className="mt-4 p-3 bg-muted/50 rounded-lg">
        <div className="flex items-start space-x-2">
          <Icon name="Info" size={16} className="text-primary mt-0.5" />
          <p className="text-xs text-muted-foreground leading-relaxed">
            Data lingkungan membantu AI memahami kondisi yang mempengaruhi kesehatan tanaman Anda.
          </p>
        </div>
      </div>
    </div>
  );
};

export default EnvironmentalFactors;


--- File: ./src/pages/diagnosis-results/components/OfflineIndicator.jsx ---

import React from 'react';
import Icon from '../../../components/AppIcon';

const OfflineIndicator = ({ isOnline, hasPendingSync, lastSyncTime }) => {
  if (isOnline && !hasPendingSync) return null;

  return (
    <div className="bg-warning/10 border border-warning/20 rounded-lg p-4 mb-6">
      <div className="flex items-start space-x-3">
        <Icon 
          name={isOnline ? "CloudOff" : "WifiOff"} 
          size={20} 
          className="text-warning mt-0.5" 
        />
        <div className="flex-1">
          <h4 className="text-sm font-medium text-warning mb-1">
            {isOnline ? 'Menunggu Sinkronisasi' : 'Mode Offline'}
          </h4>
          <p className="text-xs text-warning/80 leading-relaxed">
            {isOnline 
              ? 'Hasil diagnosis telah disimpan secara lokal dan akan disinkronkan saat koneksi stabil.' :'Hasil diagnosis disimpan secara lokal. Data akan disinkronkan saat terhubung ke internet.'
            }
          </p>
          
          {lastSyncTime && (
            <p className="text-xs text-warning/60 mt-2">
              Sinkronisasi terakhir: {new Date(lastSyncTime)?.toLocaleString('id-ID')}
            </p>
          )}
        </div>
        
        <div className="flex items-center space-x-1">
          <div className={`
            w-2 h-2 rounded-full
            ${isOnline ? 'bg-success animate-pulse' : 'bg-warning'}
          `}></div>
          <span className="text-xs text-warning">
            {isOnline ? 'Online' : 'Offline'}
          </span>
        </div>
      </div>
    </div>
  );
};

export default OfflineIndicator;


--- File: ./src/pages/diagnosis-results/components/RecommendationCard.jsx ---

import React from 'react';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';

const RecommendationCard = ({ recommendation, onSavePlan }) => {
  const getPriorityColor = (priority) => {
    switch (priority?.toLowerCase()) {
      case 'tinggi':
        return 'text-error bg-error/10 border-error/20';
      case 'sedang':
        return 'text-warning bg-warning/10 border-warning/20';
      case 'rendah':
        return 'text-success bg-success/10 border-success/20';
      default:
        return 'text-muted-foreground bg-muted/10 border-border';
    }
  };

  const getCostColor = (cost) => {
    switch (cost?.toLowerCase()) {
      case 'rendah':
        return 'text-success';
      case 'sedang':
        return 'text-warning';
      case 'tinggi':
        return 'text-error';
      default:
        return 'text-muted-foreground';
    }
  };

  return (
    <div className="bg-card rounded-lg border border-border p-6 shadow-agricultural">
      <div className="flex items-start justify-between mb-4">
        <div className="flex-1">
          <div className="flex items-center space-x-2 mb-2">
            <Icon name={recommendation?.icon || 'Lightbulb'} size={20} className="text-primary" />
            <h4 className="font-semibold text-foreground">
              {recommendation?.title}
            </h4>
          </div>
          
          <p className="text-sm text-muted-foreground leading-relaxed mb-3">
            {recommendation?.description}
          </p>
        </div>
        
        <div className={`
          inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ml-3
          ${getPriorityColor(recommendation?.priority)}
        `}>
          {recommendation?.priority}
        </div>
      </div>
      {/* Implementation Steps */}
      <div className="mb-4">
        <h5 className="text-sm font-medium text-foreground mb-2">
          Langkah Implementasi:
        </h5>
        <ol className="space-y-2">
          {recommendation?.steps?.map((step, index) => (
            <li key={index} className="flex items-start space-x-3">
              <span className="flex-shrink-0 w-6 h-6 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-xs font-medium">
                {index + 1}
              </span>
              <span className="text-sm text-muted-foreground leading-relaxed">
                {step}
              </span>
            </li>
          ))}
        </ol>
      </div>
      {/* Timing and Cost */}
      <div className="grid grid-cols-2 gap-4 mb-4">
        <div className="p-3 bg-muted/30 rounded-lg">
          <div className="flex items-center space-x-2 mb-1">
            <Icon name="Clock" size={16} className="text-muted-foreground" />
            <span className="text-xs font-medium text-muted-foreground">
              Waktu Terbaik
            </span>
          </div>
          <p className="text-sm font-medium text-foreground">
            {recommendation?.timing}
          </p>
        </div>
        
        <div className="p-3 bg-muted/30 rounded-lg">
          <div className="flex items-center space-x-2 mb-1">
            <Icon name="DollarSign" size={16} className="text-muted-foreground" />
            <span className="text-xs font-medium text-muted-foreground">
              Estimasi Biaya
            </span>
          </div>
          <p className={`text-sm font-medium ${getCostColor(recommendation?.cost)}`}>
            {recommendation?.costEstimate}
          </p>
        </div>
      </div>
      {/* Expected Outcome */}
      <div className="p-3 bg-success/5 border border-success/20 rounded-lg mb-4">
        <div className="flex items-start space-x-2">
          <Icon name="Target" size={16} className="text-success mt-0.5" />
          <div>
            <p className="text-xs font-medium text-success mb-1">
              Hasil yang Diharapkan:
            </p>
            <p className="text-sm text-success/80 leading-relaxed">
              {recommendation?.expectedOutcome}
            </p>
          </div>
        </div>
      </div>
      {/* Action Button */}
      <Button
        variant="outline"
        fullWidth
        iconName="BookmarkPlus"
        iconPosition="left"
        onClick={() => onSavePlan(recommendation)}
        className="border-primary text-primary hover:bg-primary hover:text-primary-foreground"
      >
        Simpan ke Rencana
      </Button>
    </div>
  );
};

export default RecommendationCard;


--- File: ./src/pages/diagnosis-results/index.jsx ---

// src/pages/diagnosis-results/index.jsx

import React, { useState, useEffect } from 'react';
import { useLocation, useNavigate } from 'react-router-dom';
import { enqueueRequest } from '../../offline/queueService';
import { useCreateFarmTaskMutation } from '../../services/farmTasksApi';
import DiagnosisHeader from './components/DiagnosisHeader';
import CropImageDisplay from './components/CropImageDisplay';
import DiagnosisCard from './components/DiagnosisCard';
import EnvironmentalFactors from './components/EnvironmentalFactors';
import RecommendationCard from './components/RecommendationCard';
import ActionButtons from './components/ActionButtons';
import OfflineIndicator from './components/OfflineIndicator';
import ShareActionSheet from '../../components/ui/ShareActionSheet';
import LoadingOverlay from '../../components/ui/LoadingOverlay';
import BottomNavigation from '../../components/ui/BottomNavigation';
import DesktopTopNav from '../../components/layout/DesktopTopNav';

const DiagnosisResults = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const [isShareOpen, setIsShareOpen] = useState(false);
  const [createEvent] = useCreateFarmTaskMutation();
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [isSaving, setIsSaving] = useState(false);

  const mockDiagnosisData = {
    image: { url: '', cropType: 'Unknown', location: { address: 'Lahan Utama' } },
    diagnosis: { label: 'Bercak Daun (dari Server D1)', confidence: 92.3, description: 'Disimpan permanen di D1.' },
    environmentalFactors: [],
    recommendations: [{ id: 'rec_d1_1', title: 'Rekomendasi Server 1', description: 'Deskripsi 1.', priority: 'tinggi', timing: '1 hari' }],
    timestamp: new Date().toISOString(),
  };

  const diagnosisData = location?.state?.diagnosisData || mockDiagnosisData;

  useEffect(() => {
    const handleOnline = () => setIsOnline(true);
    const handleOffline = () => setIsOnline(false);
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  const handleShare = () => setIsShareOpen(true);

  const handleSaveAllPlans = async () => {
    if (!diagnosisData?.recommendations?.length) {
      alert('Tidak ada rekomendasi untuk disimpan.');
      return;
    }

    const plansToSave = diagnosisData.recommendations.map((rec, idx) => ({
      id: `plan_${Date.now()}_${rec.id}_${idx}`,
      title: rec.title,
      type: 'semprot',
      crop: diagnosisData.image?.cropType || 'Unknown',
      location: diagnosisData.image?.location?.address || 'Lahan Utama',
      notes: [rec.description, `Prioritas: ${rec.priority}`],
      start_at: new Date().toISOString(),
      source_type: 'diagnosis',
      source_id: diagnosisData.id || null,
    }));

    setIsSaving(true);
    try {
      await Promise.all(plansToSave.map((p) => createEvent(p).unwrap()));
      alert('Rencana berhasil disimpan.');
      navigate('/farming-calendar');
    } catch (err) {
      console.error('Gagal online, simpan ke antrean:', err);
      for (const plan of plansToSave) await enqueueRequest({ type: 'createEvent', payload: plan });
      alert(`Anda sedang offline. ${plansToSave.length} rencana disimpan dan akan disinkronkan saat kembali online.`);
      navigate('/farming-calendar');
    } finally {
      setIsSaving(false);
    }
  };

  if (!diagnosisData) {
    navigate('/photo-diagnosis');
    return null;
  }

  return (
    <div className="min-h-screen bg-background">
      {/* NAV DESKTOP */}
      <div className="hidden md:block">
        <DesktopTopNav showBack title="Hasil Diagnosis" subtitle="Ringkasan analisis & rekomendasi" />
      </div>

      {/* HEADER bawaan halaman dibatasi container */}
      <div className="bg-card border-b border-border sticky top-0 z-40">
        <div className="mx-auto w-full max-w-screen-xl px-4 md:px-6 lg:px-8">
          <DiagnosisHeader onShare={handleShare} />
        </div>
      </div>

      {/* BODY dalam container */}
      <div className="mx-auto w-full max-w-screen-xl px-4 md:px-6 lg:px-8 pb-20">
        <div className="pt-4 space-y-6">
          <OfflineIndicator isOnline={isOnline} />

          <CropImageDisplay
            imageUrl={diagnosisData.image?.url}
            cropType={diagnosisData.image?.cropType}
            timestamp={diagnosisData.timestamp}
            location={diagnosisData.image?.location}
          />

          <DiagnosisCard diagnosis={diagnosisData.diagnosis} />

          <EnvironmentalFactors factors={diagnosisData.environmentalFactors} />

          <div className="space-y-4">
            <div className="flex items-center justify-between">
              <h3 className="text-lg font-semibold text-foreground">Rekomendasi Tindakan</h3>
              <span className="text-sm text-muted-foreground">{diagnosisData.recommendations?.length || 0} rekomendasi</span>
            </div>

            {diagnosisData.recommendations?.map((recommendation) => (
              <RecommendationCard key={recommendation.id} recommendation={recommendation} onSavePlan={() => {}} />
            ))}
          </div>
        </div>

        <ActionButtons onShare={handleShare} onSaveAllPlans={handleSaveAllPlans} hasRecommendations={diagnosisData.recommendations?.length > 0} />
      </div>

      <ShareActionSheet
        isOpen={isShareOpen}
        onClose={() => setIsShareOpen(false)}
        shareData={{
          title: `Diagnosis: ${diagnosisData.diagnosis?.label}`,
          description: diagnosisData.diagnosis?.description,
          results: [{ name: diagnosisData.diagnosis?.label, confidence: diagnosisData.diagnosis?.confidence }],
          timestamp: diagnosisData.timestamp,
        }}
      />

      <LoadingOverlay isVisible={isSaving} message="Menyimpan semua rencana..." animationType="plant" />

      {/* NAV MOBILE */}
      <div className="md:hidden">
        <BottomNavigation />
      </div>
    </div>
  );
};

export default DiagnosisResults;



--- File: ./src/pages/farming-calendar/components/AddEventModal.jsx ---

// src/pages/farming-calendar/components/AddEventModal.jsx
import React, { useState, useEffect } from 'react';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';
import Input from '../../../components/ui/Input';
import Select from '../../../components/ui/Select';
import { getWeatherAdvice } from '../../../services/weatherApi';

const AddEventModal = ({ isOpen, onClose, onAddEvent, selectedDate }) => {
  const [formData, setFormData] = useState({
    title: '',
    type: '',
    crop: '',
    date: '',
    time: '08:00',
    location: '',
    notes: '',
  });
  const [advice, setAdvice] = useState(null);
  const [adviceLoading, setAdviceLoading] = useState(false);
  const [coords, setCoords] = useState(null);

  // Inisialisasi tanggal default dari selectedDate setiap kali modal dibuka
  useEffect(() => {
    if (isOpen) {
      const defaultDate = selectedDate
        ? selectedDate.toISOString().split('T')[0]
        : new Date().toISOString().split('T')[0];
      setFormData((p) => ({ ...p, date: defaultDate }));
      // refresh advice on open
      setAdvice(null);
      // get user coords (best-effort)
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => setCoords({ lat: pos.coords.latitude, lon: pos.coords.longitude }),
          () => setCoords(null),
          { enableHighAccuracy: true, maximumAge: 60000, timeout: 6000 }
        );
      }
    }
  }, [isOpen, selectedDate]);

  useEffect(() => {
    const loadAdvice = async () => {
      if (!formData?.date || !coords) return;
      try {
        setAdviceLoading(true);
        const data = await getWeatherAdvice({ lat: coords.lat, lon: coords.lon, date: formData.date });
        setAdvice(data);
      } catch (e) {
        setAdvice(null);
      } finally {
        setAdviceLoading(false);
      }
    };
    loadAdvice();
  }, [formData?.date, coords]);

  const eventTypes = [
    { value: 'tanam', label: 'Penanaman' },
    { value: 'pupuk', label: 'Pemupukan' },
    { value: 'semprot', label: 'Penyemprotan' },
    { value: 'panen', label: 'Panen' },
  ];

  const cropOptions = [
    { value: 'jagung', label: 'Jagung' },
    { value: 'padi', label: 'Padi' },
    { value: 'kacang_tanah', label: 'Kacang Tanah' },
    { value: 'ubi_kayu', label: 'Ubi Kayu' },
    { value: 'kacang_hijau', label: 'Kacang Hijau' },
    { value: 'tomat', label: 'Tomat' },
    { value: 'cabai', label: 'Cabai' },
    { value: 'bawang_merah', label: 'Bawang Merah' },
  ];

  const handleInputChange = (field, value) => {
    setFormData((prev) => ({ ...prev, [field]: value }));
  };

  const handleSubmit = (e) => {
    e?.preventDefault();

    if (!formData?.title || !formData?.type || !formData?.crop || !formData?.date) {
      return;
    }

    const newEvent = {
      id: Date.now()?.toString(),
      date: formData.date, // â† tanggal dari input user (YYYY-MM-DD)
      title: formData?.title,
      type: formData?.type,
      crop: formData?.crop,
      time: formData?.time,
      location: formData?.location || 'Lahan Utama',
      completed: false,
      notes: formData?.notes ? [formData?.notes] : [],
      createdAt: new Date()?.toISOString(),
    };

    onAddEvent(newEvent);

    // Reset form
    setFormData({ title: '', type: '', crop: '', date: '', time: '08:00', location: '', notes: '' });
    onClose();
  };

  const formatDatePretty = (dateStr) => {
    try {
      const d = new Date(dateStr);
      return new Intl.DateTimeFormat('id-ID', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      }).format(d);
    } catch {
      return dateStr;
    }
  };

  if (!isOpen) return null;

  return (
    <>
      {/* Backdrop */}
      <div className="fixed inset-0 bg-black/50 z-300 transition-smooth" onClick={onClose} aria-hidden="true" />

      {/* Modal */}
      <div className="fixed inset-0 z-300 flex items-center justify-center p-4">
        <div className="bg-card rounded-lg border border-border w-full max-w-md max-h-[90vh] overflow-y-auto" role="dialog" aria-modal="true" aria-labelledby="add-event-title">
          <div className="p-6">
            {/* Header */}
            <div className="flex items-center justify-between mb-6">
              <h3 id="add-event-title" className="text-lg font-semibold text-foreground">
                Tambah Kegiatan Baru
              </h3>
              <button onClick={onClose} className="p-2 rounded-lg hover:bg-muted transition-smooth" aria-label="Tutup">
                <Icon name="X" size={20} />
              </button>
            </div>

            {/* Selected Date (pretty) */}
            <div className="bg-muted rounded-lg p-3 mb-6">
              <div className="flex items-center space-x-2 text-sm">
                <Icon name="Calendar" size={16} className="text-primary" />
                <span className="font-medium text-foreground">{formData.date ? formatDatePretty(formData.date) : 'Pilih tanggal'}</span>
              </div>
            </div>

            {/* Form */}
            <form onSubmit={handleSubmit} className="space-y-4">
              <Input
                label="Judul Kegiatan"
                type="text"
                placeholder="Contoh: Penanaman jagung varietas lokal"
                value={formData?.title}
                onChange={(e) => handleInputChange('title', e?.target?.value)}
                required
              />

              <div className="grid grid-cols-2 gap-4">
                <Input
                  label="Tanggal"
                  type="date"
                  value={formData?.date}
                  onChange={(e) => handleInputChange('date', e?.target?.value)}
                  required
                />
                <Input label="Waktu" type="time" value={formData?.time} onChange={(e) => handleInputChange('time', e?.target?.value)} />
              </div>

              {/* Weather advice tooltip */}
              <div className="mt-1 text-xs text-muted-foreground">
                <div className="inline-flex items-center gap-2 px-2 py-1 rounded border border-border bg-muted/50">
                  <Icon name="CloudSun" size={14} className="text-secondary" />
                  {adviceLoading && <span>Memuat saran cuaca...</span>}
                  {!adviceLoading && advice && (
                    <span>
                      Saran cuaca: {advice.summary}. {advice.advice}
                    </span>
                  )}
                  {!adviceLoading && !advice && (
                    <button type="button" className="underline" onClick={() => setCoords((c) => c ? { ...c } : c)}>
                      Muat saran cuaca
                    </button>
                  )}
                </div>
              </div>

              <Select
                label="Jenis Kegiatan"
                placeholder="Pilih jenis kegiatan"
                options={eventTypes}
                value={formData?.type}
                onChange={(value) => handleInputChange('type', value)}
                required
              />

              <Select
                label="Jenis Tanaman"
                placeholder="Pilih jenis tanaman"
                options={cropOptions}
                value={formData?.crop}
                onChange={(value) => handleInputChange('crop', value)}
                required
              />

              <Input label="Lokasi" type="text" placeholder="Lahan Utama" value={formData?.location} onChange={(e) => handleInputChange('location', e?.target?.value)} />

              <Input label="Catatan (Opsional)" type="text" placeholder="Tambahkan catatan atau instruksi khusus" value={formData?.notes} onChange={(e) => handleInputChange('notes', e?.target?.value)} />

              {/* Action Buttons */}
              <div className="flex space-x-3 pt-4">
                <Button type="button" variant="outline" fullWidth onClick={onClose}>
                  Batal
                </Button>
                <Button type="submit" variant="default" fullWidth iconName="Plus" iconPosition="left" disabled={!formData?.title || !formData?.type || !formData?.crop || !formData?.date}>
                  Tambah Kegiatan
                </Button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </>
  );
};

export default AddEventModal;



--- File: ./src/pages/farming-calendar/components/CalendarGrid.jsx ---

import React from 'react';
import Icon from '../../../components/AppIcon';

const CalendarGrid = ({ 
  currentDate, 
  viewMode, 
  events, 
  onDateClick, 
  selectedDate 
}) => {
  const getDaysInMonth = (date) => {
    const year = date?.getFullYear();
    const month = date?.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay?.getDate();
    const startingDayOfWeek = firstDay?.getDay();
    
    const days = [];
    
    // Add empty cells for days before the first day of the month
    for (let i = 0; i < startingDayOfWeek; i++) {
      days?.push(null);
    }
    
    // Add days of the month
    for (let day = 1; day <= daysInMonth; day++) {
      days?.push(new Date(year, month, day));
    }
    
    return days;
  };

  const getEventsForDate = (date) => {
    if (!date) return [];
    const dateStr = date?.toISOString()?.split('T')?.[0];
    return events?.filter(event => event?.date === dateStr);
  };

  const getEventTypeIcon = (type) => {
    const iconMap = {
      tanam: 'Sprout',
      pupuk: 'Droplets',
      semprot: 'Spray',
      panen: 'Wheat'
    };
    return iconMap?.[type] || 'Calendar';
  };

  const getEventTypeColor = (type) => {
    const colorMap = {
      tanam: 'text-success bg-success/10',
      pupuk: 'text-secondary bg-secondary/10',
      semprot: 'text-warning bg-warning/10',
      panen: 'text-accent bg-accent/10'
    };
    return colorMap?.[type] || 'text-muted-foreground bg-muted';
  };

  const isToday = (date) => {
    if (!date) return false;
    const today = new Date();
    return date?.toDateString() === today?.toDateString();
  };

  const isSelected = (date) => {
    if (!date || !selectedDate) return false;
    return date?.toDateString() === selectedDate?.toDateString();
  };

  if (viewMode === 'week') {
    // Week view implementation
    const weekDays = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
    const startOfWeek = new Date(selectedDate || currentDate);
    startOfWeek?.setDate(startOfWeek?.getDate() - startOfWeek?.getDay());
    
    const weekDates = [];
    for (let i = 0; i < 7; i++) {
      const date = new Date(startOfWeek);
      date?.setDate(startOfWeek?.getDate() + i);
      weekDates?.push(date);
    }

    return (
      <div className="bg-card">
        <div className="grid grid-cols-7 border-b border-border">
          {weekDays?.map((day, index) => (
            <div key={day} className="p-3 text-center text-sm font-medium text-muted-foreground border-r border-border last:border-r-0">
              {day}
            </div>
          ))}
        </div>
        <div className="grid grid-cols-7 min-h-96">
          {weekDates?.map((date, index) => {
            const dayEvents = getEventsForDate(date);
            return (
              <div
                key={index}
                className={`
                  p-2 border-r border-b border-border last:border-r-0 cursor-pointer
                  hover:bg-muted/50 transition-smooth min-h-32
                  ${isToday(date) ? 'bg-primary/5' : ''}
                  ${isSelected(date) ? 'bg-primary/10' : ''}
                `}
                onClick={() => onDateClick(date)}
              >
                <div className={`
                  text-sm font-medium mb-2
                  ${isToday(date) ? 'text-primary' : 'text-foreground'}
                `}>
                  {date?.getDate()}
                </div>
                <div className="space-y-1">
                  {dayEvents?.slice(0, 3)?.map((event, eventIndex) => (
                    <div
                      key={eventIndex}
                      className={`
                        text-xs px-2 py-1 rounded-md flex items-center space-x-1
                        ${getEventTypeColor(event?.type)}
                      `}
                    >
                      <Icon name={getEventTypeIcon(event?.type)} size={12} />
                      <span className="truncate">{event?.title}</span>
                    </div>
                  ))}
                  {dayEvents?.length > 3 && (
                    <div className="text-xs text-muted-foreground">
                      +{dayEvents?.length - 3} lainnya
                    </div>
                  )}
                </div>
              </div>
            );
          })}
        </div>
      </div>
    );
  }

  // Month view
  const days = getDaysInMonth(currentDate);
  const weekDays = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];

  return (
    <div className="bg-card">
      <div className="grid grid-cols-7 border-b border-border">
        {weekDays?.map(day => (
          <div key={day} className="p-3 text-center text-sm font-medium text-muted-foreground border-r border-border last:border-r-0">
            {day}
          </div>
        ))}
      </div>
      <div className="grid grid-cols-7">
        {days?.map((date, index) => {
          const dayEvents = date ? getEventsForDate(date) : [];
          return (
            <div
              key={index}
              className={`
                min-h-24 p-2 border-r border-b border-border last:border-r-0
                ${date ? 'cursor-pointer hover:bg-muted/50' : 'bg-muted/20'}
                ${date && isToday(date) ? 'bg-primary/5' : ''}
                ${date && isSelected(date) ? 'bg-primary/10' : ''}
                transition-smooth
              `}
              onClick={() => date && onDateClick(date)}
            >
              {date && (
                <>
                  <div className={`
                    text-sm font-medium mb-1
                    ${isToday(date) ? 'text-primary' : 'text-foreground'}
                  `}>
                    {date?.getDate()}
                  </div>
                   {/* --- TAMBAHKAN KODE INI --- */}
      {dayEvents.length > 0 && (
        <div className="flex justify-center items-center mt-1">
          <div className="w-1.5 h-1.5 rounded-full bg-primary"></div>
        </div>
      )}
      {/* --- AKHIR DARI KODE TAMBAHAN --- */}
                  <div className="space-y-1">
                    {dayEvents?.slice(0, 2)?.map((event, eventIndex) => (
                      <div
                        key={eventIndex}
                        className={`
                          text-xs px-1 py-0.5 rounded flex items-center space-x-1
                          ${getEventTypeColor(event?.type)}
                        `}
                      >
                        <Icon name={getEventTypeIcon(event?.type)} size={10} />
                        <span className="truncate">{event?.title}</span>
                      </div>
                    ))}
                    {dayEvents?.length > 2 && (
                      <div className="text-xs text-muted-foreground">
                        +{dayEvents?.length - 2}
                      </div>
                    )}
                  </div>
                </>
              )}
            </div>
          );
        })}
      </div>
    </div>
  );
};

export default CalendarGrid;


--- File: ./src/pages/farming-calendar/components/CalendarHeader.jsx ---

import React from 'react';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';

const CalendarHeader = ({ 
  currentDate, 
  viewMode, 
  onViewModeChange, 
  onPreviousMonth, 
  onNextMonth,
  onAddEvent 
}) => {
  const formatMonthYear = (date) => {
    return new Intl.DateTimeFormat('id-ID', { 
      month: 'long', 
      year: 'numeric' 
    })?.format(date);
  };

  return (
    <div className="bg-card border-b border-border p-4 shadow-md">
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center space-x-4">
          <button
            onClick={onPreviousMonth}
            className="p-2 rounded-lg hover:bg-muted transition-smooth"
            aria-label="Bulan sebelumnya"
          >
            <Icon name="ChevronLeft" size={20} />
          </button>
          
          <h2 className="text-2xl font-bold text-foreground">
            {formatMonthYear(currentDate)}
          </h2>
          
          <button
            onClick={onNextMonth}
            className="p-2 rounded-lg hover:bg-muted transition-smooth"
            aria-label="Bulan selanjutnya"
          >
            <Icon name="ChevronRight" size={20} />
          </button>
        </div>
        
        <Button
          variant="default"
          size="sm"
          iconName="Plus"
          iconPosition="left"
          onClick={onAddEvent}
        >
          Tambah Kegiatan
        </Button>
      </div>
      
      <div className="flex items-center space-x-2">
        <Button
          variant={viewMode === 'month' ? 'default' : 'outline'}
          size="sm"
          onClick={() => onViewModeChange('month')}
        >
          Bulanan
        </Button>
        <Button
          variant={viewMode === 'week' ? 'default' : 'outline'}
          size="sm"
          onClick={() => onViewModeChange('week')}
        >
          Mingguan
        </Button>
      </div>
    </div>
  );
};

export default CalendarHeader;


--- File: ./src/pages/farming-calendar/components/EventDetailsPanel.jsx ---

import React, { useState } from 'react';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';
import Input from '../../../components/ui/Input';

const EventDetailsPanel = ({ 
  selectedDate, 
  events, 
  onAddNote, 
  onUpdateEvent, 
  onDeleteEvent 
}) => {
  const [newNote, setNewNote] = useState('');
  const [editingEvent, setEditingEvent] = useState(null);
  const [editTitle, setEditTitle] = useState('');

  // --- FUNGSI PERBAIKAN DI SINI ---
  const parseNotes = (notes) => {
    if (Array.isArray(notes)) {
      return notes; // Jika sudah array, kembalikan langsung
    }
    if (typeof notes === 'string') {
      try {
        const parsed = JSON.parse(notes);
        return Array.isArray(parsed) ? parsed : [notes]; // Jika parsing gagal jadi array, bungkus string dalam array
      } catch (e) {
        return [notes]; // Jika JSON.parse gagal, anggap itu string biasa dan bungkus dalam array
      }
    }
    return []; // Kembalikan array kosong jika tidak ada notes
  };
  // --- AKHIR DARI FUNGSI PERBAIKAN ---

  if (!selectedDate) {
    return (
      <div className="bg-card border-l border-border p-6 flex items-center justify-center">
        <div className="text-center text-muted-foreground">
          <Icon name="Calendar" size={48} className="mx-auto mb-4 opacity-50" />
          <p>Pilih tanggal untuk melihat detail kegiatan</p>
        </div>
      </div>
    );
  }

  const dateStr = selectedDate?.toISOString()?.split('T')?.[0];
  const dayEvents = events?.filter(event => event?.date === dateStr);

  const formatDate = (date) => {
    return new Intl.DateTimeFormat('id-ID', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    })?.format(date);
  };

  const getEventTypeIcon = (type) => { /* ... (fungsi ini tetap sama) ... */ };
  const getEventTypeColor = (type) => { /* ... (fungsi ini tetap sama) ... */ };
  const getEventTypeName = (type) => { /* ... (fungsi ini tetap sama) ... */ };
  const handleAddNote = () => { /* ... (fungsi ini tetap sama) ... */ };
  const handleEditEvent = (event) => { /* ... (fungsi ini tetap sama) ... */ };
  const handleSaveEdit = (eventId) => { /* ... (fungsi ini tetap sama) ... */ };
  const handleCancelEdit = () => { /* ... (fungsi ini tetap sama) ... */ };

  return (
    <div className="bg-card border-l border-border p-6 overflow-y-auto">
      <div className="mb-6">
        <h3 className="text-lg font-semibold text-foreground mb-2">
          {formatDate(selectedDate)}
        </h3>
        <p className="text-sm text-muted-foreground">
          {dayEvents?.length} kegiatan terjadwal
        </p>
      </div>
      <div className="space-y-4 mb-6">
        {dayEvents?.length === 0 ? (
          <div className="text-center py-8 text-muted-foreground">
            <Icon name="CalendarX" size={32} className="mx-auto mb-2 opacity-50" />
            <p>Tidak ada kegiatan pada tanggal ini</p>
          </div>
        ) : (
          dayEvents?.map((event) => {
            const notesArray = parseNotes(event.notes); // <-- GUNAKAN FUNGSI BARU DI SINI
            return (
              <div
                key={event?.id}
                className={`p-4 rounded-lg border transition-smooth ${getEventTypeColor(event?.type)}`}
              >
                {/* ... (sisa dari JSX untuk detail event tetap sama, tidak perlu diubah) ... */}
                <div className="flex items-start justify-between mb-3">
                    <div className="flex items-center space-x-3">
                    <Icon name={getEventTypeIcon(event?.type)} size={20} />
                    <div>
                        {editingEvent === event?.id ? (
                        <div className="flex items-center space-x-2">
                            <Input
                            type="text"
                            value={editTitle}
                            onChange={(e) => setEditTitle(e?.target?.value)}
                            className="text-sm"
                            placeholder="Judul kegiatan"
                            />
                            <Button
                            variant="ghost"
                            size="sm"
                            iconName="Check"
                            onClick={() => handleSaveEdit(event?.id)}
                            />
                            <Button
                            variant="ghost"
                            size="sm"
                            iconName="X"
                            onClick={handleCancelEdit}
                            />
                        </div>
                        ) : (
                        <>
                            <h4 className="font-medium">{event?.title}</h4>
                            <p className="text-xs opacity-80">
                            {getEventTypeName(event?.type)} â€¢ {event?.crop}
                            </p>
                        </>
                        )}
                    </div>
                    </div>
                    
                    {editingEvent !== event?.id && (
                    <div className="flex items-center space-x-1">
                        <Button
                        variant="ghost"
                        size="sm"
                        iconName="Edit2"
                        onClick={() => handleEditEvent(event)}
                        />
                        <Button
                        variant="ghost"
                        size="sm"
                        iconName="Trash2"
                        onClick={() => onDeleteEvent(event?.id)}
                        />
                    </div>
                    )}
                </div>

                <div className="flex items-center justify-between">
                    <div className="flex items-center space-x-4 text-xs">
                    <span className="flex items-center space-x-1">
                        <Icon name="Clock" size={12} />
                        <span>{event?.time}</span>
                    </span>
                    <span className="flex items-center space-x-1">
                        <Icon name="MapPin" size={12} />
                        <span>{event?.location}</span>
                    </span>
                    </div>
                    
                    <div className={`
                    px-2 py-1 rounded-full text-xs font-medium
                    ${event?.completed 
                        ? 'bg-success text-success-foreground' 
                        : 'bg-muted text-muted-foreground'
                    }
                    `}>
                    {event?.completed ? 'Selesai' : 'Belum'}
                    </div>
                </div>

                {/* --- GUNAKAN `notesArray` YANG SUDAH AMAN DI SINI --- */}
                {notesArray.length > 0 && (
                  <div className="mt-3 pt-3 border-t border-current/10">
                    <p className="text-xs font-medium mb-2">Catatan:</p>
                    <div className="space-y-1">
                      {notesArray.map((note, index) => (
                        <p key={index} className="text-xs opacity-80">
                          â€¢ {note}
                        </p>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            );
          })
        )}
      </div>
      {/* ... (sisa dari JSX untuk "Tambah Catatan" tetap sama) ... */}
    </div>
  );
};

export default EventDetailsPanel;


--- File: ./src/pages/farming-calendar/components/EventFilterBar.jsx ---

import React from 'react';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';

const EventFilterBar = ({ 
  activeFilters, 
  onFilterChange, 
  eventCounts 
}) => {
  const filterOptions = [
    {
      key: 'all',
      label: 'Semua',
      icon: 'Calendar',
      color: 'text-foreground',
      count: eventCounts?.total
    },
    {
      key: 'tanam',
      label: 'Penanaman',
      icon: 'Sprout',
      color: 'text-success',
      count: eventCounts?.tanam
    },
    {
      key: 'pupuk',
      label: 'Pemupukan',
      icon: 'Droplets',
      color: 'text-secondary',
      count: eventCounts?.pupuk
    },
    {
      key: 'semprot',
      label: 'Penyemprotan',
      icon: 'Spray',
      color: 'text-warning',
      count: eventCounts?.semprot
    },
    {
      key: 'panen',
      label: 'Panen',
      icon: 'Wheat',
      color: 'text-accent',
      count: eventCounts?.panen
    }
  ];

  const statusFilters = [
    {
      key: 'pending',
      label: 'Belum Selesai',
      icon: 'Clock',
      count: eventCounts?.pending
    },
    {
      key: 'completed',
      label: 'Selesai',
      icon: 'CheckCircle',
      count: eventCounts?.completed
    }
  ];

  return (
    <div className="bg-card border-b border-border p-4">
      {/* Activity Type Filters */}
      <div className="mb-4">
        <p className="text-sm font-medium text-foreground mb-3">Jenis Kegiatan</p>
        <div className="flex flex-wrap gap-2">
          {filterOptions?.map((filter) => (
            <Button
              key={filter?.key}
              variant={activeFilters?.includes(filter?.key) ? 'default' : 'outline'}
              size="sm"
              onClick={() => onFilterChange('type', filter?.key)}
              className="flex items-center space-x-2"
            >
              <Icon 
                name={filter?.icon} 
                size={16} 
                className={activeFilters?.includes(filter?.key) ? '' : filter?.color}
              />
              <span>{filter?.label}</span>
              {filter?.count > 0 && (
                <span className={`
                  px-1.5 py-0.5 rounded-full text-xs font-medium
                  ${activeFilters?.includes(filter?.key) 
                    ? 'bg-primary-foreground/20 text-primary-foreground' 
                    : 'bg-muted text-muted-foreground'
                  }
                `}>
                  {filter?.count}
                </span>
              )}
            </Button>
          ))}
        </div>
      </div>
      {/* Status Filters */}
      <div className="mb-4">
        <p className="text-sm font-medium text-foreground mb-3">Status</p>
        <div className="flex flex-wrap gap-2">
          {statusFilters?.map((filter) => (
            <Button
              key={filter?.key}
              variant={activeFilters?.includes(filter?.key) ? 'default' : 'outline'}
              size="sm"
              onClick={() => onFilterChange('status', filter?.key)}
              className="flex items-center space-x-2"
            >
              <Icon name={filter?.icon} size={16} />
              <span>{filter?.label}</span>
              {filter?.count > 0 && (
                <span className={`
                  px-1.5 py-0.5 rounded-full text-xs font-medium
                  ${activeFilters?.includes(filter?.key) 
                    ? 'bg-primary-foreground/20 text-primary-foreground' 
                    : 'bg-muted text-muted-foreground'
                  }
                `}>
                  {filter?.count}
                </span>
              )}
            </Button>
          ))}
        </div>
      </div>
      {/* Active Filters Summary */}
      {activeFilters?.length > 0 && !activeFilters?.includes('all') && (
        <div className="flex items-center justify-between pt-3 border-t border-border">
          <div className="flex items-center space-x-2 text-sm text-muted-foreground">
            <Icon name="Filter" size={16} />
            <span>{activeFilters?.length} filter aktif</span>
          </div>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => onFilterChange('clear')}
            className="text-muted-foreground hover:text-foreground"
          >
            Hapus Filter
          </Button>
        </div>
      )}
    </div>
  );
};

export default EventFilterBar;


--- File: ./src/pages/farming-calendar/components/MobileCalendarView.jsx ---

import React from 'react';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';

const MobileCalendarView = ({ 
  events, 
  onEventClick, 
  onAddEvent,
  currentDate,
  onDateChange 
}) => {
  const getUpcomingEvents = () => {
    const today = new Date();
    const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
    
    return events?.filter(event => {
        const eventDate = new Date(event.date);
        return eventDate >= today && eventDate <= nextWeek;
      })?.sort((a, b) => new Date(a.date) - new Date(b.date));
  };

  const getTodayEvents = () => {
    const today = new Date()?.toISOString()?.split('T')?.[0];
    return events?.filter(event => event?.date === today);
  };

  const getEventTypeIcon = (type) => {
    const iconMap = {
      tanam: 'Sprout',
      pupuk: 'Droplets',
      semprot: 'Spray',
      panen: 'Wheat'
    };
    return iconMap?.[type] || 'Calendar';
  };

  const getEventTypeColor = (type) => {
    const colorMap = {
      tanam: 'text-success bg-success/10 border-success/20',
      pupuk: 'text-secondary bg-secondary/10 border-secondary/20',
      semprot: 'text-warning bg-warning/10 border-warning/20',
      panen: 'text-accent bg-accent/10 border-accent/20'
    };
    return colorMap?.[type] || 'text-muted-foreground bg-muted border-border';
  };

  const getEventTypeName = (type) => {
    const nameMap = {
      tanam: 'Penanaman',
      pupuk: 'Pemupukan',
      semprot: 'Penyemprotan',
      panen: 'Panen'
    };
    return nameMap?.[type] || type;
  };

  const formatDate = (dateStr) => {
    const date = new Date(dateStr);
    const today = new Date();
    const tomorrow = new Date(today.getTime() + 24 * 60 * 60 * 1000);
    
    if (date?.toDateString() === today?.toDateString()) {
      return 'Hari Ini';
    } else if (date?.toDateString() === tomorrow?.toDateString()) {
      return 'Besok';
    } else {
      return new Intl.DateTimeFormat('id-ID', {
        weekday: 'long',
        day: 'numeric',
        month: 'short'
      })?.format(date);
    }
  };

  const formatTime = (timeStr) => {
    return timeStr?.substring(0, 5);
  };

  const todayEvents = getTodayEvents();
  const upcomingEvents = getUpcomingEvents();

  return (
    <div className="bg-background min-h-screen pb-20">
      {/* Header */}
      <div className="bg-card border-b border-border p-4">
        <div className="flex items-center justify-between mb-4">
          <h1 className="text-xl font-semibold text-foreground">
            Kalender Pertanian
          </h1>
          <Button
            variant="default"
            size="sm"
            iconName="Plus"
            iconPosition="left"
            onClick={onAddEvent}
          >
            Tambah
          </Button>
        </div>
        
        <div className="text-sm text-muted-foreground">
          {new Intl.DateTimeFormat('id-ID', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          })?.format(new Date())}
        </div>
      </div>
      {/* Today's Events */}
      <div className="p-4">
        <div className="flex items-center justify-between mb-4">
          <h2 className="text-lg font-medium text-foreground">Hari Ini</h2>
          <span className="text-sm text-muted-foreground">
            {todayEvents?.length} kegiatan
          </span>
        </div>

        {todayEvents?.length === 0 ? (
          <div className="bg-card rounded-lg p-6 text-center">
            <Icon name="Calendar" size={32} className="mx-auto mb-2 text-muted-foreground opacity-50" />
            <p className="text-muted-foreground">Tidak ada kegiatan hari ini</p>
          </div>
        ) : (
          <div className="space-y-3">
            {todayEvents?.map((event) => (
              <div
                key={event?.id}
                onClick={() => onEventClick(event)}
                className={`
                  p-4 rounded-lg border cursor-pointer transition-smooth
                  ${getEventTypeColor(event?.type)}
                  hover:shadow-md
                `}
              >
                <div className="flex items-start space-x-3">
                  <Icon name={getEventTypeIcon(event?.type)} size={20} />
                  <div className="flex-1 min-w-0">
                    <h3 className="font-medium truncate">{event?.title}</h3>
                    <p className="text-sm opacity-80 mb-2">
                      {getEventTypeName(event?.type)} â€¢ {event?.crop}
                    </p>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center space-x-3 text-xs">
                        <span className="flex items-center space-x-1">
                          <Icon name="Clock" size={12} />
                          <span>{formatTime(event?.time)}</span>
                        </span>
                        <span className="flex items-center space-x-1">
                          <Icon name="MapPin" size={12} />
                          <span>{event?.location}</span>
                        </span>
                      </div>
                      <div className={`
                        px-2 py-1 rounded-full text-xs font-medium
                        ${event?.completed 
                          ? 'bg-success text-success-foreground' 
                          : 'bg-muted text-muted-foreground'
                        }
                      `}>
                        {event?.completed ? 'Selesai' : 'Belum'}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
      {/* Upcoming Events */}
      <div className="p-4">
        <div className="flex items-center justify-between mb-4">
          <h2 className="text-lg font-medium text-foreground">Minggu Ini</h2>
          <span className="text-sm text-muted-foreground">
            {upcomingEvents?.length} kegiatan
          </span>
        </div>

        {upcomingEvents?.length === 0 ? (
          <div className="bg-card rounded-lg p-6 text-center">
            <Icon name="CalendarX" size={32} className="mx-auto mb-2 text-muted-foreground opacity-50" />
            <p className="text-muted-foreground">Tidak ada kegiatan minggu ini</p>
          </div>
        ) : (
          <div className="space-y-3">
            {upcomingEvents?.map((event) => (
              <div
                key={event?.id}
                onClick={() => onEventClick(event)}
                className={`
                  p-4 rounded-lg border cursor-pointer transition-smooth
                  ${getEventTypeColor(event?.type)}
                  hover:shadow-md
                `}
              >
                <div className="flex items-start space-x-3">
                  <Icon name={getEventTypeIcon(event?.type)} size={20} />
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center justify-between mb-1">
                      <h3 className="font-medium truncate">{event?.title}</h3>
                      <span className="text-xs text-muted-foreground">
                        {formatDate(event?.date)}
                      </span>
                    </div>
                    <p className="text-sm opacity-80 mb-2">
                      {getEventTypeName(event?.type)} â€¢ {event?.crop}
                    </p>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center space-x-3 text-xs">
                        <span className="flex items-center space-x-1">
                          <Icon name="Clock" size={12} />
                          <span>{formatTime(event?.time)}</span>
                        </span>
                        <span className="flex items-center space-x-1">
                          <Icon name="MapPin" size={12} />
                          <span>{event?.location}</span>
                        </span>
                      </div>
                      <div className={`
                        px-2 py-1 rounded-full text-xs font-medium
                        ${event?.completed 
                          ? 'bg-success text-success-foreground' 
                          : 'bg-muted text-muted-foreground'
                        }
                      `}>
                        {event?.completed ? 'Selesai' : 'Belum'}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
};

export default MobileCalendarView;


--- File: ./src/pages/farming-calendar/index.jsx ---

// src/pages/farming-calendar/index.jsx
import React, { useState, useEffect, useMemo } from 'react';
import { useNavigate } from 'react-router-dom';

// [PERBAIKAN #1] Pindahkan semua impor hook ke sini, di bagian atas.
import {
  useGetFarmTasksQuery,
  useCreateFarmTaskMutation,
  useUpdateFarmTaskMutation,
  useDeleteFarmTaskMutation,
} from '../../services/farmTasksApi';

import {
  enqueueRequest,
  upsertEventLocal,
  upsertEventsLocal,
  getEventsByRange,
} from '../../offline/queueService';
import BottomNavigation from '../../components/ui/BottomNavigation';
import LoadingOverlay from '../../components/ui/LoadingOverlay';
import OfflineStatusBanner from '../../components/ui/OfflineStatusBanner';
import CalendarHeader from './components/CalendarHeader';
import CalendarGrid from './components/CalendarGrid';
import EventDetailsPanel from './components/EventDetailsPanel';
import EventFilterBar from './components/EventFilterBar';
import AddEventModal from './components/AddEventModal';
import MobileCalendarView from './components/MobileCalendarView';
import Icon from '../../components/AppIcon';
import DesktopTopNav from '../../components/layout/DesktopTopNav';

// Helpers
const toISO = (d) => new Date(d).toISOString();
const makeRange = (centerDate) => {
  const base = centerDate ? new Date(centerDate) : new Date();
  const from = new Date(base);
  const to = new Date(base);
  from.setDate(from.getDate() - 14);
  to.setDate(to.getDate() + 14);
  return { from: toISO(from), to: toISO(to) };
};

const FarmingCalendar = () => {
  const navigate = useNavigate();
  const [currentDate, setCurrentDate] = useState(new Date());
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [viewMode, setViewMode] = useState('month');
  const [activeFilters, setActiveFilters] = useState(['all']);
  const [isAddEventModalOpen, setIsAddEventModalOpen] = useState(false);
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [isMobile, setIsMobile] = useState(window.innerWidth < 768);
  const [cachedEvents, setCachedEvents] = useState([]);

  const range = useMemo(() => makeRange(currentDate), [currentDate]);

  // [PERBAIKAN #2] Gunakan nama hook yang benar (useGetFarmTasksQuery)
  const { data: eventsOnline = [], isFetching, isError } = useGetFarmTasksQuery(range, {
    skip: !isOnline,
    refetchOnReconnect: true,
    refetchOnFocus: false,
    keepUnusedDataFor: 3600,
  });

  // [PERBAIKAN #3] Gunakan nama hook mutasi yang benar
  const [createEvent] = useCreateFarmTaskMutation();
  const [updateEvent] = useUpdateFarmTaskMutation();
  const [deleteEvent] = useDeleteFarmTaskMutation();

  useEffect(() => {
    const handleOnline = () => setIsOnline(true);
    const handleOffline = () => setIsOnline(false);
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth < 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  useEffect(() => {
    const saved = localStorage.getItem('farming-calendar-filters');
    if (saved) setActiveFilters(JSON.parse(saved));
  }, []);
  useEffect(() => {
    localStorage.setItem('farming-calendar-filters', JSON.stringify(activeFilters));
  }, [activeFilters]);

  // LKG cache
  useEffect(() => {
    if (isOnline && eventsOnline && eventsOnline.length) {
      upsertEventsLocal(eventsOnline).catch(console.warn);
      setCachedEvents(eventsOnline);
    }
  }, [isOnline, eventsOnline]);

  useEffect(() => {
    if (!isOnline) {
      (async () => {
        try {
          const lkg = await getEventsByRange({ from: range.from, to: range.to });
          setCachedEvents(lkg || []);
        } catch (e) {
          console.warn('Gagal memuat cache events:', e);
          setCachedEvents([]);
        }
      })();
    }
  }, [isOnline, range.from, range.to]);

  const events = isOnline ? eventsOnline : cachedEvents;

  const handlePreviousMonth = () => {
    const newDate = new Date(currentDate);
    newDate.setMonth(currentDate.getMonth() - 1);
    setCurrentDate(newDate);
  };
  const handleNextMonth = () => {
    const newDate = new Date(currentDate);
    newDate.setMonth(currentDate.getMonth() + 1);
    setCurrentDate(newDate);
  };

  const handleDateClick = (date) => setSelectedDate(date);
  const handleViewModeChange = (mode) => setViewMode(mode);

  const handleAddEvent = async (newEvent) => {
    try {
      if (isOnline) {
        await createEvent(newEvent).unwrap();
      } else {
        await enqueueRequest({ type: 'createEvent', payload: newEvent });
        await upsertEventLocal(newEvent);
        alert('Anda sedang offline. Jadwal baru disimpan dan akan disinkronkan saat online.');
      }
    } catch (error) {
      console.error('Gagal menambah event:', error);
      await enqueueRequest({ type: 'createEvent', payload: newEvent });
      await upsertEventLocal(newEvent);
    }
  };

  const handleUpdateEvent = async (eventId, updates) => {
    try {
      if (isOnline) {
        await updateEvent({ id: eventId, ...updates }).unwrap();
      } else {
        await enqueueRequest({ type: 'updateEvent', payload: { id: eventId, ...updates } });
        await upsertEventLocal({ id: eventId, ...updates });
      }
    } catch (error) {
      console.error('Gagal update event:', error);
      await enqueueRequest({ type: 'updateEvent', payload: { id: eventId, ...updates } });
      await upsertEventLocal({ id: eventId, ...updates });
    }
  };

  const handleDeleteEvent = async (eventId) => {
    try {
      if (isOnline) {
        await deleteEvent(eventId).unwrap();
      } else {
        await enqueueRequest({ type: 'deleteEvent', payload: { id: eventId } });
        await upsertEventLocal({ id: eventId, __deleted: true });
      }
    } catch (error) {
      console.error('Gagal menghapus event:', error);
      await enqueueRequest({ type: 'deleteEvent', payload: { id: eventId } });
      await upsertEventLocal({ id: eventId, __deleted: true });
    }
  };

  const handleAddNote = (dateStr, note) => {
    const noteEntry = {
      id: `note_${Date.now()}`,
      date: dateStr,
      title: `Catatan - ${new Date(dateStr).toLocaleDateString('id-ID')}`,
      type: 'note',
      crop: 'umum',
      time: new Date().toTimeString().substring(0, 5),
      location: 'Catatan Harian',
      completed: true,
      notes: [note],
      createdAt: new Date().toISOString(),
    };
    handleAddEvent(noteEntry);
  };

  const handleFilterChange = (filterType, filterValue) => {
    if (filterType === 'clear' || filterValue === 'all') {
      setActiveFilters(['all']);
      return;
    }
    setActiveFilters((prev) => {
      const newFilters = prev.filter((f) => f !== 'all');
      if (newFilters.includes(filterValue)) {
        const filtered = newFilters.filter((f) => f !== filterValue);
        return filtered.length === 0 ? ['all'] : filtered;
      } else {
        return [...newFilters, filterValue];
      }
    });
  };

  const getFilteredEvents = () => {
    const base = events.filter((e) => !e.__deleted);
    if (activeFilters.includes('all')) return base;
    return base.filter((event) => {
      const typeMatch =
        ['tanam', 'pupuk', 'semprot', 'panen'].includes(event.type) &&
        activeFilters.some((f) => f === event.type);
      const statusMatch = activeFilters.some((f) => {
        if (f === 'completed') return event.completed;
        if (f === 'pending') return !event.completed;
        return false;
      });
      return typeMatch || statusMatch;
    });
  };

  const getEventCounts = () => {
    const base = events.filter((e) => !e.__deleted);
    return {
      total: base.length,
      tanam: base.filter((e) => e.type === 'tanam').length,
      pupuk: base.filter((e) => e.type === 'pupuk').length,
      semprot: base.filter((e) => e.type === 'semprot').length,
      panen: base.filter((e) => e.type === 'panen').length,
      completed: base.filter((e) => e.completed).length,
      pending: base.filter((e) => !e.completed).length,
    };
  };

  const handleEventClick = (event) => {
    const raw = event?.date || event?.start_at || event;
    const date = raw ? new Date(raw) : new Date();
    setSelectedDate(date);
    setCurrentDate(date);
  };

  const filteredEvents = getFilteredEvents();
  const eventCounts = getEventCounts();

  if (isFetching && isOnline) {
    return (
      <LoadingOverlay isVisible={true} message="Memuat kalender pertanian..." animationType="plant" />
    );
  }

  if (isError && isOnline) {
    return (
      <div className="flex items-center justify-center h-screen">
        <div className="text-center">
          <Icon name="WifiOff" size={48} className="text-destructive mx-auto mb-4" />
          <h2 className="text-xl font-bold text-foreground">Gagal Memuat Data</h2>
          <p className="text-muted-foreground">
            Terjadi kesalahan saat memuat data kalender. Silakan coba lagi nanti.
          </p>
        </div>
      </div>
    );
  }

  if (isMobile) {
    return (
      <div className="min-h-screen bg-background">
        <div className="hidden md:block">
          <DesktopTopNav />
        </div>
        <div className="mx-auto w-full max-w-screen-xl px-4 md:px-6 lg:px-8">
          <OfflineStatusBanner isOnline={isOnline} />
          <div className="bg-card border-b border-border sticky top-0 z-30">
            <div className="px-0 md:px-2 lg:px-4 py-4">
              <div className="flex items-center gap-3">
                <button
                  onClick={() => navigate('/home-dashboard')}
                  className="p-2 rounded-xl hover:bg-muted transition-smooth"
                  aria-label="Kembali ke beranda"
                >
                  <Icon name="ArrowLeft" size={24} className="text-foreground" />
                </button>
                <div>
                  <h1 className="text-lg font-semibold text-foreground">Kalender</h1>
                  <p className="text-sm text-muted-foreground">Jadwal kegiatan pertanian</p>
                </div>
              </div>
            </div>
          </div>
          <MobileCalendarView
            events={filteredEvents}
            onEventClick={handleEventClick}
            onAddEvent={() => setIsAddEventModalOpen(true)}
            currentDate={currentDate}
            onDateChange={setCurrentDate}
          />
          <AddEventModal
            isOpen={isAddEventModalOpen}
            onClose={() => setIsAddEventModalOpen(false)}
            onAddEvent={handleAddEvent}
            selectedDate={selectedDate}
          />
          <div className="md:hidden">
            <BottomNavigation />
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      <div className="hidden md:block">
        <DesktopTopNav />
      </div>
      <div className="mx-auto w-full max-w-screen-xl px-4 md:px-6 lg:px-8">
        <div className="bg-card border-b border-border sticky top-0 z-30">
          <div className="px-0 md:px-2 lg:px-4 py-6">
            <div className="flex items-center gap-3">
              <button
                onClick={() => navigate('/home-dashboard')}
                className="p-2 rounded-xl hover:bg-muted transition-smooth"
                aria-label="Kembali ke beranda"
              >
                <Icon name="ArrowLeft" size={24} className="text-foreground" />
              </button>
              <div>
                <h1 className="text-2xl font-bold text-foreground">Kalender</h1>
                <p className="text-sm text-muted-foreground">Jadwal kegiatan pertanian</p>
              </div>
            </div>
          </div>
        </div>
        <OfflineStatusBanner isOnline={isOnline} />
        <div className="flex h-screen">
          <div className="flex-1 flex flex-col">
            <CalendarHeader
              currentDate={currentDate}
              viewMode={viewMode}
              onViewModeChange={handleViewModeChange}
              onPreviousMonth={handlePreviousMonth}
              onNextMonth={handleNextMonth}
              onAddEvent={() => setIsAddEventModalOpen(true)}
            />
            <EventFilterBar
              activeFilters={activeFilters}
              onFilterChange={handleFilterChange}
              eventCounts={eventCounts}
            />
            <div className="flex-1 overflow-hidden">
              <CalendarGrid
                currentDate={currentDate}
                viewMode={viewMode}
                events={filteredEvents}
                onDateClick={handleDateClick}
                selectedDate={selectedDate}
              />
            </div>
          </div>
          <div className="w-80 border-l border-border">
            <EventDetailsPanel
              selectedDate={selectedDate}
              events={filteredEvents}
              onAddNote={handleAddNote}
              onUpdateEvent={handleUpdateEvent}
              onDeleteEvent={handleDeleteEvent}
            />
          </div>
        </div>
        <AddEventModal
          isOpen={isAddEventModalOpen}
          onClose={() => setIsAddEventModalOpen(false)}
          onAddEvent={handleAddEvent}
          selectedDate={selectedDate}
        />
        <div className="md:hidden">
          <BottomNavigation />
        </div>
      </div>
    </div>
  );
};

export default FarmingCalendar;


--- File: ./src/pages/forgot-password/index.jsx ---

// src/pages/forgot-password/index.jsx - VERSI DIPERBAIKI

import React from 'react';
import { useNavigate } from 'react-router-dom';
import Icon from '../../components/AppIcon';
import Button from '../../components/ui/Button';
import Input from '../../components/ui/Input';
import { useForgotPasswordMutation } from '../../services/authApi';

const ForgotPasswordPage = () => {
    const [email, setEmail] = React.useState('');
    const [error, setError] = React.useState(null);
    const [isSuccess, setIsSuccess] = React.useState(false);
    // Kita tidak lagi butuh isLoading manual karena RTK Query akan menanganinya
    // const [isLoading, setIsLoading] = React.useState(false); // INI DIHAPUS

    const navigate = useNavigate();

    const [forgotPassword, { isLoading }] = useForgotPasswordMutation(); // isLoading didapat dari sini

    const handleSubmit = async (e) => {
        e.preventDefault();
        // setIsLoading(true); // Tidak perlu lagi
        setError(null);
        
        try {
            await forgotPassword({ email }).unwrap();
            setIsSuccess(true);
        } catch (err) {
            setError("Terjadi kesalahan. Silakan coba lagi nanti.");
        } 
        // finally { setIsLoading(false); } // Tidak perlu lagi
    };

    return (
        <div className="min-h-screen flex items-center justify-center bg-background p-4">
            <div className="w-full max-w-md">
                <div className="text-center mb-8">
                    <Icon name="MailQuestion" size={48} className="text-primary mx-auto mb-4" />
                    <h1 className="text-3xl font-bold text-foreground">Lupa Password</h1>
                    <p className="text-muted-foreground">
                        {isSuccess 
                            ? "Silakan periksa email Anda untuk instruksi selanjutnya."
                            : "Masukkan email Anda untuk menerima tautan reset password."
                        }
                    </p>
                </div>

                <div className="bg-card p-8 rounded-2xl border border-border shadow-lg">
                    {isSuccess ? (
                        <div className="text-center">
                            <p className="text-foreground mb-6">
                                Jika email yang Anda masukkan terdaftar, tautan telah dikirimkan.
                            </p>
                            <Button
                                fullWidth
                                onClick={() => navigate('/login')}
                                iconName="ArrowLeft"
                                iconPosition="left"
                            >
                                Kembali ke Login
                            </Button>
                        </div>
                    ) : (
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <Input
                                label="Alamat Email" id="email" type="email"
                                placeholder="contoh@email.com"
                                value={email} onChange={(e) => setEmail(e.target.value)}
                                required disabled={isLoading}
                            />
                            {error && <div className="text-sm text-destructive">{error}</div>}
                            <Button type="submit" fullWidth loading={isLoading} iconName="Send" iconPosition="left">
                                {isLoading ? 'Mengirim...' : 'Kirim Instruksi'}
                            </Button>
                        </form>
                    )}
                </div>
            </div>
        </div>
    );
};

export default ForgotPasswordPage;


--- File: ./src/pages/home-dashboard/components/CommunityAlertSnippet.jsx ---

import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';
import { useGetAlertsQuery } from '../../../services/alertsApi'; // <-- LANGKAH 1: IMPORT HOOK
import normalizePhotoUrl from '../../../utils/normalizePhotoUrl';

const CommunityAlertSnippet = ({ className = '' }) => {
  const navigate = useNavigate();
  const [expandedAlert, setExpandedAlert] = useState(null);

  // LANGKAH 2: PANGGIL HOOK UNTUK MENGAMBIL DATA SECARA DINAMIS
  const { 
    data: alerts, 
    isLoading, 
    isError 
  } = useGetAlertsQuery();

  const getSeverityColor = (severity) => {
    switch (severity?.toLowerCase()) {
      case 'tinggi':
        return 'text-error bg-error/10 border-error/20';
      case 'sedang':
        return 'text-warning bg-warning/10 border-warning/20';
      case 'rendah':
      case 'baik':
        return 'text-success bg-success/10 border-success/20';
      default:
        return 'text-muted-foreground bg-muted border-border';
    }
  };

  const getSeverityIcon = (severity) => {
    switch (severity?.toLowerCase()) {
      case 'tinggi':
        return 'AlertTriangle';
      case 'sedang':
        return 'AlertCircle';
      default:
        return 'Info';
    }
  };

  const formatTimeAgo = (timestamp) => {
    const now = new Date();
    const diff = now - new Date(timestamp);
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor((diff / (1000 * 60)) % 60);

    if (hours > 0) return `${hours} jam yang lalu`;
    if (minutes > 0) return `${minutes} menit yang lalu`;
    return 'Baru saja';
  };

  const handleViewAllAlerts = () => {
    navigate('/community-alerts');
  };

  const toggleExpand = (alertId) => {
    setExpandedAlert(expandedAlert === alertId ? null : alertId);
  };

  const renderContent = () => {
    // LANGKAH 3: TAMPILKAN STATUS LOADING
    if (isLoading) {
      return (
        <div className="text-center py-8">
          <Icon name="Loader2" size={32} className="text-primary animate-spin mx-auto mb-4" />
          <p className="text-sm text-muted-foreground">Memuat peringatan terbaru...</p>
        </div>
      );
    }

    // LANGKAH 4: TAMPILKAN STATUS ERROR
    if (isError) {
      return (
        <div className="text-center py-8">
          <Icon name="WifiOff" size={32} className="text-error mx-auto mb-4" />
          <h3 className="text-lg font-medium text-foreground mb-2">Gagal Memuat Peringatan</h3>
          <p className="text-sm text-muted-foreground">Tidak dapat terhubung ke server.</p>
        </div>
      );
    }

    // LANGKAH 5: TAMPILKAN JIKA TIDAK ADA DATA
    if (!alerts || alerts.length === 0) {
      return (
        <div className="text-center py-8">
          <Icon name="Bell" size={48} className="text-muted-foreground mx-auto mb-4" />
          <h3 className="text-lg font-medium text-foreground mb-2">Tidak Ada Peringatan</h3>
          <p className="text-sm text-muted-foreground">Belum ada peringatan hama terbaru di area Anda.</p>
        </div>
      );
    }

    // LANGKAH 6: TAMPILKAN DATA DINAMIS JIKA BERHASIL
    return (
      <div className="space-y-4">
        {alerts?.slice(0, 2)?.map((alert) => {
          const imgSrc = normalizePhotoUrl(alert?.photoKey, alert?.photoUrl ?? alert?.photo_url ?? null);
          return (
          <div
            key={alert.id}
            className="border border-border rounded-xl p-4 hover:bg-muted/30 transition-smooth"
          >
            {imgSrc && (
              <div className="mb-3 overflow-hidden rounded-lg border border-border/60">
                <img src={imgSrc} alt="Foto laporan" className="w-full h-32 object-cover" loading="lazy" />
              </div>
            )}
            <div className="flex items-start justify-between mb-3">
              <div className="flex items-start space-x-3 flex-1">
                <Icon 
                  name={getSeverityIcon(alert.severity)} 
                  size={20} 
                  className={getSeverityColor(alert.severity)?.split(' ')[0]} 
                />
                <div className="flex-1 min-w-0">
                  <h3 className="font-medium text-foreground mb-1">
                    {alert.pestType}
                  </h3>
                  <div className="flex items-center space-x-4 text-xs text-muted-foreground mb-2">
                    <div className="flex items-center space-x-1">
                      <Icon name="MapPin" size={12} />
                      <span>{alert.reporterLocation}</span>
                    </div>
                    <div className="flex items-center space-x-1">
                      <Icon name="Clock" size={12} />
                      <span>{formatTimeAgo(alert.timestamp)}</span>
                    </div>
                  </div>
                  <div className="flex items-center space-x-2">
                    <span className={`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${getSeverityColor(alert.severity)}`}>
                      {alert.severity?.charAt(0)?.toUpperCase() + alert.severity?.slice(1)}
                    </span>
                  </div>
                </div>
              </div>
              <button
                onClick={() => toggleExpand(alert.id)}
                className="p-1 rounded-md hover:bg-muted transition-smooth flex-shrink-0 ml-2"
                aria-label={expandedAlert === alert.id ? 'Tutup detail' : 'Lihat detail'}
              >
                <Icon 
                  name={expandedAlert === alert.id ? 'ChevronUp' : 'ChevronDown'} 
                  size={16} 
                  className="text-muted-foreground"
                />
              </button>
            </div>
            {expandedAlert === alert.id && (
              <div className="mt-4 pt-4 border-t border-border">
                <p className="text-sm text-muted-foreground whitespace-pre-line leading-relaxed">
                  {alert.description}
                </p>
              </div>
            )}
          </div>
        );
        })}
      </div>
    );
  };

  return (
    <div className={`bg-card border border-border rounded-2xl p-6 ${className}`}>
      <div className="flex items-center justify-between mb-6">
        <div className="flex items-center space-x-3">
          <div className="p-2 bg-accent/10 rounded-lg">
            <Icon name="Bell" size={20} className="text-accent" />
          </div>
          <div>
            <h2 className="text-lg font-semibold text-foreground">Peringatan Komunitas</h2>
            <p className="text-sm text-muted-foreground">Alert terbaru dari petani sekitar</p>
          </div>
        </div>
        <Button
          variant="ghost"
          size="sm"
          iconName="ExternalLink"
          iconPosition="right"
          onClick={handleViewAllAlerts}
          className="text-primary hover:text-primary/80"
        >
          Lihat Semua
        </Button>
      </div>
      
      {renderContent()}

      {alerts && alerts.length > 2 && (
        <div className="mt-6 pt-4 border-t border-border">
          <Button
            variant="outline"
            fullWidth
            iconName="ArrowRight"
            iconPosition="right"
            onClick={handleViewAllAlerts}
          >
            Lihat {alerts.length - 2} Peringatan Lainnya
          </Button>
        </div>
      )}
    </div>
  );
};

export default CommunityAlertSnippet;



--- File: ./src/pages/home-dashboard/components/NavigationCard.jsx ---

//src/pages/home-dashboard/components/NavigationCard.jsx
import React from 'react';
import { useNavigate } from 'react-router-dom';
import Icon from '../../../components/AppIcon';

const NavigationCard = ({ 
  title, 
  description, 
  iconName, 
  route, 
  variant = 'default',
  className = '' 
}) => {
  const navigate = useNavigate();

  const handleNavigation = () => {
    navigate(route);
  };

  const getVariantStyles = () => {
    switch (variant) {
      case 'camera':
        return 'bg-primary/10 border-primary/20 hover:bg-primary/15';
      case 'calendar':
        return 'bg-secondary/10 border-secondary/20 hover:bg-secondary/15';
      case 'alerts':
        return 'bg-accent/10 border-accent/20 hover:bg-accent/15';
      // --- PENAMBAHAN BARU DI SINI ---
      case 'history':
        return 'bg-indigo-50 border-indigo-200 hover:bg-indigo-100'; // Menggunakan warna indigo yang netral
      // --- AKHIR DARI PENAMBAHAN ---
      default:
        return 'bg-card border-border hover:bg-muted/50';
    }
  };
  
  const getIconStyles = () => {
    switch (variant) {
      case 'camera': return 'bg-primary text-primary-foreground';
      case 'calendar': return 'bg-secondary text-secondary-foreground';
      case 'alerts': return 'bg-accent text-accent-foreground';
      // --- PENAMBAHAN BARU DI SINI ---
      case 'history': return 'bg-indigo-500 text-white';
      // --- AKHIR DARI PENAMBAHAN ---
      default: return 'bg-muted text-foreground';
    }
  }

  return (
    <div 
      className={`
        ${getVariantStyles()}
        border rounded-2xl p-6 transition-smooth cursor-pointer
        shadow-agricultural hover:shadow-agricultural-lg
        ${className}
      `}
      onClick={handleNavigation}
      role="button"
      tabIndex={0}
      onKeyDown={(e) => {
        if (e?.key === 'Enter' || e?.key === ' ') {
          e?.preventDefault();
          handleNavigation();
        }
      }}
    >
      <div className="flex items-center space-x-4">
        <div className={`p-3 rounded-xl ${getIconStyles()}`}>
          <Icon name={iconName} size={24} strokeWidth={2} />
        </div>
        
        <div className="flex-1 min-w-0">
          <h3 className="text-lg font-semibold text-foreground mb-1">
            {title}
          </h3>
          <p className="text-sm text-muted-foreground leading-relaxed">
            {description}
          </p>
        </div>
        
        <div className="flex-shrink-0">
          <Icon 
            name="ChevronRight" 
            size={20} 
            className="text-muted-foreground" 
          />
        </div>
      </div>
    </div>
  );
};

export default NavigationCard;


--- File: ./src/pages/home-dashboard/components/QuickActions.jsx ---

import React from 'react';
import { useNavigate } from 'react-router-dom';
import Icon from '../../../components/AppIcon';


const QuickActions = ({ className = '' }) => {
  const navigate = useNavigate();

  const quickActions = [
    {
      id: 'diagnosis',
      title: 'Diagnosis Cepat',
      description: 'Foto tanaman untuk analisis AI',
      icon: 'Camera',
      route: '/photo-diagnosis',
      color: 'primary'
    },
    {
      id: 'weather',
      title: 'Cuaca Hari Ini',
      description: 'Prakiraan dan rekomendasi',
      icon: 'CloudSun',
      action: 'weather',
      color: 'secondary'
    },
    {
      id: 'notes',
      title: 'Catatan Cepat',
      description: 'Tulis observasi lapangan',
      icon: 'PenTool',
      action: 'notes',
      color: 'accent'
    },
    {
      id: 'help',
      title: 'Bantuan',
      description: 'Panduan dan tips',
      icon: 'HelpCircle',
      action: 'help',
      color: 'muted'
    }
  ];

  const handleAction = (action) => {
    if (action?.route) {
      navigate(action?.route);
    } else {
      // Handle other actions
      switch (action?.action) {
        case 'weather':
          // Show weather modal or navigate to weather page
          console.log('Show weather details');
          break;
        case 'notes':
          // Open quick notes modal
          console.log('Open quick notes');
          break;
        case 'help':
          // Navigate to help section
          console.log('Show help');
          break;
        default:
          break;
      }
    }
  };

  const getColorClasses = (color) => {
    switch (color) {
      case 'primary':
        return 'bg-primary/10 text-primary hover:bg-primary/15';
      case 'secondary':
        return 'bg-secondary/10 text-secondary hover:bg-secondary/15';
      case 'accent':
        return 'bg-accent/10 text-accent hover:bg-accent/15';
      default:
        return 'bg-muted text-muted-foreground hover:bg-muted/80';
    }
  };

  return (
    <div className={`${className}`}>
      <div className="mb-4">
        <h2 className="text-lg font-semibold text-foreground mb-1">
          Aksi Cepat
        </h2>
        <p className="text-sm text-muted-foreground">
          Fitur yang sering digunakan
        </p>
      </div>
      <div className="grid grid-cols-2 gap-3">
        {quickActions?.map((action) => (
          <button
            key={action?.id}
            onClick={() => handleAction(action)}
            className={`
              ${getColorClasses(action?.color)}
              p-4 rounded-xl border border-border/50 transition-smooth
              text-left hover:shadow-agricultural
            `}
          >
            <div className="flex items-center space-x-3">
              <div className={`
                p-2 rounded-lg
                ${action?.color === 'primary' ? 'bg-primary text-primary-foreground' : ''}
                ${action?.color === 'secondary' ? 'bg-secondary text-secondary-foreground' : ''}
                ${action?.color === 'accent' ? 'bg-accent text-accent-foreground' : ''}
                ${action?.color === 'muted' ? 'bg-muted-foreground text-background' : ''}
              `}>
                <Icon name={action?.icon} size={20} />
              </div>
              
              <div className="flex-1 min-w-0">
                <h3 className="font-medium text-foreground text-sm mb-1">
                  {action?.title}
                </h3>
                <p className="text-xs text-muted-foreground leading-tight">
                  {action?.description}
                </p>
              </div>
            </div>
          </button>
        ))}
      </div>
    </div>
  );
};

export default QuickActions;


--- File: ./src/pages/home-dashboard/components/WelcomeHeader.jsx ---

// src/pages/home-dashboard/components/WelcomeHeader.jsx

import React from 'react';
import { useSelector, useDispatch } from 'react-redux'; // <-- 1. Impor 'useDispatch'
import { useNavigate } from 'react-router-dom'; // <-- 2. Impor 'useNavigate'
import { selectCurrentUser, logOut } from '../../../services/authSlice'; // <-- 3. Impor instruksi 'logOut'
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button'; // <-- 4. Impor komponen 'Button'

const WelcomeHeader = ({ className = '' }) => {
  const currentUser = useSelector(selectCurrentUser);
  const dispatch = useDispatch(); // <-- 5. Siapkan 'dispatch'
  const navigate = useNavigate(); // <-- 6. Siapkan 'navigate'

  // Fungsi yang akan dijalankan saat tombol logout diklik
  const handleLogout = () => {
    dispatch(logOut()); // <-- 7. Jalankan instruksi 'logOut' dari authSlice
    navigate('/login'); // <-- 8. Arahkan pengguna kembali ke halaman login
  };
  
  // Data statis yang belum ada di profil pengguna, kita biarkan sebagai mock.
  const mockData = {
    location: "Desa Oesao, Kupang",
    lastActivity: new Date(Date.now() - 3 * 60 * 60 * 1000),
    totalFields: 3,
    activeCrops: 2
  };
  
  const displayName = currentUser?.fullName || currentUser?.email || "Pengguna";

  const getCurrentGreeting = () => {
    // ... (fungsi ini tetap sama persis)
    const hour = new Date().getHours();
    if (hour < 12) return "Selamat Pagi";
    if (hour < 15) return "Selamat Siang";
    if (hour < 18) return "Selamat Sore";
    return "Selamat Malam";
  };

  const formatLastActivity = (timestamp) => {
    // ... (fungsi ini tetap sama persis)
    const now = new Date();
    const diff = now - timestamp;
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    if (days > 0) return `${days} hari yang lalu`;
    if (hours > 0) return `${hours} jam yang lalu`;
    return 'Baru saja aktif';
  };

  return (
    <div className={`bg-gradient-to-r from-primary/5 to-secondary/5 rounded-2xl p-6 ${className}`}>
      <div className="flex items-start justify-between">
        <div className="flex-1">
          {/* Greeting */}
          <div className="mb-4">
            {/* 9. Tambahkan tombol Logout di samping sapaan */}
            <div className="flex items-center justify-between">
                <h1 className="text-2xl font-bold text-foreground mb-1">
                    {getCurrentGreeting()}, {displayName}! ğŸŒ±
                </h1>
                <Button 
                    variant="ghost" 
                    size="sm" 
                    onClick={handleLogout} 
                    className="text-muted-foreground hover:text-destructive hover:bg-destructive/10"
                    title="Keluar"
                >
                    <Icon name="LogOut" size={18} />
                </Button>
            </div>
            <p className="text-sm text-muted-foreground">
              Semoga hari ini membawa hasil panen yang melimpah
            </p>
          </div>

          {/* Sisa dari komponen tetap sama persis */}
          {/* Location & Activity */}
          <div className="space-y-2">
            <div className="flex items-center space-x-2 text-sm text-muted-foreground">
              <Icon name="MapPin" size={16} />
              <span>{mockData.location}</span>
            </div>
            <div className="flex items-center space-x-2 text-sm text-muted-foreground">
              <Icon name="Clock" size={16} />
              <span>Terakhir aktif {formatLastActivity(mockData.lastActivity)}</span>
            </div>
          </div>
          {/* Quick Stats */}
          <div className="flex items-center space-x-6 mt-4 pt-4 border-t border-border/50">
            {/* ... sisa Quick Stats ... */}
            <div className="text-center">
              <div className="text-lg font-semibold text-foreground">{mockData.totalFields}</div>
              <div className="text-xs text-muted-foreground">Lahan</div>
            </div>
            <div className="text-center">
              <div className="text-lg font-semibold text-foreground">{mockData.activeCrops}</div>
              <div className="text-xs text-muted-foreground">Tanaman Aktif</div>
            </div>
            <div className="text-center">
              <div className="text-lg font-semibold text-success">Baik</div>
              <div className="text-xs text-muted-foreground">Status Lahan</div>
            </div>
          </div>
        </div>
        {/* Weather Widget */}
        <div className="flex-shrink-0 ml-4">
            {/* ... sisa Weather Widget ... */}
            <div className="bg-card/50 backdrop-blur-sm rounded-xl p-4 text-center min-w-[80px]">
              <Icon name="Sun" size={32} className="text-warning mx-auto mb-2" />
              <div className="text-lg font-semibold text-foreground">32Â°</div>
              <div className="text-xs text-muted-foreground">Cerah</div>
            </div>
        </div>
      </div>
    </div>
  );
};

export default WelcomeHeader;


--- File: ./src/pages/home-dashboard/index.jsx ---

// src/pages/home-dashboard/index.jsx
import React, { useState, useEffect, useMemo } from 'react';
import { Helmet } from 'react-helmet';
import { useGetFarmTasksQuery } from '../../services/farmTasksApi';
import { useGetAlertsQuery } from '../../services/alertsApi';
import WelcomeHeader from './components/WelcomeHeader';
import NavigationCard from './components/NavigationCard';
import CommunityAlertSnippet from './components/CommunityAlertSnippet';
import QuickActions from './components/QuickActions';
import LoadingOverlay from '../../components/ui/LoadingOverlay';
import OfflineStatusBanner from '../../components/ui/OfflineStatusBanner';
import BottomNavigation from '../../components/ui/BottomNavigation';
import DesktopTopNav from '../../components/layout/DesktopTopNav';
import Icon from '../../components/AppIcon';

// --- util jarak (km)
const haversineKm = (a, b) => {
  const R = 6371;
  const dLat = (b.lat - a.lat) * Math.PI / 180;
  const dLng = (b.lng - a.lng) * Math.PI / 180;
  const la1 = a.lat * Math.PI / 180;
  const la2 = b.lat * Math.PI / 180;
  const x = Math.sin(dLat/2)**2 + Math.cos(la1)*Math.cos(la2)*Math.sin(dLng/2)**2;
  return 2 * R * Math.asin(Math.sqrt(x));
};

export default function HomeDashboard() {
  const [isLoading, setIsLoading] = useState(true);
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [pendingSyncCount, setPendingSyncCount] = useState(0);
  const [userPos, setUserPos] = useState(null);

  // Events hari ini (widget tugas)
  const start = new Date(); start.setHours(0,0,0,0);
  const end   = new Date(); end.setHours(23,59,59,999);
  const { data: eventsToday = [] } = useGetFarmTasksQuery({ from: start.toISOString(), to: end.toISOString() });


  // Alerts untuk Nearby
  const { data: alertsRaw = [] } = useGetAlertsQuery(undefined, { skip: !isOnline });

  useEffect(() => {
    if (!navigator.geolocation) return;
    navigator.geolocation.getCurrentPosition(
      (pos) => setUserPos({ lat: pos.coords.latitude, lng: pos.coords.longitude }),
      ()    => setUserPos(null),
      { enableHighAccuracy: true, maximumAge: 60000, timeout: 8000 }
    );
  }, []);

  const nearby3km = useMemo(() => {
    if (!userPos) return [];
    return (alertsRaw || [])
      .map((a) => {
        let coords = a.coordinates;
        if (coords && typeof coords === 'string') { try { coords = JSON.parse(coords); } catch { coords = null; } }
        if (!coords?.lat || !coords?.lng) return null;
        return { ...a, distance: haversineKm(userPos, coords) };
      })
      .filter(Boolean)
      .filter((a) => a.distance <= 3)
      .sort((a, b) => a.distance - b.distance)
      .slice(0, 3);
  }, [alertsRaw, userPos]);

  const navigationOptions = [
    { title: 'Ambil/Upload Foto', description: 'Diagnosis tanaman dengan AI untuk deteksi hama dan penyakit', iconName: 'Camera',   route: '/photo-diagnosis',  variant: 'camera' },
    { title: 'Kalender Tanam',    description: 'Jadwal tanam, pupuk, semprot, dan panen untuk semua lahan',  iconName: 'Calendar', route: '/farming-calendar', variant: 'calendar' },
    { title: 'Peringatan Hama',   description: 'Alert komunitas dan laporan hama terbaru di sekitar Anda',    iconName: 'AlertTriangle', route: '/community-alerts', variant: 'alerts' },
    { title: 'Riwayat Diagnosis', description: 'Lihat semua hasil analisis AI yang telah Anda simpan',       iconName: 'History',  route: '/diagnosis-history', variant: 'history' },
  ];

  useEffect(() => {
    const onl = () => setIsOnline(true);
    const off = () => setIsOnline(false);
    window.addEventListener('online', onl);
    window.addEventListener('offline', off);
    return () => {
      window.removeEventListener('online', onl);
      window.removeEventListener('offline', off);
    };
  }, []);
  useEffect(() => {
    const t = setTimeout(() => setIsLoading(false), 600);
    return () => clearTimeout(t);
  }, []);
  useEffect(() => { setPendingSyncCount(isOnline ? 0 : 3); }, [isOnline]);

  const handleRetrySync = () => {
    setIsLoading(true);
    setTimeout(() => { setPendingSyncCount(0); setIsLoading(false); }, 800);
  };

  // Olah tugas hari ini
  const todoToday = useMemo(() => {
    const items = Array.isArray(eventsToday) ? eventsToday : [];
    const pending = items.filter((e) => (e.status || '').toLowerCase() !== 'completed');
    return {
      count: pending.length,
      top: pending.sort((a,b) => new Date(a.start_at) - new Date(b.start_at)).slice(0, 3),
    };
  }, [eventsToday]);

  return (
    <>
      <Helmet>
        <title>Dashboard - AI Tani Kupang</title>
        <meta name="description" content="Dashboard utama AI Tani Kupang untuk diagnosis tanaman, kalender pertanian, dan peringatan komunitas" />
      </Helmet>

      <div className="min-h-screen bg-background">
        {/* NAV DESKTOP */}
        <div className="hidden md:block">
          <DesktopTopNav />
        </div>

        <OfflineStatusBanner
          isOnline={isOnline}
          pendingSyncCount={pendingSyncCount}
          onRetrySync={handleRetrySync}
        />

        {/* ====== CONTAINER UTAMA ====== */}
        <div className="mx-auto w-full max-w-screen-xl px-4 md:px-6 lg:px-8 py-6 md:py-8">
          {/* Hero */}
          <div className="mb-6 md:mb-8">
            <WelcomeHeader />
          </div>

          {/* Grid Desktop: 8 / 4 */}
          <div className="grid grid-cols-1 md:grid-cols-12 gap-6">
            {/* KIRI: Fitur Utama */}
            <section className="md:col-span-8 space-y-5">
              <header>
                <h2 className="text-lg font-semibold text-foreground mb-1">Fitur Utama</h2>
                <p className="text-sm text-muted-foreground">Pilih fitur yang ingin Anda gunakan</p>
              </header>

              {/* Grid kartu fitur â€” rata & tinggi seragam */}
              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 auto-rows-[1fr]">
                {navigationOptions.map((option, i) => (
                  <div key={i} className="h-full">
                    <NavigationCard
                      title={option.title}
                      description={option.description}
                      iconName={option.iconName}
                      route={option.route}
                      variant={option.variant}
                    />
                  </div>
                ))}
              </div>

              {/* Peringatan Komunitas ringkas di area kiri biar â€˜terisiâ€™ */}
              <div className="bg-card border border-border rounded-2xl p-6">
                <div className="mb-3 flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <Icon name="AlertTriangle" size={18} className="text-warning" />
                    <h3 className="text-sm font-semibold">Peringatan Komunitas</h3>
                  </div>
                  <a href="/community-alerts" className="text-xs font-medium text-primary hover:underline">
                    Lihat semua â†’
                  </a>
                </div>
                <CommunityAlertSnippet />
              </div>
            </section>

            {/* KANAN: Sidebar sticky */}
            <aside className="md:col-span-4">
              <div className="md:sticky md:top-20 space-y-6">
                {/* Widget: Tugas Hari Ini */}
                <div className="bg-card border border-border rounded-2xl p-5">
                  <div className="flex items-center justify-between mb-2">
                    <div className="flex items-center gap-2">
                      <Icon name="Calendar" size={18} className="text-primary" />
                      <h3 className="text-sm font-semibold">Tugas Hari Ini</h3>
                    </div>
                    <span className="text-xs text-muted-foreground">{todoToday.count} kegiatan</span>
                  </div>

                  {todoToday.count === 0 ? (
                    <div className="text-xs text-muted-foreground">Tidak ada tugas. Bagus! ğŸ‰</div>
                  ) : (
                    <ul className="space-y-3">
                      {todoToday.top.map((e) => (
                        <li key={e.id} className="border border-border rounded-lg p-3">
                          <div className="flex items-center justify-between">
                            <div className="font-medium">{e.title}</div>
                            <div
                              className={`text-[10px] px-2 py-0.5 rounded-md border ${
                                (e.status || 'pending') === 'completed'
                                  ? 'bg-success/10 text-success border-success/30'
                                  : 'bg-warning/10 text-warning border-warning/30'
                              }`}
                            >
                              {(e.status || 'pending')}
                            </div>
                          </div>
                          <div className="text-xs text-muted-foreground mt-1">
                            {new Date(e.start_at).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}
                            {e.crop ? ` â€¢ ${e.crop}` : ''}{e.location ? ` â€¢ ${e.location}` : ''}
                          </div>
                        </li>
                      ))}
                    </ul>
                  )}

                  <div className="mt-3 text-right">
                    <a href="/farming-calendar" className="text-xs font-medium text-primary hover:underline">
                      Buka Kalender â†’
                    </a>
                  </div>
                </div>

                {/* Aksi Cepat dalam kartu supaya konsisten */}
                <div className="bg-card border border-border rounded-2xl p-5">
                  <div className="mb-2 flex items-center gap-2">
                    <Icon name="Zap" size={18} className="text-primary" />
                    <h3 className="text-sm font-semibold">Aksi Cepat</h3>
                  </div>
                  <QuickActions />
                </div>

                {/* Nearby Alerts (â‰¤3 km) */}
                <div className="bg-card border border-border rounded-2xl p-5">
                  <div className="flex items-center justify-between mb-2">
                    <div className="flex items-center gap-2">
                      <Icon name="MapPin" size={18} className="text-primary" />
                      <h3 className="text-sm font-semibold">Peringatan â‰¤ 3 km</h3>
                    </div>
                    <span className="text-xs text-muted-foreground">{nearby3km.length}</span>
                  </div>

                  {nearby3km.length === 0 ? (
                    <div className="text-xs text-muted-foreground">Tidak ada yang dekat.</div>
                  ) : (
                    <ul className="space-y-2">
                      {nearby3km.map((a) => (
                        <li key={a.id} className="flex items-center justify-between border border-border rounded-lg px-3 py-2">
                          <div className="flex items-center gap-2">
                            <Icon name="AlertCircle" size={14} className="text-warning" />
                            <span className="text-sm font-medium">
                              {(a.pest_type || a.pestType || 'Hama')}
                            </span>
                          </div>
                          <span className="text-xs text-muted-foreground">{a.distance.toFixed(2)} km</span>
                        </li>
                      ))}
                    </ul>
                  )}

                  <div className="mt-2 text-right">
                    <a href="/community-alerts" className="text-xs font-medium text-primary hover:underline">
                      Lihat semua â†’
                    </a>
                  </div>
                </div>
              </div>
            </aside>
          </div>

          {/* Footer kecil */}
          <div className="text-center py-8">
            <p className="text-xs text-muted-foreground">AI Tani Kupang v1.0 â€¢ Dikembangkan untuk Petani Indonesia</p>
            <p className="text-xs text-muted-foreground mt-1">Â© {new Date().getFullYear()} - Semua hak dilindungi</p>
          </div>
        </div>

        {/* NAV MOBILE */}
        <div className="md:hidden">
          <BottomNavigation />
        </div>

        <LoadingOverlay isVisible={isLoading} message="Memuat dashboard..." animationType="plant" />
      </div>
    </>
  );
}



--- File: ./src/pages/login/index.jsx ---

// src/pages/login/index.jsx

import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useDispatch } from 'react-redux'; // <-- 1. Impor useDispatch
import { setCredentials } from '../../services/authSlice'; // <-- 2. Impor "instruksi" kita
import Icon from '../../components/AppIcon';
import Button from '../../components/ui/Button';
import Input from '../../components/ui/Input';
import { useLoginMutation } from '../../services/authApi'; 

const LoginPage = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState(null);
  const navigate = useNavigate();
  const dispatch = useDispatch(); // <-- 3. Siapkan alat untuk "menekan tombol"

  const [login, { isLoading }] = useLoginMutation();

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError(null);

    try {
      const result = await login({ email, password }).unwrap();
      
      // 4. SETELAH LOGIN BERHASIL, "TEKAN TOMBOL" setCredentials
      // Kirim data user dan token yang kita dapat dari API.
      dispatch(setCredentials({ user: result.user, token: result.token }));
      
      // Arahkan pengguna ke halaman utama
      navigate('/home-dashboard');

    } catch (err) {
      const errorMessage = err.data?.error || 'Terjadi kesalahan. Silakan coba lagi.';
      setError(errorMessage);
    }
  };

  // ... (sisa kode JSX untuk tampilan form tetap sama persis)
  return (
    <div className="min-h-screen flex items-center justify-center bg-background p-4">
      <div className="w-full max-w-md">
        <div className="text-center mb-8">
          <Icon name="Leaf" size={48} className="text-primary mx-auto mb-4" />
          <h1 className="text-3xl font-bold text-foreground">Selamat Datang Kembali</h1>
          <p className="text-muted-foreground">Silakan masuk ke akun AI Tani Kupang Anda.</p>
        </div>

        <div className="bg-card p-8 rounded-2xl border border-border shadow-lg">
          <form onSubmit={handleSubmit} className="space-y-6">
            <Input
              label="Alamat Email" id="email" type="email" placeholder="contoh@email.com"
              value={email} onChange={(e) => setEmail(e.target.value)}
              required disabled={isLoading}
            />
            <Input
              label="Password" id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              value={password} onChange={(e) => setPassword(e.target.value)}
              required disabled={isLoading}
            />

            {error && (
              <div className="text-sm text-center text-destructive bg-destructive/10 p-3 rounded-md">
                {error}
              </div>
            )}

            <Button type="submit" fullWidth loading={isLoading} iconName="LogIn" iconPosition="left" disabled={isLoading}>
              {isLoading ? 'Memverifikasi...' : 'Masuk'}
            </Button>
          </form>

          <div className="mt-6 text-center">
            <p className="text-sm text-muted-foreground">
              Belum punya akun?{' '}
              <span onClick={() => navigate('/register')} className="font-semibold text-primary hover:underline cursor-pointer">
                Daftar di sini
              </span>
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default LoginPage;


--- File: ./src/pages/photo-diagnosis/components/CameraInterface.jsx ---

import React, { useState, useRef, useEffect } from 'react';
import Icon from '../../../components/AppIcon';
import Image from '../../../components/AppImage';
import Button from '../../../components/ui/Button';

const CameraInterface = ({ 
  onImageCapture, 
  capturedImage, 
  onImageRemove,
  isLoading = false 
}) => {
  const [cameraStream, setCameraStream] = useState(null);
  const [isCameraActive, setIsCameraActive] = useState(false);
  const [cameraError, setCameraError] = useState(null);
  const videoRef = useRef(null);
  const canvasRef = useRef(null);
  const fileInputRef = useRef(null);

  useEffect(() => {
    return () => {
      if (cameraStream) {
        cameraStream?.getTracks()?.forEach(track => track?.stop());
      }
    };
  }, [cameraStream]);

  const startCamera = async () => {
    try {
      setCameraError(null);
      const stream = await navigator.mediaDevices?.getUserMedia({
        video: { 
          facingMode: 'environment',
          width: { ideal: 1280 },
          height: { ideal: 720 }
        }
      });
      
      setCameraStream(stream);
      setIsCameraActive(true);
      
      if (videoRef?.current) {
        videoRef.current.srcObject = stream;
      }
    } catch (error) {
      setCameraError('Tidak dapat mengakses kamera. Pastikan izin kamera telah diberikan.');
      console.error('Camera access error:', error);
    }
  };

  const stopCamera = () => {
    if (cameraStream) {
      cameraStream?.getTracks()?.forEach(track => track?.stop());
      setCameraStream(null);
      setIsCameraActive(false);
    }
  };

  const capturePhoto = () => {
    if (!videoRef?.current || !canvasRef?.current) return;

    const video = videoRef?.current;
    const canvas = canvasRef?.current;
    const context = canvas?.getContext('2d');

    canvas.width = video?.videoWidth;
    canvas.height = video?.videoHeight;
    
    context?.drawImage(video, 0, 0, canvas?.width, canvas?.height);
    
    canvas?.toBlob((blob) => {
      if (blob) {
        const file = new File([blob], `diagnosis_${Date.now()}.jpg`, {
          type: 'image/jpeg'
        });
        onImageCapture(file);
        stopCamera();
      }
    }, 'image/jpeg', 0.8);
  };

  const handleFileSelect = async (event) => {
    const file = event?.target?.files?.[0];
    if (file && file?.type?.startsWith('image/')) {
      try {
        const { compressImage } = await import('../../../ai/localDiagnosis');
        const compressed = await compressImage(file, 0.8);
        onImageCapture(compressed || file);
      } catch {
        onImageCapture(file);
      }
    }
  };

  const triggerFileSelect = () => {
    fileInputRef?.current?.click();
  };

  if (capturedImage) {
    return (
      <div className="bg-card rounded-lg border border-border overflow-hidden">
        <div className="relative">
          <Image
            src={URL.createObjectURL(capturedImage)}
            alt="Foto tanaman yang akan didiagnosis"
            className="w-full h-64 object-cover"
          />
          <div className="absolute top-4 right-4">
            <Button
              variant="destructive"
              size="icon"
              onClick={onImageRemove}
              disabled={isLoading}
              iconName="X"
              className="bg-error/80 hover:bg-error"
            />
          </div>
        </div>
        <div className="p-4 bg-muted/50">
          <div className="flex items-center space-x-2">
            <Icon name="CheckCircle" size={16} className="text-success" />
            <span className="text-sm text-muted-foreground">
              Foto siap untuk dianalisis
            </span>
          </div>
          <p className="text-xs text-muted-foreground mt-1">
            Ukuran: {(capturedImage?.size / 1024 / 1024)?.toFixed(2)} MB
          </p>
        </div>
      </div>
    );
  }

  if (isCameraActive) {
    return (
      <div className="bg-card rounded-lg border border-border overflow-hidden">
        <div className="relative">
          <video
            ref={videoRef}
            autoPlay
            playsInline
            muted
            className="w-full h-64 object-cover bg-muted"
          />
          
          <div className="absolute inset-0 flex items-center justify-center">
            <div className="relative w-48 h-48 border-2 border-primary/50 rounded-lg overflow-hidden">
              {/* scanning line */}
              <div className="absolute left-0 right-0 h-0.5 bg-primary/70 animate-[scan_2.2s_linear_infinite]" style={{ top: 0 }} />
            </div>
          </div>
          
          <div className="absolute top-4 right-4">
            <Button
              variant="ghost"
              size="icon"
              onClick={stopCamera}
              className="bg-black/50 text-white hover:bg-black/70"
              iconName="X"
            />
          </div>
        </div>
        
        <div className="p-4 bg-muted/50">
          <div className="flex items-center justify-center space-x-4">
            <Button
              variant="default"
              onClick={capturePhoto}
              iconName="Camera"
              iconPosition="left"
              className="flex-1"
            >
              Ambil Foto
            </Button>
          </div>
          <p className="text-xs text-center text-muted-foreground mt-2">
            Posisikan tanaman di dalam kotak untuk hasil terbaik
          </p>
        </div>
        
        <canvas ref={canvasRef} className="hidden" />
      </div>
    );
  }

  return (
    <div className="bg-card rounded-lg border border-border overflow-hidden">
      <div className="p-8 text-center">
        <div className="w-24 h-24 mx-auto mb-6 bg-primary/10 rounded-full flex items-center justify-center">
          <Icon name="Camera" size={32} className="text-primary" />
        </div>
        
        <h3 className="text-lg font-semibold text-foreground mb-2">
          Ambil Foto Tanaman
        </h3>
        <p className="text-sm text-muted-foreground mb-6">
          Foto tanaman yang menunjukkan gejala penyakit atau hama untuk diagnosis AI
        </p>
        
        {cameraError && (
          <div className="mb-4 p-3 bg-error/10 border border-error/20 rounded-lg">
            <div className="flex items-center space-x-2">
              <Icon name="AlertCircle" size={16} className="text-error" />
              <p className="text-sm text-error">{cameraError}</p>
            </div>
          </div>
        )}
        
        <div className="space-y-3">
          <Button
            variant="default"
            fullWidth
            onClick={startCamera}
            iconName="Camera"
            iconPosition="left"
            disabled={isLoading}
          >
            Buka Kamera
          </Button>
          
          <Button
            variant="outline"
            fullWidth
            onClick={triggerFileSelect}
            iconName="Upload"
            iconPosition="left"
            disabled={isLoading}
          >
            Pilih dari Galeri
          </Button>
        </div>
        
        <input
          ref={fileInputRef}
          type="file"
          accept="image/*"
          onChange={handleFileSelect}
          className="hidden"
        />
      </div>
    </div>
  );
};

export default CameraInterface;



--- File: ./src/pages/photo-diagnosis/components/DiagnosisForm.jsx ---

import React, { useState, useEffect } from 'react';
import Icon from '../../../components/AppIcon';
import Button from '../../../components/ui/Button';
import Input from '../../../components/ui/Input';
import Select from '../../../components/ui/Select';

const DiagnosisForm = ({ 
  onSubmit, 
  isLoading = false, 
  hasImage = false 
}) => {
  const [formData, setFormData] = useState({
    field_id: '',
    crop_type: '',
    latitude: '',
    longitude: '',
    notes: ''
  });
  const [locationLoading, setLocationLoading] = useState(false);
  const [locationError, setLocationError] = useState(null);
  const [errors, setErrors] = useState({});

  const cropOptions = [
    { value: 'padi', label: 'Padi' },
    { value: 'jagung', label: 'Jagung' },
    { value: 'kedelai', label: 'Kedelai' },
    { value: 'cabai', label: 'Cabai' },
    { value: 'tomat', label: 'Tomat' },
    { value: 'kentang', label: 'Kentang' },
    { value: 'bawang_merah', label: 'Bawang Merah' },
    { value: 'bawang_putih', label: 'Bawang Putih' },
    { value: 'wortel', label: 'Wortel' },
    { value: 'bayam', label: 'Bayam' },
    { value: 'kangkung', label: 'Kangkung' },
    { value: 'singkong', label: 'Singkong' }
  ];

  useEffect(() => {
    getCurrentLocation();
  }, []);

  const getCurrentLocation = () => {
    if (!navigator.geolocation) {
      setLocationError('Geolokasi tidak didukung di browser ini');
      return;
    }

    setLocationLoading(true);
    setLocationError(null);

    navigator.geolocation?.getCurrentPosition(
      (position) => {
        setFormData(prev => ({
          ...prev,
          latitude: position?.coords?.latitude?.toFixed(6),
          longitude: position?.coords?.longitude?.toFixed(6)
        }));
        setLocationLoading(false);
      },
      (error) => {
        let errorMessage = 'Tidak dapat mendapatkan lokasi';
        switch (error?.code) {
          case error?.PERMISSION_DENIED:
            errorMessage = 'Izin lokasi ditolak. Silakan masukkan koordinat manual.';
            break;
          case error?.POSITION_UNAVAILABLE:
            errorMessage = 'Informasi lokasi tidak tersedia.';
            break;
          case error?.TIMEOUT:
            errorMessage = 'Permintaan lokasi timeout.';
            break;
        }
        setLocationError(errorMessage);
        setLocationLoading(false);
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 300000
      }
    );
  };

  const handleInputChange = (field, value) => {
    setFormData(prev => ({
      ...prev,
      [field]: value
    }));
    
    // Clear error when user starts typing
    if (errors?.[field]) {
      setErrors(prev => ({
        ...prev,
        [field]: null
      }));
    }
  };

  const validateForm = () => {
    const newErrors = {};

    if (!formData?.field_id?.trim()) {
      newErrors.field_id = 'ID Lahan wajib diisi';
    }

    if (!formData?.crop_type) {
      newErrors.crop_type = 'Jenis tanaman wajib dipilih';
    }

    if (!formData?.latitude || !formData?.longitude) {
      newErrors.location = 'Koordinat lokasi wajib diisi';
    }

    setErrors(newErrors);
    return Object.keys(newErrors)?.length === 0;
  };

  const handleSubmit = (e) => {
    e?.preventDefault();
    
    if (!hasImage) {
      alert('Silakan ambil foto tanaman terlebih dahulu');
      return;
    }

    if (validateForm()) {
      const submissionData = {
        ...formData,
        latitude: parseFloat(formData?.latitude),
        longitude: parseFloat(formData?.longitude),
        timestamp: new Date()?.toISOString()
      };
      onSubmit(submissionData);
    }
  };

  return (
    <div className="bg-card rounded-lg border border-border p-6">
      <div className="flex items-center space-x-3 mb-6">
        <div className="w-10 h-10 bg-secondary/10 rounded-lg flex items-center justify-center">
          <Icon name="FileText" size={20} className="text-secondary" />
        </div>
        <div>
          <h3 className="text-lg font-semibold text-foreground">
            Informasi Diagnosis
          </h3>
          <p className="text-sm text-muted-foreground">
            Lengkapi data untuk analisis yang akurat
          </p>
        </div>
      </div>
      <form onSubmit={handleSubmit} className="space-y-6">
        {/* Field ID */}
        <Input
          label="ID Lahan"
          type="text"
          placeholder="Contoh: LAHAN-001"
          value={formData?.field_id}
          onChange={(e) => handleInputChange('field_id', e?.target?.value)}
          error={errors?.field_id}
          required
          description="Kode identifikasi lahan pertanian Anda"
        />

        {/* Crop Type */}
        <Select
          label="Jenis Tanaman"
          placeholder="Pilih jenis tanaman"
          options={cropOptions}
          value={formData?.crop_type}
          onChange={(value) => handleInputChange('crop_type', value)}
          error={errors?.crop_type}
          required
          searchable
          description="Pilih tanaman yang akan didiagnosis"
        />

        {/* Location Section */}
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <label className="text-sm font-medium text-foreground">
              Koordinat Lokasi *
            </label>
            <Button
              type="button"
              variant="outline"
              size="sm"
              onClick={getCurrentLocation}
              loading={locationLoading}
              iconName="MapPin"
              iconPosition="left"
            >
              {locationLoading ? 'Mencari...' : 'Deteksi Otomatis'}
            </Button>
          </div>

          {locationError && (
            <div className="p-3 bg-warning/10 border border-warning/20 rounded-lg">
              <div className="flex items-center space-x-2">
                <Icon name="AlertTriangle" size={16} className="text-warning" />
                <p className="text-sm text-warning">{locationError}</p>
              </div>
            </div>
          )}

          <div className="grid grid-cols-2 gap-4">
            <Input
              label="Latitude"
              type="number"
              step="any"
              placeholder="-10.123456"
              value={formData?.latitude}
              onChange={(e) => handleInputChange('latitude', e?.target?.value)}
              error={errors?.location}
            />
            <Input
              label="Longitude"
              type="number"
              step="any"
              placeholder="123.456789"
              value={formData?.longitude}
              onChange={(e) => handleInputChange('longitude', e?.target?.value)}
              error={errors?.location}
            />
          </div>
        </div>

        {/* Notes */}
        <div>
          <label className="block text-sm font-medium text-foreground mb-2">
            Catatan Tambahan
          </label>
          <textarea
            placeholder="Deskripsikan gejala yang terlihat pada tanaman..."
            value={formData?.notes}
            onChange={(e) => handleInputChange('notes', e?.target?.value)}
            rows={3}
            className="w-full px-3 py-2 border border-border rounded-lg bg-input text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent resize-none"
          />
          <p className="text-xs text-muted-foreground mt-1">
            Opsional: Informasi tambahan untuk diagnosis yang lebih akurat
          </p>
        </div>

        {/* Submit Button */}
        <div className="pt-4 border-t border-border">
          <Button
            type="submit"
            variant="default"
            fullWidth
            loading={isLoading}
            iconName="Zap"
            iconPosition="left"
            disabled={!hasImage}
          >
            {isLoading ? 'Menganalisis...' : 'Mulai Diagnosis AI'}
          </Button>
          
          {!hasImage && (
            <p className="text-xs text-center text-muted-foreground mt-2">
              Ambil foto tanaman terlebih dahulu untuk melanjutkan
            </p>
          )}
        </div>
      </form>
    </div>
  );
};

export default DiagnosisForm;


--- File: ./src/pages/photo-diagnosis/components/DiagnosisResults.jsx ---

// src/pages/photo-diagnosis/components/DiagnosisResults.jsx

import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
// [PERBAIKAN KUNCI] Impor dan gunakan nama hook yang benar
import { useCreateFarmTaskMutation } from '../../../services/farmTasksApi'; 
import { enqueueRequest } from '../../../offline/queueService';
import Icon from '../../../components/AppIcon';
import Image from '../../../components/AppImage';
import Button from '../../../components/ui/Button';
import ShareActionSheet from '../../../components/ui/ShareActionSheet';

const DiagnosisResults = ({ 
  results, 
  image, 
  formData, 
  onStartNew 
}) => {
  const navigate = useNavigate();
  const [showShareSheet, setShowShareSheet] = useState(false);
  
  // [PERBAIKAN KUNCI] Panggil hook dengan nama yang benar
  const [createEvent, { isLoading: isSaving }] = useCreateFarmTaskMutation();

  const getSeverityColor = (severity) => {
    switch (severity?.toLowerCase()) {
      case 'ringan': return 'text-success bg-success/10 border-success/20';
      case 'sedang': return 'text-warning bg-warning/10 border-warning/20';
      case 'berat': return 'text-error bg-error/10 border-error/20';
      default: return 'text-muted-foreground bg-muted/10 border-border';
    }
  };

  const getPriorityIcon = (priority) => {
    switch (priority?.toLowerCase()) {
      case 'tinggi': return { icon: 'AlertTriangle', color: 'text-error' };
      case 'sedang': return { icon: 'AlertCircle', color: 'text-warning' };
      case 'rendah': return { icon: 'Info', color: 'text-secondary' };
      default: return { icon: 'Info', color: 'text-muted-foreground' };
    }
  };

  const handleSaveAllPlans = async () => {
    if (!results?.recommendations || results.recommendations.length === 0) {
      alert("Tidak ada rekomendasi untuk disimpan.");
      return;
    }

    const plansToSave = results.recommendations.map(rec => {
      const date = new Date().toISOString().split('T')[0];
      const hhmm = /^\d{1,2}:\d{2}$/;
      const time = hhmm.test(rec.timeframe || '') ? rec.timeframe : undefined;

      return {
        id: `plan_${Date.now()}_${rec.id}`,
        date,
        title: rec.title,
        type: 'semprot',
        crop: formData.crop_type || "Unknown",
        ...(time ? { time } : {}),
        location: formData.field_id || 'Lahan Utama',
        completed: false,
        notes: [rec.description, `Prioritas: ${rec.priority}`],
        createdAt: new Date().toISOString(),
        // [PENYEMPURNAAN] Pastikan tipe 'createEvent' tetap sama untuk offline queue
        typeForQueue: 'createEvent' 
      };
    });

    try {
      // [PENYEMPURNAAN] Di sini kita menggunakan 'createEvent' yang merupakan alias dari 'useCreateFarmTaskMutation'
      await Promise.all(plansToSave.map(plan => createEvent(plan).unwrap()));
      navigate('/farming-calendar', { 
        state: { message: `${plansToSave.length} rencana baru berhasil disimpan!` }
      });
    } catch (error) {
      console.error('Gagal menyimpan rencana, menyimpan ke antrean:', error);
      for (const plan of plansToSave) {
        // [PENYEMPURNAAN] Pastikan tipe yang dikirim ke offline queue tetap 'createEvent'
        await enqueueRequest({ type: 'createEvent', payload: plan });
      }
      alert(`Anda sedang offline. ${plansToSave.length} rencana disimpan dan akan disinkronkan.`);
      navigate('/farming-calendar');
    }
  };

  const shareData = {
    title: `Diagnosis AI: ${results?.diagnosis?.label}`,
    description: `Akurasi: ${results?.diagnosis?.confidence}% | Keparahan: ${results?.diagnosis?.severity}`,
    results: [{ name: results?.diagnosis?.label, confidence: results?.diagnosis?.confidence }],
    timestamp: new Date().toISOString()
  };

  return (
    <div className="space-y-6">
      {/* Sisa dari JSX tidak ada perubahan dan tetap sama persis */}
      {/* Header */}
      <div className="bg-card rounded-lg border border-border p-6">
        <div className="flex items-center space-x-3 mb-4">
          <div className="w-12 h-12 bg-success/10 rounded-lg flex items-center justify-center">
            <Icon name="CheckCircle" size={24} className="text-success" />
          </div>
          <div>
            <h2 className="text-xl font-bold text-foreground">Diagnosis Selesai</h2>
            <p className="text-sm text-muted-foreground">Analisis AI berhasil dilakukan</p>
          </div>
        </div>
        {image && (
          <div className="mb-4">
            <Image
              src={URL.createObjectURL(image)}
              alt="Foto tanaman yang didiagnosis"
              className="w-full h-48 object-cover rounded-lg border border-border"
            />
          </div>
        )}
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <h3 className="text-lg font-semibold text-foreground">{results?.diagnosis?.label}</h3>
            <div className={`px-3 py-1 rounded-full text-xs font-medium border ${getSeverityColor(results?.diagnosis?.severity)}`}>
              {results?.diagnosis?.severity?.toUpperCase()}
            </div>
          </div>
          <div className="flex items-center space-x-4">
            <div className="flex items-center space-x-2">
              <Icon name="Target" size={16} className="text-primary" />
              <span className="text-sm text-muted-foreground">Akurasi: {results?.diagnosis?.confidence}%</span>
            </div>
            <div className="flex items-center space-x-2">
              <Icon name="MapPin" size={16} className="text-secondary" />
              <span className="text-sm text-muted-foreground">{formData?.field_id || 'Lahan'}</span>
            </div>
          </div>
          <p className="text-sm text-muted-foreground">{results?.diagnosis?.description}</p>
        </div>
      </div>
      
      {/* Recommendations */}
      <div className="bg-card rounded-lg border border-border p-6">
        <div className="flex items-center space-x-3 mb-6">
          <div className="w-10 h-10 bg-accent/10 rounded-lg flex items-center justify-center">
            <Icon name="Lightbulb" size={20} className="text-accent" />
          </div>
          <div>
            <h3 className="text-lg font-semibold text-foreground">Rekomendasi Tindakan</h3>
            <p className="text-sm text-muted-foreground">Langkah-langkah untuk mengatasi masalah</p>
          </div>
        </div>
        <div className="space-y-4">
          {results?.recommendations?.map((recommendation, index) => {
            const priorityInfo = getPriorityIcon(recommendation.priority);
            return (
              <div key={recommendation.id} className="border border-border rounded-lg p-4">
                <div className="flex items-start space-x-3">
                  <div className="w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0 mt-1">
                    <span className="text-sm font-semibold text-primary">{index + 1}</span>
                  </div>
                  <div className="flex-1">
                    <div className="flex items-center space-x-2 mb-2">
                      <h4 className="font-medium text-foreground">{recommendation.title}</h4>
                      <Icon name={priorityInfo.icon} size={16} className={priorityInfo.color} />
                    </div>
                    <p className="text-sm text-muted-foreground mb-3">{recommendation.description}</p>
                    <div className="flex items-center space-x-4 text-xs text-muted-foreground">
                      <span>Prioritas: {recommendation.priority}</span>
                      <span>â€¢</span>
                      <span>Waktu: {recommendation.timeframe}</span>
                    </div>
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>

      {/* Action Buttons */}
      <div className="space-y-3">
        <div className="flex flex-col gap-3">
          <Button
            variant="default"
            onClick={handleSaveAllPlans}
            loading={isSaving}
            iconName="Save"
            iconPosition="left"
          >
            Simpan Rencana
          </Button>
          <Button variant="outline" onClick={() => setShowShareSheet(true)} iconName="Share" iconPosition="left">
            Bagikan
          </Button>
        </div>
        <Button variant="secondary" fullWidth onClick={onStartNew} iconName="Camera" iconPosition="left">
          Diagnosis Baru
        </Button>
        <Button variant="ghost" fullWidth onClick={() => navigate('/home-dashboard')} iconName="Home" iconPosition="left">
          Kembali ke Beranda
        </Button>
      </div>

      <ShareActionSheet
        isOpen={showShareSheet}
        onClose={() => setShowShareSheet(false)}
        shareData={shareData}
      />
    </div>
  );
};

export default DiagnosisResults;


--- File: ./src/pages/photo-diagnosis/index.jsx ---

// src/pages/photo-diagnosis/index.jsx

import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useCreateDiagnosisMutation } from '../../services/diagnosisApi';
import { runLocalDiagnosis } from '../../ai/localDiagnosis';
import { enqueueRequest } from '../../offline/queueService';
import Icon from '../../components/AppIcon';
import Button from '../../components/ui/Button';
import LoadingOverlay from '../../components/ui/LoadingOverlay';
import OfflineStatusBanner from '../../components/ui/OfflineStatusBanner';
import BottomNavigation from '../../components/ui/BottomNavigation';
import CameraInterface from './components/CameraInterface';
import DiagnosisForm from './components/DiagnosisForm';
import DiagnosisResults from './components/DiagnosisResults';
import DesktopTopNav from '../../components/layout/DesktopTopNav';

const fileToDataURL = (file) =>
  new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });

const PhotoDiagnosis = () => {
  const navigate = useNavigate();
  const [currentStep, setCurrentStep] = useState('capture');
  const [capturedImage, setCapturedImage] = useState(null);
  const [formData, setFormData] = useState(null);
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [diagnosisResult, setDiagnosisResult] = useState(null);
  
  // [PERBAIKAN #1] Kita akan menggunakan state lokal untuk mengontrol loading overlay
  const [isProcessing, setIsProcessing] = useState(false);

  const [createDiagnosis, { isLoading: isUploading }] = useCreateDiagnosisMutation();

  useEffect(() => {
    const handleOnline = () => setIsOnline(true);
    const handleOffline = () => setIsOnline(false);
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  const handleImageCapture = (imageFile) => {
    setCapturedImage(imageFile);
    setCurrentStep('form');
  };

  const handleImageRemove = () => {
    setCapturedImage(null);
    setCurrentStep('capture');
  };

  const handleFormSubmit = async (data) => {
    // [PERBAIKAN #2] Tampilkan loading overlay SEGERA
    setIsProcessing(true);
    setFormData(data);
    const submissionData = { ...data, photo: capturedImage };

    // Jalankan diagnosis lokal dan pengiriman ke server secara bersamaan
    // untuk memberikan kesan responsif sambil tetap mengirim data.
    const localDiagnosisPromise = runLocalDiagnosis(capturedImage).catch(e => {
      console.warn('Local diagnosis failed, will rely on server:', e?.message || e);
      return null; // Jangan sampai promise ini gagal dan menghentikan alur
    });
    
    const serverDiagnosisPromise = createDiagnosis(submissionData).unwrap().catch(async (error) => {
      console.error('Gagal mengirim diagnosis, menyimpan ke antrean:', error);
      const offlinePayload = { ...submissionData };

      if (submissionData.photo instanceof File) {
        try {
          offlinePayload.photo = await fileToDataURL(submissionData.photo);
          offlinePayload.photoName = submissionData.photo.name;
        } catch (fileError) {
          console.error('Gagal mengubah file ke Data URL:', fileError);
          offlinePayload.photo = null;
        }
      }
      await enqueueRequest({ type: 'createDiagnosis', payload: offlinePayload });
      return null; // Jangan sampai promise ini gagal
    });

    // Tunggu keduanya selesai
    const [localResult, serverResult] = await Promise.all([localDiagnosisPromise, serverDiagnosisPromise]);

    // Prioritaskan hasil dari server jika ada, jika tidak gunakan hasil lokal
    const finalResult = serverResult?.success ? serverResult : localResult;
    
    setDiagnosisResult(finalResult);
    setCurrentStep('results');
    
    // [PERBAIKAN #3] Sembunyikan loading overlay setelah semuanya selesai
    setIsProcessing(false);
  };

  const handleStartNew = () => {
    setCapturedImage(null);
    setFormData(null);
    setDiagnosisResult(null);
    setCurrentStep('capture');
  };

  // ... (renderStepIndicator tetap sama) ...
  const renderStepIndicator = () => {
    const steps = [
      { id: 'capture', label: 'Foto', icon: 'Camera' },
      { id: 'form', label: 'Data', icon: 'FileText' },
      { id: 'results', label: 'Hasil', icon: 'CheckCircle' },
    ];
    const currentStepIndex = steps.findIndex((s) => s.id === currentStep);

    return (
      <div className="flex items-center w-full mb-8">
        {steps.map((step, index) => (
          <React.Fragment key={step.id}>
            <div className="flex flex-col items-center">
              <div
                className={`
                  w-10 h-10 rounded-full flex items-center justify-center border-2 transition-all duration-300
                  ${
                    currentStepIndex === index
                      ? 'bg-primary border-primary text-primary-foreground ring-4 ring-primary/20'
                      : currentStepIndex > index
                      ? 'bg-success border-success text-success-foreground'
                      : 'bg-muted border-border text-muted-foreground'
                  }
                `}
              >
                <Icon name={currentStepIndex > index ? 'Check' : step.icon} size={20} />
              </div>
              <p
                className={`
                  mt-2 text-xs font-medium transition-colors
                  ${currentStepIndex >= index ? 'text-foreground' : 'text-muted-foreground'}
                `}
              >
                {step.label}
              </p>
            </div>
            {index < steps.length - 1 && (
              <div
                className={`
                  flex-1 h-1 mx-2 transition-all duration-500 rounded-full
                  ${currentStepIndex > index ? 'bg-success' : 'bg-border'}
                `}
              />
            )}
          </React.Fragment>
        ))}
      </div>
    );
  };
  
  // [PERBAIKAN #4] Gunakan isProcessing (state lokal) untuk loading di form
  const renderCurrentStep = () => {
    switch (currentStep) {
      case 'capture':
        return (
          <CameraInterface
            onImageCapture={handleImageCapture}
            capturedImage={capturedImage}
            onImageRemove={handleImageRemove}
            isLoading={isProcessing}
          />
        );
      case 'form':
        return <DiagnosisForm onSubmit={handleFormSubmit} isLoading={isProcessing} hasImage={!!capturedImage} />;
      case 'results':
        return (
          <DiagnosisResults
            results={diagnosisResult}
            image={capturedImage}
            formData={formData}
            onStartNew={handleStartNew}
          />
        );
      default:
        return null;
    }
  };

  return (
    <div className="min-h-screen bg-background">
      {/* ... (sisa JSX tetap sama) ... */}
            <div className="hidden md:block">
        <DesktopTopNav />
      </div>

      <div className="mx-auto w-full max-w-screen-xl px-4 md:px-6 lg:px-8">
        <OfflineStatusBanner isOnline={isOnline} />

        {/* HEADER DALAM CONTAINER (punya batas kiri/kanan) */}
        <div className="bg-card border-b border-border sticky top-0 z-30">
          <div className="px-0 md:px-2 lg:px-4 py-4 md:py-6">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <Button
                  variant="ghost"
                  size="icon"
                  onClick={() => navigate('/home-dashboard')}
                  iconName="ArrowLeft"
                />
                <div>
                  <h1 className="text-lg md:text-2xl font-semibold md:font-bold text-foreground">Diagnosis AI</h1>
                  <p className="text-sm text-muted-foreground">Analisis penyakit tanaman dengan AI</p>
                </div>
              </div>
              <div className="hidden md:flex items-center gap-2">
                <div className={`w-2 h-2 rounded-full ${isOnline ? 'bg-success animate-pulse' : 'bg-warning'}`} />
                <span className="text-xs text-muted-foreground">{isOnline ? 'Online' : 'Offline'}</span>
              </div>
            </div>
          </div>
        </div>

        {/* BODY */}
        <div className="py-6 pb-24">
          {renderStepIndicator()}
          {renderCurrentStep()}

          {currentStep === 'capture' && (
            <div className="mt-8 bg-secondary/5 rounded-lg p-4 border border-secondary/10">
              <div className="flex items-start gap-3">
                <Icon name="HelpCircle" size={20} className="text-secondary mt-0.5" />
                <div>
                  <h4 className="font-medium text-foreground mb-2">Tips Foto yang Baik</h4>
                  <ul className="text-sm text-muted-foreground space-y-1">
                    <li>â€¢ Pastikan pencahayaan cukup terang</li>
                    <li>â€¢ Fokuskan pada bagian tanaman yang bermasalah</li>
                    <li>â€¢ Hindari bayangan yang menutupi objek</li>
                    <li>â€¢ Ambil foto dari jarak 20â€“30 cm</li>
                  </ul>
                </div>
              </div>
            </div>
          )}
        </div>

        {/* NAV MOBILE */}
        <div className="md:hidden">
          <BottomNavigation />
        </div>
      </div>
      
      {/* [PERBAIKAN #5] Gunakan isProcessing untuk mengontrol LoadingOverlay */}
      <LoadingOverlay isVisible={isProcessing} message="Menganalisis foto tanaman..." animationType="camera" />
    </div>
  );
};

export default PhotoDiagnosis;


--- File: ./src/pages/register/index.jsx ---

// src/pages/register/index.jsx

import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import Icon from '../../components/AppIcon';
import Button from '../../components/ui/Button';
import Input from '../../components/ui/Input';
// BARU: Impor hook registrasi
import { useRegisterMutation } from '../../services/authApi';

const RegisterPage = () => {
  const [fullName, setFullName] = useState('');
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState(null);
  const navigate = useNavigate();

  // BARU: Panggil hook useRegisterMutation
  const [register, { isLoading }] = useRegisterMutation();

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError(null);

    if (password.length < 6) {
        setError('Password minimal harus 6 karakter.');
        return;
    }

    try {
      // BARU: Panggil fungsi 'register' dengan data dari form
      await register({ fullName, email, password }).unwrap();
      
      // Jika berhasil, beri tahu pengguna dan arahkan ke halaman login
      alert('Registrasi berhasil! Silakan masuk dengan akun baru Anda.');
      navigate('/login');

    } catch (err) {
      // BARU: Tangani error dari API
      const errorMessage = err.data?.error || 'Terjadi kesalahan saat registrasi.';
      setError(errorMessage);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-background p-4">
      <div className="w-full max-w-md">
        <div className="text-center mb-8">
          <Icon name="Leaf" size={48} className="text-primary mx-auto mb-4" />
          <h1 className="text-3xl font-bold text-foreground">Buat Akun Baru</h1>
          <p className="text-muted-foreground">Bergabunglah dengan komunitas AI Tani Kupang.</p>
        </div>

        <div className="bg-card p-8 rounded-2xl border border-border shadow-lg">
          <form onSubmit={handleSubmit} className="space-y-6">
            <Input
              label="Nama Lengkap" id="fullName" type="text" placeholder="Contoh: Bapak Yosef"
              value={fullName} onChange={(e) => setFullName(e.target.value)}
              required disabled={isLoading}
            />
            <Input
              label="Alamat Email" id="email" type="email" placeholder="contoh@email.com"
              value={email} onChange={(e) => setEmail(e.target.value)}
              required disabled={isLoading}
            />
            <Input
              label="Password" id="password" type="password" placeholder="Minimal 6 karakter"
              value={password} onChange={(e) => setPassword(e.target.value)}
              required disabled={isLoading}
            />

            {error && (
              <div className="text-sm text-center text-destructive bg-destructive/10 p-3 rounded-md">
                {error}
              </div>
            )}

            <Button
              type="submit" fullWidth loading={isLoading} iconName="UserPlus" iconPosition="left"
              disabled={isLoading}
            >
              {isLoading ? 'Mendaftarkan...' : 'Daftar'}
            </Button>
          </form>

          <div className="mt-6 text-center">
            <p className="text-sm text-muted-foreground">
              Sudah punya akun?{' '}
              <span onClick={() => navigate('/login')} className="font-semibold text-primary hover:underline cursor-pointer">
                Masuk di sini
              </span>
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default RegisterPage;


--- File: ./src/pages/reset-password/index.jsx ---

// src/pages/reset-password/index.jsx

import React, { useState, useEffect } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import Icon from '../../components/AppIcon';
import Button from '../../components/ui/Button';
import Input from '../../components/ui/Input';
import { useResetPasswordMutation } from '../../services/authApi';

const ResetPasswordPage = () => {
    const [password, setPassword] = useState('');
    const [confirmPassword, setConfirmPassword] = useState('');
    const [error, setError] = useState(null);
    const [isSuccess, setIsSuccess] = useState(false);
    
    const [searchParams] = useSearchParams();
    const navigate = useNavigate();
    
    const token = searchParams.get('token');

    const [resetPassword, { isLoading }] = useResetPasswordMutation();

    useEffect(() => {
        if (!token) {
            setError("Token reset tidak valid atau tidak ditemukan. Silakan coba minta reset lagi.");
        }
    }, [token]);

    const handleSubmit = async (e) => {
        e.preventDefault();
        
        if (password !== confirmPassword) {
            setError("Password dan konfirmasi password tidak cocok.");
            return;
        }
        if (password.length < 6) {
            setError("Password minimal harus 6 karakter.");
            return;
        }
        if (!token) {
            setError("Token tidak ditemukan. Proses reset tidak dapat dilanjutkan.");
            return;
        }
        
        setError(null);

        try {
            await resetPassword({ token, password }).unwrap();
            setIsSuccess(true);
            
        } catch (err) {
            const errorMessage = err.data?.error || "Gagal mengatur password. Token mungkin sudah kedaluwarsa atau tidak valid.";
            setError(errorMessage);
        }
    };

    return (
        <div className="min-h-screen flex items-center justify-center bg-background p-4">
            <div className="w-full max-w-md">
                <div className="text-center mb-8">
                    <Icon name="KeyRound" size={48} className="text-primary mx-auto mb-4" />
                    <h1 className="text-3xl font-bold text-foreground">Atur Password Baru</h1>
                     <p className="text-muted-foreground">
                        {isSuccess ? "Password Anda telah berhasil diperbarui." : "Masukkan password baru Anda di bawah ini."}
                    </p>
                </div>

                <div className="bg-card p-8 rounded-2xl border border-border shadow-lg">
                    {isSuccess ? (
                        <div className="text-center">
                            <p className="text-foreground mb-6">
                                Anda sekarang dapat masuk dengan menggunakan password baru Anda.
                            </p>
                            <Button
                                fullWidth
                                onClick={() => navigate('/login')}
                                iconName="LogIn"
                                iconPosition="left"
                            >
                                Lanjutkan ke Halaman Login
                            </Button>
                        </div>
                    ) : (
                        <form onSubmit={handleSubmit} className="space-y-6">
                            {error && <div className="text-sm text-center text-destructive bg-destructive/10 p-3 rounded-md">{error}</div>}
                            
                            <Input
                                label="Password Baru" id="password" type="password"
                                placeholder="Minimal 6 karakter"
                                value={password} onChange={(e) => setPassword(e.target.value)}
                                required disabled={!token || isLoading}
                                autoComplete="new-password"
                            />
                            <Input
                                label="Konfirmasi Password Baru" id="confirmPassword" type="password"
                                placeholder="Ulangi password baru Anda"
                                value={confirmPassword} onChange={(e) => setConfirmPassword(e.target.value)}
                                required disabled={!token || isLoading}
                                autoComplete="new-password"
                            />

                            {/* [PERBAIKAN BUG] Nonaktifkan spinner sementara untuk menghindari error rendering SVG.
                                Teks 'Menyimpan...' sudah cukup sebagai umpan balik. */}
                            <Button type="submit" fullWidth loading={false} disabled={!token || isLoading} iconName="Save" iconPosition="left">
                                {isLoading ? 'Menyimpan...' : 'Simpan Password Baru'}
                            </Button>
                        </form>
                    )}
                </div>
            </div>
        </div>
    );
};

export default ResetPasswordPage;


--- File: ./src/services/__tests__/api.test.jsx ---

import React from 'react';
import { describe, it, expect, beforeAll, beforeEach, afterEach, vi } from 'vitest';
import { render, waitFor } from '@testing-library/react';
import { Provider } from 'react-redux';
import { configureStore } from '@reduxjs/toolkit';

import { api } from '../api';
import authReducer, { setCredentials } from '../authSlice';
import { useGetAlertsQuery } from '../alertsApi';

// Mock Routes so mounting <App /> triggers an RTK Query call immediately.
vi.mock('../../Routes', () => ({
  __esModule: true,
  default: function MockRoutes() {
    useGetAlertsQuery();
    return <div data-testid="mock-routes" />;
  },
}));

// Mock the offline queue module to avoid touching IndexedDB in tests.
vi.mock('../../offline/queueService', () => ({
  __esModule: true,
  retryQueue: vi.fn(),
}));

class MockBroadcastChannel {
  constructor() {
    this.onmessage = null;
  }
  postMessage() {}
  close() {}
}

if (!globalThis.BroadcastChannel) {
  globalThis.BroadcastChannel = MockBroadcastChannel;
}

let App;

beforeAll(async () => {
  ({ default: App } = await import('../../App'));
});

describe('api auto logout integration', () => {
  let store;
  let fetchSpy;

  beforeEach(() => {
    localStorage.clear();

    store = configureStore({
      reducer: {
        [api.reducerPath]: api.reducer,
        auth: authReducer,
      },
      middleware: (getDefaultMiddleware) =>
        getDefaultMiddleware().concat(api.middleware),
    });

    fetchSpy = vi.spyOn(globalThis, 'fetch').mockResolvedValue(
      new Response(JSON.stringify({ message: 'Unauthorized' }), {
        status: 401,
        headers: { 'Content-Type': 'application/json' },
      })
    );
  });

  afterEach(() => {
    vi.restoreAllMocks();
    localStorage.clear();
  });

  it('should auto-logout when a 401 response is received', async () => {
    const fakeUser = { userId: 'user-123', name: 'Test User' };

    store.dispatch(setCredentials({ user: fakeUser, token: 'invalid-token' }));
    localStorage.setItem('sessionToken', 'invalid-token');
    localStorage.setItem('userProfile', JSON.stringify(fakeUser));

    render(
      <Provider store={store}>
        <App />
      </Provider>
    );

    await waitFor(() => {
      const authState = store.getState().auth;
      expect(authState.user).toBeNull();
      expect(authState.token).toBeNull();
      expect(authState.isAuthenticated).toBe(false);
    });

    expect(localStorage.getItem('sessionToken')).toBeNull();
    expect(fetchSpy).toHaveBeenCalledTimes(1);
  });
});



--- File: ./src/services/alertsApi.js ---

// src/services/alertsApi.js
import { api } from './api';

const dataURLtoFile = (dataurl, filename) => {
  const arr = dataurl.split(',');
  const mime = arr[0].match(/:(.*?);/)[1];
  const bstr = atob(arr[1]);
  let n = bstr.length;
  const u8arr = new Uint8Array(n);
  while (n--) u8arr[n] = bstr.charCodeAt(n);
  return new File([u8arr], filename, { type: mime });
};

const parseMaybeJson = (v) => {
  if (v == null) return null;
  if (typeof v === 'string') {
    try { return JSON.parse(v); } catch { return v; }
  }
  return v;
};

const toCamelAlert = (a) => ({
  ...a,
  id: a.id,
  timestamp: a.timestamp,
  pestType: a.pestType ?? a.pest_type ?? null,
  severity: a.severity,
  description: a.description,
  affectedCrops:
    Array.isArray(a.affected_crops) || typeof a.affected_crops === 'string'
      ? a.affected_crops
      : a.affectedCrops ?? null,
  location: a.location ?? null,
  coordinates: parseMaybeJson(a.coordinates),
  photoName: a.photoName ?? a.photo_name ?? null,
  photoUrl: a.photoUrl ?? a.photo_url ?? null,
  photoKey: a.photoKey ?? a.photo_key ?? null,          // â† DITAMBAHKAN
  affectedArea: a.affectedArea ?? a.affected_area ?? null,
  pestCount: a.pestCount ?? a.pest_count ?? null,
  accountId: a.account_id ?? a.accountId ?? null,
  userId: a.user_id ?? a.userId ?? null,
  createdAt: a.created_at ?? a.createdAt ?? null,
  updatedAt: a.updated_at ?? a.updatedAt ?? null,
  deletedAt: a.deleted_at ?? a.deletedAt ?? null,
  version: a.version ?? 1,
  hasPhoto: !!(a.photo_key || a.photo_url || a.photoUrl || a.photo_name || a.photoName), // â† DITAMBAHKAN
});

export const alertsApi = api.injectEndpoints({
  endpoints: (builder) => ({
    getAlerts: builder.query({
      query: (filters) => {
        const params = new URLSearchParams({ radius: 'all', severity: 'all', pestType: 'all' });
        if (filters) {
          params.set('radius', filters.distance || 'all');
          params.set('severity', filters.severity || 'all');
          params.set('pestType', filters.pestType || 'all');
        }
        return `alerts?${params.toString()}`;
      },
      transformResponse: (res) => Array.isArray(res) ? res.map(toCamelAlert) : [],
      providesTags: ['Alerts'],
    }),

    createAlert: builder.mutation({
      query: (newAlertData) => {
        const formData = new FormData();
        const payload = { ...newAlertData };

        // Offline replay: dataURL â†’ File
        if (typeof payload.photo === 'string' && payload.photo.startsWith('data:')) {
          payload.photo = dataURLtoFile(
            payload.photo,
            payload.photoName || 'offline-photo.jpg'
          );
        }

        Object.keys(payload).forEach((k) => {
          const v = payload[k];
          if (v == null) return;
          if (v instanceof File) formData.append(k, v, v.name);
          else if (typeof v === 'object') formData.append(k, JSON.stringify(v));
          else formData.append(k, v);
        });

        return { url: 'alerts', method: 'POST', body: formData };
      },
      invalidatesTags: ['Alerts'],
    }),
  }),
});

export const { useGetAlertsQuery, useCreateAlertMutation } = alertsApi;



--- File: ./src/services/api.js ---

// src/services/api.js

import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react';
import { toast } from 'react-hot-toast';
import { logOut } from './authSlice'; // [PERBAIKAN 1] Impor instruksi logOut

const RAW_BASE = import.meta.env.VITE_API_BASE_URL || 'http://127.0.0.1:8787';
const baseUrl = `${RAW_BASE.replace(/\/+$/, '')}/api`;

const rawBaseQuery = fetchBaseQuery({
  baseUrl,
  prepareHeaders: (headers, { getState }) => {
    let token = getState().auth.token;
    if (!token) {
        token = localStorage.getItem('sessionToken');
    }
    if (token) {
      headers.set('authorization', `Bearer ${token}`);
    }
    const userProfile = getState().auth.user || JSON.parse(localStorage.getItem('userProfile') || '{}');
    headers.set('X-Account-Id', userProfile?.accountId || 'demo');
    headers.set('X-User-Id', userProfile?.userId || 'demo');
    return headers;
  },
});

const errorToastId = (args) => {
  if (typeof args === 'string') return `api-error-${args}`;
  if (typeof args === 'object' && args?.url) return `api-error-${args.url}`;
  return 'api-error-generic';
};

const notifyApiError = (error, args) => {
  if (typeof window === 'undefined' || error.status === 401) return; // Jangan tampilkan toast untuk 401
  const offline = typeof navigator !== 'undefined' && !navigator.onLine;
  const detail = error?.data;
  const msgFromBody = typeof detail === 'string' ? detail : detail?.message || detail?.error;
  const message = offline ? 'Sedang offline. Periksa koneksi.' : msgFromBody || `Permintaan gagal (${error?.status || 'unknown'})`;
  toast.error(message, { id: errorToastId(args), duration: 4500 });
};

// [PERBAIKAN 2] Buat "wrapper" di sekitar baseQuery untuk menangani 401
const baseQueryWithReauth = async (args, api, extraOptions) => {
  let result = await rawBaseQuery(args, api, extraOptions);

  // Jika kita mendapatkan error 401, jalankan logout
  if (result.error && result.error.status === 401) {
    console.error("Menerima 401 Unauthorized. Menjalankan auto-logout.");
    api.dispatch(logOut());
    // Kita bisa menambahkan redirect di sini jika perlu, tapi logOut sudah membersihkan state
    // dan aplikasi akan secara alami mengarahkan ke halaman login.
  } else if (result.error) {
    notifyApiError(result.error, args);
  }

  return result;
};


export const api = createApi({
  reducerPath: 'api',
  // [PERBAIKAN 3] Gunakan wrapper baru kita sebagai baseQuery
  baseQuery: baseQueryWithReauth,
  tagTypes: ['Alerts', 'FarmTasks', 'DiagnosisHistory'],
  endpoints: () => ({}),
});


--- File: ./src/services/authApi.js ---

// src/services/authApi.js

import { api } from './api';

export const authApi = api.injectEndpoints({
  endpoints: (builder) => ({
    // Endpoint untuk 'login' (tetap sama)
    login: builder.mutation({
      query: (credentials) => ({
        url: 'auth/login',
        method: 'POST',
        body: credentials,
      }),
    }),

    // Endpoint untuk 'register' (tetap sama)
    register: builder.mutation({
      query: (userInfo) => ({
        url: 'auth/register',
        method: 'POST',
        body: userInfo,
      }),
    }),

    // Endpoint untuk meminta link reset password
    forgotPassword: builder.mutation({
      query: ({ email }) => ({
        url: 'auth/forgot-password',
        method: 'POST',
        body: { email },
      }),
    }),

    // Endpoint untuk mengirim password baru beserta token reset
    resetPassword: builder.mutation({
      query: ({ token, password }) => ({
        url: 'auth/reset-password',
        method: 'POST',
        body: { token, password },
      }),
    }),
  }),
});

// Ekspor semua hook yang kita butuhkan sekarang.
export const { 
    useLoginMutation, 
    useRegisterMutation, 
    useForgotPasswordMutation, 
    useResetPasswordMutation 
} = authApi;


--- File: ./src/services/authSlice.js ---

// src/services/authSlice.js

import { createSlice } from '@reduxjs/toolkit';

// Ini adalah keadaan awal saat aplikasi pertama kali dibuka.
// Awalnya, tidak ada pengguna yang login.
const initialState = {
  user: null,         // Untuk menyimpan data profil pengguna (nama, email, dll.)
  token: null,        // Untuk menyimpan Token JWT
  isAuthenticated: false, // Penanda sederhana apakah sudah login atau belum
};

const authSlice = createSlice({
  name: 'auth',
  initialState,
  // 'reducers' adalah kumpulan "instruksi" untuk mengubah state.
  reducers: {
    // Instruksi ini akan dijalankan saat login berhasil.
    setCredentials: (state, action) => {
      const { user, token } = action.payload;
      state.user = user;
      state.token = token;
      state.isAuthenticated = true;

      // Simpan token ke localStorage agar tidak hilang saat refresh.
      // Ini seperti menyimpan "tiket masuk" ke dalam dompet.
      localStorage.setItem('sessionToken', token);
      // Simpan juga data pengguna jika perlu
      localStorage.setItem('userProfile', JSON.stringify(user));
    },

    // Instruksi ini akan dijalankan saat logout.
    logOut: (state) => {
      state.user = null;
      state.token = null;
      state.isAuthenticated = false;

      // Hapus "tiket masuk" dari dompet.
      localStorage.removeItem('sessionToken');
      localStorage.removeItem('userProfile');
    },
  },
});

// Ekspor "instruksi" agar bisa digunakan di komponen lain.
export const { setCredentials, logOut } = authSlice.actions;

// Ekspor reducer agar bisa dihubungkan ke "otak" utama Redux.
export default authSlice.reducer;

// Ekspor "selector" untuk memudahkan pengambilan data dari state.
export const selectCurrentUser = (state) => state.auth.user;
export const selectIsAuthenticated = (state) => state.auth.isAuthenticated;


--- File: ./src/services/diagnosisApi.js ---

// src/services/diagnosisApi.js

import { api } from './api';

const dataURLtoFile = (dataurl, filename) => {
    if (typeof dataurl !== 'string' || !dataurl.startsWith('data:')) {
        return null;
    }
    try {
        let arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
            bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
        while(n--){
            u8arr[n] = bstr.charCodeAt(n);
        }
        return new File([u8arr], filename, {type:mime});
    } catch (e) {
        console.error("Gagal mengubah Data URL menjadi File:", e);
        return null;
    }
}

export const diagnosisApi = api.injectEndpoints({
  endpoints: (builder) => ({
    // --- PENAMBAHAN ENDPOINT BARU ---
    getDiagnosisHistory: builder.query({
      query: () => 'diagnosis',
      // Tandai data ini agar bisa di-cache dan di-invalidate
      providesTags: ['DiagnosisHistory'],
    }),
    // --- AKHIR DARI PENAMBAHAN ---

    createDiagnosis: builder.mutation({
      query: (submissionData) => {
        const formData = new FormData();
        const dataToProcess = { ...submissionData };

        if (typeof dataToProcess.photo === 'string' && dataToProcess.photo.startsWith('data:')) {
          const photoFile = dataURLtoFile(dataToProcess.photo, dataToProcess.photoName || 'offline-photo.jpg');
          if (photoFile) {
            dataToProcess.photo = photoFile;
          }
        }

        Object.keys(dataToProcess).forEach(key => {
          const value = dataToProcess[key];
          if (value instanceof File) {
            formData.append(key, value, value.name);
          } else if (value !== null && value !== undefined) {
            if (typeof value === 'object') {
              formData.append(key, JSON.stringify(value));
            } else {
              formData.append(key, value);
            }
          }
        });
        
        return {
          url: 'diagnosis',
          method: 'POST',
          body: formData,
        };
      },
      // --- PERUBAHAN DI SINI ---
      // Setelah diagnosis baru berhasil dibuat, bersihkan cache 'DiagnosisHistory'
      invalidatesTags: ['DiagnosisHistory'],
      // --- AKHIR DARI PERUBAHAN ---
    }),
  }),
});

// --- PERUBAHAN DI SINI ---
// Ekspor hook baru bersama dengan yang lama
export const { useCreateDiagnosisMutation, useGetDiagnosisHistoryQuery } = diagnosisApi;
// --- AKHIR DARI PERUBAHAN ---


--- File: ./src/services/farmTasksApi.js ---

// src/services/farmTasksApi.js
import { api } from './api';

// Helper ISO
const iso = (d) => new Date(d).toISOString();

// Range default: -14 s/d +14 hari
const defaultRange = () => {
  const now = new Date();
  const from = new Date(now); from.setDate(from.getDate() - 14);
  const to   = new Date(now); to.setDate(to.getDate() + 14);
  return { from: iso(from), to: iso(to) };
};

export const farmTasksApi = api.injectEndpoints({
  endpoints: (builder) => ({

    // GET /farm-tasks?from=&to=&status=
    getFarmTasks: builder.query({
      query: (params) => {
        const range = params ?? defaultRange();
        const qs = new URLSearchParams({ from: range.from, to: range.to });
        if (range.status) qs.set('status', range.status);
        // [PERUBAHAN KUNCI] Menggunakan URL baru
        return `farm-tasks?${qs.toString()}`;
      },
      // Normalisasi bentuk data agar cocok dengan kebutuhan UI
      transformResponse: (res) => {
        if (!Array.isArray(res)) return [];
        return res.map((e) => {
          const start = e.start_at ? new Date(e.start_at) : null;
          const date = start ? start.toISOString().slice(0, 10) : undefined;
          const time = start ? start.toISOString().slice(11, 16) : undefined;
          const completed = (e.status || '').toLowerCase() === 'completed';
          return { ...e, date, time, completed };
        });
      },
      providesTags: ['FarmTasks'], // [PERUBAHAN KUNCI]
    }),

    // POST /farm-tasks
    createFarmTask: builder.mutation({
      query: (taskData) => {
        // Susun start_at jika FE awalnya kirim {date, time} - LOGIKA LENGKAP ASLI
        const start_at =
          taskData.start_at ||
          new Date(
            (taskData.date || new Date().toISOString().slice(0, 10)) +
            (taskData.time ? `T${taskData.time}:00Z` : 'T00:00:00Z')
          ).toISOString();

        const body = {
          id: taskData.id,
          title: taskData.title,
          type: taskData.type ?? null,
          crop: taskData.crop ?? null,
          location: taskData.location ?? null,
          // Backend akan JSON.stringify(notes), jadi kirimkan array/object OK
          notes: taskData.notes ?? [],
          start_at,
          end_at: taskData.end_at ?? null,
          all_day: taskData.all_day ? 1 : 0,
          status: taskData.status ?? 'pending',
          source_type: taskData.source_type ?? null,
          source_id: taskData.source_id ?? null,
        };
        // [PERUBAHAN KUNCI] Menggunakan URL baru
        return { url: 'farm-tasks', method: 'POST', body };
      },
      invalidatesTags: ['FarmTasks'], // [PERUBAHAN KUNCI]
    }),

    // PATCH /farm-tasks/:id
    updateFarmTask: builder.mutation({
      query: ({ id, ...updates }) => ({
        // [PERUBAHAN KUNCI] Menggunakan URL baru
        url: `farm-tasks/${id}`,
        method: 'PATCH',
        body: updates,
      }),
      invalidatesTags: ['FarmTasks'], // [PERUBAHAN KUNCI]
    }),

    // DELETE /farm-tasks/:id
    deleteFarmTask: builder.mutation({
      query: (id) => ({
        // [PERUBAHAN KUNCI] Menggunakan URL baru
        url: `farm-tasks/${id}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['FarmTasks'], // [PERUBAHAN KUNCI]
    }),

  }),
});

export const {
  useGetFarmTasksQuery,
  useCreateFarmTaskMutation,
  useUpdateFarmTaskMutation,
  useDeleteFarmTaskMutation,
} = farmTasksApi;


--- File: ./src/services/weatherApi.js ---

// src/services/weatherApi.js
import axios from 'axios';

/**
 * Get weather advice from our API (BMKG-backed).
 * @param {{ lat: number, lon: number, date?: string }} params
 */
export async function getWeatherAdvice(params) {
  const q = new URLSearchParams();
  if (typeof params?.lat === 'number') q.set('lat', String(params.lat));
  if (typeof params?.lon === 'number') q.set('lon', String(params.lon));
  if (params?.date) q.set('date', params.date);
  const { data } = await axios.get(`/api/weather/advice?${q.toString()}`);
  return data;
}




--- File: ./src/setupTests.js ---

import { expect } from 'vitest';

/**
 * Shared Vitest setup.
 * - Registers DOM matchers only when a DOM-like environment exists
 *   so backend/unit tests that run in the Node environment stay light.
 */
const hasDom =
  typeof window !== 'undefined' &&
  typeof window.document !== 'undefined';

if (hasDom) {
  const matchers = (await import('@testing-library/jest-dom/matchers')).default;
  expect.extend(matchers);
}



--- File: ./src/styles/index.css ---

/* === Desktop width unlock === */
html, body {
  width: 100%;
  min-height: 100%;
  margin: 0;
  padding: 0;
}

/* Camera scanning animation */
@keyframes scan {
  0% { transform: translateY(0%); }
  100% { transform: translateY(100%); }
}

#root {
  width: 100%;
  max-width: none; /* â† penting: jangan kunci */
  margin: 0;       /* jangan pakai auto center di sini */
  padding: 0;
}
/* src/styles/index.css */

/* ... (kode yang sudah ada) ... */

/* FIX: Paksa peta Leaflet agar selalu di belakang modal dan pop-up lain */
.leaflet-container {
  z-index: 1 !important;
}


--- File: ./src/styles/tailwind.css ---

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400&display=swap');
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Core Colors */
    --color-background: #F8FAFC; /* light gray background for mobile */
    --color-foreground: #1F2937; /* dark-gray */
    --color-border: #E5E7EB; /* neutral-gray */
    --color-input: #FFFFFF; /* white input background */
    --color-ring: #16A34A; /* vibrant primary green */
    
    /* Card Colors */
    --color-card: #FFFFFF; /* white */
    --color-card-foreground: #1F2937; /* dark-gray */
    --color-popover: #FFFFFF; /* white */
    --color-popover-foreground: #1F2937; /* dark-gray */
    
    /* Muted Colors */
    --color-muted: #F3F4F6; /* lighter gray for mobile */
    --color-muted-foreground: #6B7280; /* medium-gray */
    
    /* Primary Colors - Vibrant Green */
    --color-primary: #16A34A; /* vibrant primary green */
    --color-primary-foreground: #FFFFFF; /* white */
    
    /* Secondary Colors - Professional Blue */
    --color-secondary: #0284C7; /* vibrant secondary blue */
    --color-secondary-foreground: #FFFFFF; /* white */
    
    /* Accent Colors - Warning Orange */
    --color-accent: #F97316; /* vibrant warning orange */
    --color-accent-foreground: #FFFFFF; /* white */
    
    /* Success Colors - Green (Baik) */
    --color-success: #16A34A; /* same as primary for consistency */
    --color-success-foreground: #FFFFFF; /* white */
    
    /* Warning Colors - Orange (Sedang) */
    --color-warning: #F97316; /* vibrant warning orange */
    --color-warning-foreground: #FFFFFF; /* white */
    
    /* Error/Destructive Colors - Red (Tinggi) */
    --color-error: #DC2626; /* vibrant error red */
    --color-error-foreground: #FFFFFF; /* white */
    --color-destructive: #DC2626; /* vibrant error red */
    --color-destructive-foreground: #FFFFFF; /* white */
    
    /* Surface Color */
    --color-surface: #F8FAFC; /* subtle-gray */
    
    /* Text Colors */
    --color-text-primary: #1F2937; /* dark-gray */
    --color-text-secondary: #6B7280; /* medium-gray */
  }
}

@layer base {
  * {
    @apply border-border;
  }
  
  body {
    @apply bg-background text-foreground;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
  }
  
  h1, h2, h3, h4, h5, h6 {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
  }
  
  .font-mono {
    font-family: 'JetBrains Mono', 'Courier New', monospace;
  }
}

@layer components {
  /* Agricultural Loading Animation */
  .loading-plant {
    animation: grow 2s ease-in-out infinite;
  }
  
  @keyframes grow {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }
  
  /* Haptic Feedback Simulation */
  .haptic-feedback {
    animation: pulse 0.2s ease-out;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(0.95); }
    100% { transform: scale(1); }
  }
  
  /* Smooth Transitions */
  .transition-smooth {
    transition: all 300ms ease-out;
  }
  
  /* Agricultural Shadow */
  .shadow-agricultural {
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }
  
  .shadow-agricultural-lg {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
}


--- File: ./src/utils/__tests__/normalizePhotoUrl.test.js ---

import { describe, it, expect } from 'vitest';
import normalizePhotoUrl from '../normalizePhotoUrl';

describe('normalizePhotoUrl', () => {
  it('builds an API URL when photoKey is provided', () => {
    const url = normalizePhotoUrl('laporan folder/foto akhir.jpg', null);
    expect(url).toBe('/api/photos/laporan%20folder%2Ffoto%20akhir.jpg');
  });

  it('decodes double-encoded keys once before re-encoding', () => {
    const url = normalizePhotoUrl('laporan%252Ffoto%2520akhir.jpg', null);
    expect(url).toBe('/api/photos/laporan%252Ffoto%2520akhir.jpg');
  });

  it('sanitizes remote URLs when only photoUrl exists', () => {
    const url = normalizePhotoUrl(null, 'https://cdn.example.com/folder foto 1.png');
    expect(url).toBe('https://cdn.example.com/folder%20foto%201.png');
  });

  it('decodes double-encoded remote URLs exactly once', () => {
    const url = normalizePhotoUrl(null, 'https://cdn.example.com/folder%2520foto%25201.png');
    expect(url).toBe('https://cdn.example.com/folder%20foto%201.png');
  });

  it('returns null when neither key nor url exists', () => {
    expect(normalizePhotoUrl(undefined, undefined)).toBeNull();
  });
});



--- File: ./src/utils/cn.js ---

import { clsx } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs) {
    return twMerge(clsx(inputs));
}


--- File: ./src/utils/normalizePhotoUrl.js ---

// src/utils/normalizePhotoUrl.js
/**
 * Build a safe image URL from an R2 object key or a direct URL.
 * - Prefer `photoKey` â†’ `/api/photos/:key`
 * - If `photoUrl` might be double-encoded (e.g. %2520), decode ONCE then ensure spaces are %20.
 * - Avoid double-encoding keys by decoding ONCE when "%25" is present before encoding.
 * - Returns `null` if neither key nor url is provided.
 * @param {string | null | undefined} photoKey
 * @param {string | null | undefined} photoUrl
 * @returns {string | null}
 */
export default function normalizePhotoUrl(photoKey, photoUrl) {
  if (photoKey) {
    const safeKey = sanitizeKey(String(photoKey));
    return `/api/photos/${encodeURIComponent(safeKey)}`;
  }
  if (photoUrl) {
    return sanitizeUrl(String(photoUrl));
  }
  return null;
}

function sanitizeKey(key) {
  try {
    // If key looks double-encoded (e.g., includes "%2520"), decode once.
    if (/%25/i.test(key)) {
      key = decodeURIComponent(key);
    }
  } catch (_) {}
  return key;
}

function sanitizeUrl(url) {
  try {
    // If looks double-encoded ("%2520" etc), decode once.
    let u = url;
    if (/%25/i.test(u)) {
      u = decodeURIComponent(u);
    }
    // Normalize spaces to %20
    u = u.replace(/ /g, '%20');
    return u;
  } catch (_) {
    return url;
  }
}



--- File: ./tailwind.config.js ---

/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
  border: '#E5E7EB',
  input: '#FFFFFF',
  ring: '#16A34A',
  background: '#F8FAFC',
  foreground: '#1F2937',
  primary: {
    DEFAULT: '#16A34A',
    foreground: '#FFFFFF',
  },
  secondary: {
    DEFAULT: '#0284C7',
    foreground: '#FFFFFF',
  },
  destructive: {
    DEFAULT: '#DC2626',
    foreground: '#FFFFFF',
  },
  muted: {
    DEFAULT: '#F3F4F6',
    foreground: '#6B7280',
  },
  accent: {
    DEFAULT: '#F97316',
    foreground: '#FFFFFF',
  },
  popover: {
    DEFAULT: '#FFFFFF',
    foreground: '#1F2937',
  },
  card: {
    DEFAULT: '#FFFFFF',
    foreground: '#1F2937',
  },
  // --- Warna tambahan dari instruksi ---
  warning: {
    DEFAULT: '#F97316',
    foreground: '#FFFFFF',
  },
  error: {
    DEFAULT: '#DC2626',
    foreground: '#FFFFFF',
  },
  success: {
    DEFAULT: '#16A34A',
    foreground: '#FFFFFF',
  },
},
      fontFamily: {
        sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
        mono: ['JetBrains Mono', 'Courier New', 'monospace']
      },
      fontSize: {
        'xs': ['0.75rem', { lineHeight: '1rem' }],
        'sm': ['0.875rem', { lineHeight: '1.25rem' }],
        'base': ['1rem', { lineHeight: '1.5rem' }],
        'lg': ['1.125rem', { lineHeight: '1.75rem' }],
        'xl': ['1.25rem', { lineHeight: '1.75rem' }],
        '2xl': ['1.5rem', { lineHeight: '2rem' }],
        '3xl': ['1.875rem', { lineHeight: '2.25rem' }],
        '4xl': ['2.25rem', { lineHeight: '2.5rem' }]
      },
      borderRadius: {
        'lg': '16px',
        'md': '12px',
        'sm': '8px',
        'xs': '4px'
      },
      boxShadow: {
        'agricultural': '0 1px 3px rgba(0, 0, 0, 0.1)',
        'agricultural-lg': '0 4px 6px rgba(0, 0, 0, 0.1)'
      },
      spacing: {
        '18': '4.5rem',
        '88': '22rem',
        '128': '32rem'
      },
      minHeight: {
        'touch': '48px'
      },
      animation: {
        'grow': 'grow 2s ease-in-out infinite',
        'pulse-gentle': 'pulse 0.2s ease-out'
      },
      keyframes: {
        grow: {
          '0%, 100%': { transform: 'scale(1)' },
          '50%': { transform: 'scale(1.1)' }
        }
      },
      zIndex: {
        '60': '60',
        '70': '70',
        '80': '80',
        '90': '90',
        '100': '100',
        '150': '150',
        '200': '200',
        '300': '300'
      }
    },
  },
  plugins: [
    require('@tailwindcss/forms'),
    require('tailwindcss-animate')
  ],
}


--- File: ./vite.config.mjs ---

import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import tsconfigPaths from "vite-tsconfig-paths";
import tagger from "@dhiwise/component-tagger";

// https://vitejs.dev/config/
export default defineConfig({
  build: {
    outDir: "build",
    chunkSizeWarningLimit: 2000,
  },
  plugins: [tsconfigPaths(), react(), tagger()],
  server: {
    port: 4028,
    host: "0.0.0.0",
    strictPort: true,
    
    // --- KONFIGURASI PROXY YANG LEBIH DETAIL ---
    proxy: {
      // Setiap permintaan ke /api akan diteruskan ke server backend Wrangler
      '/api': {
        target: 'http://127.0.0.1:8787', // Pastikan port ini sama dengan port Wrangler Anda
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, ''), // Hapus /api dari path sebelum dikirim ke Worker
      },
    }
    // --- AKHIR DARI PERBAIKAN ---
  },
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: './src/setupTests.js',
    environmentMatchGlobs: [
      ['ai-tani-kupang-api/**', 'node'],
      ['**/*.worker.test.{js,ts}', 'node'],
    ],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'html'],
      reportsDirectory: 'coverage',
      include: [
        'src/**/*.{js,jsx}',
        'ai-tani-kupang-api/src/**/*.js',
      ],
      exclude: [
        'src/**/__mocks__/**',
        'src/**/__fixtures__/**',
      ],
    },
  },
});



================================================================================
--- AKHIR DARI SNAPSHOT KODE ---
================================================================================
